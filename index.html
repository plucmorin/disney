<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur d'e-mail Disney Pro</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; margin: 20px; background-color: #f4f7f6; color: #333; line-height: 1.6; }
        .container { background-color: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 900px; margin: auto;}
        h1 { text-align: center; margin-bottom: 30px; color: #005A9C; font-weight: 700;}
        h2 { margin-top: 25px; color: #005A9C; border-bottom: 2px solid #eee; padding-bottom: 8px;}
        label { display: block; margin-top: 15px; font-weight: 600; color: #333; }
        input[type="text"], input[type="number"], input[type="date"], input[type="time"], select, textarea {
            width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 1em;
            transition: border-color 0.2s;
        }
        input:focus, select:focus, textarea:focus { border-color: #007bff; outline: none; }
        textarea { resize: vertical; min-height: 80px; }
        input[type="checkbox"] { margin-right: 8px; vertical-align: middle; width: auto; }
        button, .remove-hotel-button {
            background-color: #007bff; color: white; padding: 12px 20px;
            border: none; border-radius: 6px; cursor: pointer; margin-top: 20px; font-size: 1.05em; font-weight: 500;
            transition: background-color 0.2s;
        }
        button:hover, .remove-hotel-button:hover { background-color: #0056b3; }
        #copyHtmlButton { background-color: #28a745; }
        #copyHtmlButton:hover { background-color: #218838; }

        .remove-hotel-button { background-color: #dc3545; padding: 5px 10px; font-size: 0.9em; margin-left: 10px; margin-top: 0;}
        .remove-hotel-button:hover { background-color: #c82333; }
        .form-section { border: 1px solid #e9ecef; padding: 20px; margin-bottom: 25px; border-radius: 8px; background-color: #fdfdfd; }
        .hotel-option-group { border: 1px solid #e0e0e0; padding: 15px; margin-top: 15px; border-radius: 8px; background-color: #fafafa; }
        .hotel-option-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .hidden { display: none; }
        #emailOutputContainer { margin-top: 30px; }
        #emailOutput { padding: 20px; border: 1px solid #ccc; background-color: #f0f0f0; border-radius: 8px; min-height: 200px; overflow-x: auto;}
    </style>
</head>
<body>
    <div class="container">
        <h1>Générateur d'e-mail Disney Pro</h1>
        <form id="disneyForm">
            <div class="form-section">
                <h2>Informations Générales</h2>
                <label for="client_name">Nom de la personne cliente :</label>
                <input type="text" id="client_name" name="client_name" placeholder="Entrez le nom du client" required>
                <label for="adults">Nombre d'adultes :</label>
                <input type="number" id="adults" name="adults" min="1" value="2" required>
                <label for="children">Nombre d'enfants (0 si aucun) :</label>
                <input type="number" id="children" name="children" min="0" value="0" required>
            </div>
            <div class="form-section">
                <h2>Hébergement et Billets</h2>
                <label for="booking_type">Type de réservation :</label>
                <select id="booking_type" name="booking_type">
                    <option value="hotel_tickets">Hôtel + Billets</option>
                    <option value="tickets_only">Billets seulement</option>
                </select>
                <div id="hotel_options_container">
                    <div id="hotel_selections"></div>
                    <button type="button" id="add_hotel_button">Ajouter une option d'hôtel</button>
                </div>
            </div>
            <div class="form-section">
                <h2>Vols</h2>
                <label><input type="checkbox" id="include_flights" name="include_flights"> Inclure les vols ?</label>
                <div id="flight_details" class="hidden">
                    <label for="departure_date_aller">Date de départ (Aller) :</label>
                    <input type="date" id="departure_date_aller" name="departure_date_aller">
                    <label for="departure_time_aller">Heure de départ (Aller) :</label>
                    <input type="time" id="departure_time_aller" name="departure_time_aller">
                    <label for="departure_airport_aller">Aéroport de départ (Aller) :</label>
                    <input type="text" id="departure_airport_aller" name="departure_airport_aller" placeholder="Ex: YUL - Montréal">
                    <label for="arrival_airport_aller">Aéroport d'arrivée (Aller) :</label>
                    <input type="text" id="arrival_airport_aller" name="arrival_airport_aller" placeholder="Ex: MCO - Orlando" value="MCO - Orlando">
                    <label for="departure_date_retour">Date de départ (Retour) :</label>
                    <input type="date" id="departure_date_retour" name="departure_date_retour">
                    <label for="departure_time_retour">Heure de départ (Retour) :</label>
                    <input type="time" id="departure_time_retour" name="departure_time_retour">
                    <label for="departure_airport_retour">Aéroport de départ (Retour) :</label>
                    <input type="text" id="departure_airport_retour" name="departure_airport_retour" placeholder="Ex: MCO - Orlando" value="MCO - Orlando">
                    <label for="arrival_airport_retour">Aéroport d'arrivée (Retour) :</label>
                    <input type="text" id="arrival_airport_retour" name="arrival_airport_retour" placeholder="Ex: YUL - Montréal">
                    <label for="flight_price">Prix total approximatif des vols (CAD) :</label>
                    <input type="number" id="flight_price" name="flight_price" step="0.01">
                    <label for="flight_notes">Notes sur les vols :</label>
                    <textarea id="flight_notes" name="flight_notes" placeholder="Ajoutez ici des détails importants (ex: compagnie, escale, type de bagages inclus...)"></textarea>
                </div>
            </div>
            <div class="form-section">
                <h2>Promotion</h2>
                <label for="promotion_type">Type de promotion :</label>
                <select id="promotion_type" name="promotion_type">
                    <option value="aucune">Aucune promotion pour l'instant</option>
                    <option value="specifique">Promotion spécifique</option>
                </select>
                <div id="promotion_details" class="hidden">
                    <label for="promotion_name">Nom de la promotion :</label>
                    <input type="text" id="promotion_name" name="promotion_name" placeholder="Nom de la promotion (ex: Rabais estival)">
                    <label for="promotion_end_date">Date de fin de la promotion (si applicable) :</label>
                    <input type="date" id="promotion_end_date" name="promotion_end_date">
                </div>
            </div>
            <button type="submit">Générer l'e-mail</button>
        </form>

        <div id="emailOutputContainer">
            <h2>E-mail Généré (Prêt à copier)</h2>
            <div id="emailOutput" contenteditable="true"></div>
            <button type="button" id="copyHtmlButton">Copier le contenu de l'e-mail</button>
        </div>
    </div>

    <script>
        const DISNEY_HOTELS = [ /* Votre liste d'hôtels reste ici */ 
            { name: "Bay Lake Tower at Disney's Contemporary Resort", description: "Connecté au Magic Kingdom par une passerelle, cet hôtel moderne offre des vues spectaculaires et des villas luxueuses." },
            { name: "Boulder Ridge Villas at Disney's Wilderness Lodge", description: "Inspirées par les gîtes des parcs nationaux de l'Ouest américain de la fin du XIXe siècle, ces villas offrent un charme rustique et une ambiance chaleureuse." },
            { name: "Copper Creek Villas & Cabins at Disney's Wilderness Lodge", description: "Des villas et cabines élégantes au bord de l'eau, offrant un mélange de luxe moderne et de nature sauvage, inspirées par l'héritage ferroviaire du Nord-Ouest Pacifique." },
            { name: "Disney’s All-Star Movies Resort", description: "Plongez dans la magie du cinéma avec cet hôtel thématique qui rend hommage aux grands classiques d’animation de Disney. Il est idéal pour les familles cherchant une option économique et colorée." },
            { name: "Disney’s All-Star Music Resort", description: "Inspiré de différents genres musicaux, cet hôtel immersif propose une ambiance rythmée et des suites familiales, une rareté dans la catégorie 'Value'." },
            { name: "Disney’s All-Star Sports Resort", description: "Idéal pour les amateurs d’activités physiques, cet hôtel célèbre les grands sports américains avec une ambiance énergique." },
            { name: "Disney’s Animal Kingdom Lodge", description: "Plongez dans l’univers africain avec ce lodge spectaculaire. Son point fort unique : des savanes privées où l'on peut observer plus de 30 espèces d’animaux." },
            { name: "Disney’s Art of Animation Resort", description: "Cet hôtel transporte les visiteurs dans les mondes colorés de La Petite Sirène, Le Roi Lion, Némo et Cars. Il est réputé pour ses suites familiales immersives et son accès direct au Disney Skyliner." },
            { name: "Disney’s Beach Club Resort", description: "Un charmant hôtel d’inspiration Nouvelle-Angleterre, célèbre pour sa piscine Stormalong Bay, un véritable mini-parc aquatique. Il est à distance de marche d'EPCOT." },
            { name: "Disney’s BoardWalk Inn", description: "Rappelant les promenades côtières du début du 20e siècle, son principal atout est son 'Boardwalk' animé, avec restaurants et divertissements, et son accès à pied à EPCOT." },
            { name: "Disney’s Caribbean Beach Resort", description: "Ce vaste complexe à l'ambiance tropicale est le hub central du Disney Skyliner, offrant un transport rapide et scénique vers EPCOT et Hollywood Studios." },
            { name: "Disney’s Contemporary Resort", description: "Iconique avec son monorail qui le traverse, c'est l'hôtel le plus proche de Magic Kingdom, accessible en moins de 10 minutes à pied." },
            { name: "Disney’s Coronado Springs Resort", description: "Mariant l’architecture coloniale espagnole à l'élégance de la tour Gran Destino, il offre une ambiance sophistiquée de 'resort' de luxe à un prix de catégorie modérée." },
            { name: "Disney’s Grand Floridian Resort & Spa", description: "L’hôtel le plus luxueux et emblématique de Disney. Son élégance victorienne, son spa de renommée mondiale et sa proximité avec Magic Kingdom en font le summum du luxe." },
            { name: "Disney’s Polynesian Village Resort", description: "Ambiance tropicale et vues imprenables sur les feux d'artifice de Magic Kingdom. Il est situé sur la ligne du monorail, offrant un accès facile à deux parcs." },
            { name: "Disney’s Pop Century Resort", description: "Un voyage à travers la culture pop du 20e siècle. Cet hôtel est très apprécié pour son bon rapport qualité-prix et son accès direct au Disney Skyliner." },
            { name: "Disney’s Port Orleans Resort - French Quarter", description: "Ce charmant hôtel évoque le Vieux Carré de La Nouvelle-Orléans. Sa petite taille le rend intime et facile à parcourir, et il offre un service de bateau vers Disney Springs." },
            { name: "Disney’s Port Orleans Resort - Riverside", description: "Divisé en deux thèmes, les manoirs élégants et les bayous rustiques, il offre une grande variété de paysages et d'activités, comme des balades en calèche." },
            { name: "Disney’s Wilderness Lodge", description: "Inspiré des grands lodges des parcs nationaux américains, son hall spectaculaire et son ambiance immersive en font une évasion en pleine nature, à un court trajet en bateau de Magic Kingdom." },
            { name: "Disney’s Yacht Club Resort", description: "Voisin du Beach Club, il partage sa piscine exceptionnelle, Stormalong Bay. Son ambiance est plus formelle et nautique, et il est à quelques pas d'EPCOT." },
            { name: "Disney’s Riviera Resort", description: "Inspiré par l'élégance de la Riviera européenne, cet hôtel du Disney Vacation Club offre des hébergements de luxe et le restaurant sur le toit, Topolino's Terrace, avec des vues spectaculaires. Il dispose également d'une station de Skyliner." }
        ];

        function getHotelByName(name) { return DISNEY_HOTELS.find(hotel => hotel.name === name); }
        function formatDateFR(dateStr) { if (!dateStr) return ""; try { const date = new Date(dateStr + 'T00:00:00'); const options = { year: 'numeric', month: 'long', day: 'numeric' }; return date.toLocaleDateString('fr-FR', options); } catch (e) { return dateStr; } }
        function formatTime(timeStr) { if (!timeStr) return ""; try { const [hours, minutes] = timeStr.split(':'); return `${String(hours).padStart(2, '0')}h${String(minutes).padStart(2, '0')}`; } catch (e) { return timeStr; } }

        function generateEmailHTML(data) {
            // --- NEW DESIGN SYSTEM & STYLES ---
            const C = {
                background: '#f4f7f6',
                contentBackground: '#ffffff',
                primary: '#005A9C', // A deeper, more professional blue
                accent: '#D4AF37', // A magical gold accent
                text: '#212529',
                textLight: '#555555',
                border: '#e9ecef',
            };
            const S = {
                fontFamily: `'Segoe UI', Roboto, Helvetica, Arial, sans-serif`,
                body: `width:100%; margin:0; padding:0; -webkit-text-size-adjust:100%; -ms-text-size-adjust:100%; background-color:${C.background};`,
                wrapper: `max-width:600px; margin:0 auto;`,
                header: `padding:40px 20px; text-align:center;`,
                headerTitle: `font-size:28px; font-weight:700; color:${C.primary}; margin:0;`,
                preheader: `font-size:14px; color:${C.textLight}; margin:0 0 10px 0;`,
                card: `background-color:${C.contentBackground}; border-radius:8px; margin-bottom:20px; padding:30px; border:1px solid ${C.border};`,
                h2: `font-size:22px; font-weight:600; color:${C.primary}; margin:0 0 20px 0; border-bottom:2px solid ${C.border}; padding-bottom:10px;`,
                p: `margin:0 0 1em 0; font-size:16px; line-height:1.6; color:${C.text};`,
                strong: `font-weight:600; color:${C.text};`,
                ul: `margin:1em 0 1em 20px; padding:0; list-style-type:disc;`,
                li: `margin-bottom:0.5em; font-size:16px; line-height:1.6; color:${C.text};`,
                hotelTable: `width:100%; border-collapse:collapse; margin-top:20px;`,
                th: `text-align:left; padding:12px; font-size:14px; color:${C.textLight}; border-bottom:2px solid ${C.border}; text-transform:uppercase;`,
                td: `text-align:left; padding:15px 12px; border-bottom:1px solid ${C.border}; vertical-align:top;`,
                button: `display:inline-block; background-color:${C.primary}; color:#ffffff; padding:12px 25px; border-radius:5px; text-decoration:none; font-weight:bold; font-size:16px;`,
                footer: `text-align:center; padding:20px; font-size:12px; color:#888888;`
            };
            
            let emailContent = '';
            
            // --- INTRO SECTION ---
            emailContent += `
                <p style="${S.p}">Bonjour <strong style="${S.strong}">${data.client_name || 'cher voyageur'}</strong>,</p>
                <p style="${S.p}">Merci de nous avoir confié votre projet de voyage magique. Je suis Pierre-Luc Morin, votre conseiller spécialisé, et j'ai préparé pour vous une proposition sur mesure.</p>
                <p style="${S.p}">Rappelez-vous que tout est flexible. Mon but est de sculpter avec vous le séjour qui vous ressemble parfaitement.</p>
            `;

            const selectedHotels = data.hotels || [];

            // --- HOTEL SECTION ---
            if (data.booking_type === 'hotel_tickets' && selectedHotels.length > 0) {
                let hotelHtml = `<h2 style="${S.h2}">Vos Options d'Hébergement</h2>`;
                if (selectedHotels.length === 1) {
                    const hotel = selectedHotels[0];
                    hotelHtml += `<p style="${S.p}">J’ai sélectionné pour vous l'hôtel <strong style="${S.strong}">${hotel.name}</strong>, qui correspond parfaitement à vos attentes.</p>`;
                    hotelHtml += `<p style="${S.p}">${hotel.description}</p>`;
                    if(hotel.pros) {
                        hotelHtml += `<p style="${S.p} margin-top:1em;"><strong style="${S.strong}">Les points forts de cet hôtel :</strong></p><ul style="${S.ul}">`;
                        hotel.pros.split('\n').forEach(pro => { if(pro) hotelHtml += `<li style="${S.li}">${pro}</li>`; });
                        hotelHtml += `</ul>`;
                    }
                    hotelHtml += `<p style="${S.p}">Vous trouverez tous les détails (prix, dates, inclusions) dans le document PDF ci-joint.</p>`;
                } else {
                    hotelHtml += `<p style="${S.p}">Voici plusieurs options possibles pour votre séjour. J'ai préparé un PDF détaillé pour chaque proposition.</p>`;
                    let hotelTable = `<table style="${S.hotelTable}" width="100%" cellpadding="0" cellspacing="0"><thead><tr>
                        <th style="${S.th}">Option</th><th style="${S.th}">Les Plus</th><th style="${S.th}">Prix (USD)</th>
                    </tr></thead><tbody>`;
                    selectedHotels.forEach(hotel => {
                        hotelTable += `
                            <tr>
                                <td style="${S.td}">
                                    <strong style="${S.strong}">${hotel.name}</strong>
                                    <p style="font-size:14px; color:${C.textLight}; margin:5px 0 0 0;">${hotel.description}</p>
                                </td>
                                <td style="${S.td}"><ul style="margin:0; padding-left:15px; font-size:14px; color:${C.textLight};">`
                                + hotel.pros.split('\n').map(pro => `<li>${pro}</li>`).join('') +
                                `</ul></td>
                                <td style="${S.td}"><strong style="${S.strong}">${hotel.price ? hotel.price : 'Voir PDF'}</strong></td>
                            </tr>`;
                    });
                    hotelTable += `</tbody></table>`;
                    hotelHtml += hotelTable;
                }
                emailContent += `<div style="${S.card}">${hotelHtml}</div>`;
            } else if (data.booking_type === 'tickets_only') {
                 emailContent += `<div style="${S.card}"><h2 style="${S.h2}">Vos Billets de Parc</h2><p style="${S.p}">Vous trouverez en pièce jointe un document détaillant le prix et les conditions pour les billets de parc Disney.</p></div>`;
            }

            // --- PROMOTION & DEPOSIT SECTION ---
            let promoText = "";
            if (data.promotion_type === 'aucune') {
                promoText = `Pour l'instant, aucune promotion majeure ne s'applique, mais je reste à l'affût pour vous ! En réservant maintenant avec un dépôt de <strong style="${S.strong}">200 USD</strong>, vous sécurisez votre place. Ce dépôt est <strong style="${S.strong}">entièrement remboursable jusqu'à 30 jours</strong> avant votre arrivée, vous offrant une flexibilité totale.`;
            } else {
                let promoEndDateInfo = data.promotion_end_date ? ` (prend fin le <strong style="${S.strong}">${formatDateFR(data.promotion_end_date)}</strong>)` : "";
                let promoNameInfo = data.promotion_name ? `<strong style="${S.strong}">${data.promotion_name}</strong>` : "Une promotion";
                promoText = `Bonne nouvelle ! ${promoNameInfo} est applicable pour votre séjour${promoEndDateInfo}. L’offre étant limitée, un dépôt de <strong style="${S.strong}">200 USD</strong> est requis pour la garantir. Il reste <strong style="${S.strong}">entièrement remboursable jusqu'à 30 jours</strong> avant votre arrivée.`;
            }
            emailContent += `<div style="${S.card}"><h2 style="${S.h2}">Promotion et Dépôt</h2><p style="${S.p}">${promoText}</p><p style="margin:1em 0 0 0; font-size:14px; color:${C.textLight};"><i>Les prix Disney sont en USD et sujets à changement.</i></p></div>`;

            // --- FLIGHTS SECTION ---
            if (data.include_flights) {
                let flightDetailsHtml = `<h2 style="${S.h2}">Proposition de Vols</h2>`;
                flightDetailsHtml += `<p style="${S.p}"><strong style="${S.strong}">Aller :</strong> ${formatDateFR(data.departure_date_aller)} à ${formatTime(data.departure_time_aller)} de ${data.departure_airport_aller || 'N/A'} vers ${data.arrival_airport_aller || 'N/A'}</p>`;
                flightDetailsHtml += `<p style="${S.p}"><strong style="${S.strong}">Retour :</strong> ${formatDateFR(data.departure_date_retour)} à ${formatTime(data.departure_time_retour)} de ${data.departure_airport_retour || 'N/A'} vers ${data.arrival_airport_retour || 'N/A'}</p>`;
                if (data.flight_notes) {
                    flightDetailsHtml += `<div style="margin-top:20px; padding:15px; background-color:#f8f9fa; border-left:4px solid ${C.accent};"><p style="margin:0; font-size:15px; color:${C.textLight};"><strong>Notes importantes :</strong><br>${data.flight_notes.replace(/\n/g, '<br>')}</p></div>`;
                }
                flightDetailsHtml += `<p style="${S.p} margin-top:1.5em;"><strong style="${S.strong}">Prix total approximatif :</strong> ${data.flight_price || 'N/A'} CAD</p>`;
                flightDetailsHtml += `<p style="margin:1em 0 0 0; font-size:14px; color:${C.textLight};"><i>Les tarifs aériens sont dynamiques et peuvent changer. Des frais de service de 50$ CAD/pers s'appliquent pour la réservation des vols.</i></p>`;
                emailContent += `<div style="${S.card}">${flightDetailsHtml}</div>`;
            }

            // --- CLOSING & CTA ---
            emailContent += `
                <div style="${S.card} text-align:center;">
                    <h2 style="${S.h2} text-align:center;">Prêt pour la suite ?</h2>
                    <p style="${S.p} text-align:center;">Je suis à votre entière disposition pour répondre à toutes vos questions et affiner chaque détail. N'hésitez pas !</p>
                    <div style="margin-top:25px; text-align:center;">
                        <a href="mailto:votre.email@agence.com?subject=Re: Votre voyage Disney" style="${S.button}">Poser une question ou réserver</a>
                    </div>
                </div>
            `;
            
            // --- FINAL HTML ASSEMBLY ---
            return `
                <!DOCTYPE html>
                <html lang="fr">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Votre Soumission de Voyage Disney</title>
                </head>
                <body style="${S.body}">
                    <table width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation">
                        <tr>
                            <td align="center" style="padding:20px 0;">
                                <table border="0" cellpadding="0" cellspacing="0" style="${S.wrapper}" role="presentation">
                                    <tr>
                                        <td style="${S.header}">
                                            <p style="${S.preheader}">Votre soumission de voyage Disney</p>
                                            <h1 style="${S.headerTitle}">Votre Rêve Prend Forme</h1>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 0 10px;">${emailContent}</td>
                                    </tr>
                                    <tr>
                                        <td style="${S.footer}">
                                            Pierre-Luc Morin | Conseiller en Voyages<br>
                                            Voyages en Route<br>
                                            819-347-9103
                                        </td>
                                    </tr>
                                </table>
                                </td>
                        </tr>
                    </table>
                </body>
                </html>`;
        }


        // --- Le reste du script JS pour le formulaire reste identique ---
        document.addEventListener('DOMContentLoaded', function() {
            const hotelSelectionsDiv = document.getElementById('hotel_selections');
            const addHotelButton = document.getElementById('add_hotel_button');
            let hotelCounter = 0;

            function createHotelSelector() {
                hotelCounter++;
                const groupDiv = document.createElement('div');
                groupDiv.classList.add('hotel-option-group');
                groupDiv.id = `hotel_group_${hotelCounter}`;
                
                let content = `
                    <div class="hotel-option-header">
                        <label>Option d'hôtel</label>
                        <button type="button" class="remove-hotel-button" title="Supprimer cet hôtel">Supprimer</button>
                    </div>
                    <select name="hotel_name" required>
                        <option value="" disabled selected>Sélectionnez un hôtel</option>
                        ${DISNEY_HOTELS.sort((a,b) => a.name.localeCompare(b.name)).map(hotel => `<option value="${hotel.name}">${hotel.name}</option>`).join('')}
                    </select>
                    <label for="hotel_price_${hotelCounter}">Prix (USD) :</label>
                    <input type="number" name="hotel_price" id="hotel_price_${hotelCounter}" placeholder="Ex: 4500.50" step="0.01">
                    <label for="hotel_pros_${hotelCounter}">Les plus de cet hôtel (un par ligne) :</label>
                    <textarea name="hotel_pros" id="hotel_pros_${hotelCounter}" placeholder="Ex: Accès au Skyliner\nPiscine exceptionnelle"></textarea>
                `;
                groupDiv.innerHTML = content;

                groupDiv.querySelector('.remove-hotel-button').addEventListener('click', function() {
                    groupDiv.remove();
                    updateAddHotelButtonState();
                });

                return groupDiv;
            }

            function updateAddHotelButtonState() {
                const currentHotelSelectors = hotelSelectionsDiv.querySelectorAll('.hotel-option-group').length;
                addHotelButton.disabled = currentHotelSelectors >= 5;
                addHotelButton.textContent = currentHotelSelectors >= 5 ? "Maximum 5 hôtels atteints" : "Ajouter une option d'hôtel";
            }

            addHotelButton.addEventListener('click', function() {
                if (hotelSelectionsDiv.querySelectorAll('.hotel-option-group').length < 5) {
                    hotelSelectionsDiv.appendChild(createHotelSelector());
                    updateAddHotelButtonState();
                }
            });

            // Start with one hotel selector
            hotelSelectionsDiv.appendChild(createHotelSelector());
            updateAddHotelButtonState();
            
            const form = document.getElementById('disneyForm');
            const emailOutputDiv = document.getElementById('emailOutput');
            
            form.addEventListener('submit', function(event) {
                event.preventDefault();
                const formData = new FormData(form);
                const data = {};
                for (let [key, value] of formData.entries()) {
                    if (!key.startsWith('hotel_')) {
                        data[key] = value;
                    }
                }
                data.include_flights = formData.has('include_flights');
                
                data.hotels = [];
                const hotelGroups = hotelSelectionsDiv.querySelectorAll('.hotel-option-group');
                hotelGroups.forEach(group => {
                    const name = group.querySelector('select[name="hotel_name"]').value;
                    const price = group.querySelector('input[name="hotel_price"]').value;
                    const pros = group.querySelector('textarea[name="hotel_pros"]').value;
                    if(name) {
                        const hotelData = getHotelByName(name);
                        data.hotels.push({
                            name: name,
                            description: hotelData ? hotelData.description : "Description non trouvée.",
                            price: price,
                            pros: pros
                        });
                    }
                });
                
                const emailHtmlContent = generateEmailHTML(data);
                emailOutputDiv.innerHTML = emailHtmlContent;
            });

            const copyHtmlButton = document.getElementById('copyHtmlButton');
            copyHtmlButton.addEventListener('click', function() {
                const emailContent = emailOutputDiv.innerHTML;
                 navigator.clipboard.writeText(emailContent).then(function() {
                    alert('Contenu HTML de l\'e-mail copié dans le presse-papiers !');
                }, function(err) {
                    alert('Erreur lors de la copie. Veuillez essayer manuellement.');
                    console.error('Could not copy text: ', err);
                });
            });
            
            const includeFlightsCheckbox = document.getElementById('include_flights');
            const flightDetailsDiv = document.getElementById('flight_details');
            const bookingTypeSelect = document.getElementById('booking_type');
            const hotelOptionsContainer = document.getElementById('hotel_options_container');
            const promotionTypeSelect = document.getElementById('promotion_type');
            const promotionDetailsDiv = document.getElementById('promotion_details');
            
            function toggleFlightDetails() { flightDetailsDiv.classList.toggle('hidden', !includeFlightsCheckbox.checked); }
            function toggleHotelOptions() { hotelOptionsContainer.classList.toggle('hidden', bookingTypeSelect.value !== 'hotel_tickets'); }
            function togglePromotionDetails() { promotionDetailsDiv.classList.toggle('hidden', promotionTypeSelect.value !== 'specifique'); }

            includeFlightsCheckbox.addEventListener('change', toggleFlightDetails);
            bookingTypeSelect.addEventListener('change', toggleHotelOptions);
            promotionTypeSelect.addEventListener('change', togglePromotionDetails);
            
            toggleFlightDetails();
            toggleHotelOptions();
            togglePromotionDetails();
        });
    </script>
</body>
</html>
