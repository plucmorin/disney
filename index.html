<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur d'e-mail Disney (Version Finale)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; margin: 20px; background-color: #f4f4f4; color: #333; line-height: 1.6; }
        .container { background-color: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 900px; margin: auto;}
        h1 { text-align: center; margin-bottom: 30px; color: #0078C1; font-weight: 700;}
        h2 { margin-top: 25px; color: #0078C1; border-bottom: 2px solid #eee; padding-bottom: 8px;}
        label { display: block; margin-top: 15px; font-weight: 600; color: #333; }
        input[type="text"], input[type="number"], input[type="date"], input[type="time"], select, textarea {
            width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 1em;
        }
        textarea { resize: vertical; min-height: 80px; }
        input[type="checkbox"] { margin-right: 8px; vertical-align: middle; width: auto; }
        button, .remove-hotel-button {
            background-color: #007bff; color: white; padding: 12px 20px;
            border: none; border-radius: 6px; cursor: pointer; margin-top: 20px; font-size: 1.05em; font-weight: 500;
        }
        button:hover { background-color: #0056b3; }
        .remove-hotel-button { background-color: #dc3545; padding: 5px 10px; font-size: 0.9em; margin-left: 10px; margin-top: 0;}
        .form-section { border: 1px solid #e9ecef; padding: 20px; margin-bottom: 25px; border-radius: 8px; background-color: #fdfdfd; }
        .hotel-option-group { border: 1px solid #e0e0e0; padding: 15px; margin-top: 15px; border-radius: 8px; background-color: #fafafa; }
        .hotel-option-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .hidden { display: none; }
        #emailOutputContainer { margin-top: 30px; }
        #emailOutput { padding: 20px; border: 1px solid #ccc; background-color: #f0f2f5; border-radius: 8px; min-height: 200px; overflow-x: auto;}
        .flight-inputs { border: 1px solid #ddd; border-radius: 8px; padding: 10px 15px 15px 15px; margin-top:10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>G√©n√©rateur d'e-mail Disney</h1>
        <form id="disneyForm">
            <div class="form-section">
                <h2>Informations G√©n√©rales</h2>
                <label for="client_name">Nom de la personne cliente&nbsp;:</label>
                <input type="text" id="client_name" name="client_name" placeholder="Entrez le nom du client" required>
                <label for="adults">Nombre d'adultes&nbsp;:</label>
                <input type="number" id="adults" name="adults" min="1" value="2" required>
                <label for="children">Nombre d'enfants (0 si aucun)&nbsp;:</label>
                <input type="number" id="children" name="children" min="0" value="0" required>
            </div>
            <div class="form-section">
                <h2>H√©bergement et Billets</h2>
                <label for="booking_type">Type de r√©servation&nbsp;:</label>
                <select id="booking_type" name="booking_type">
                    <option value="hotel_tickets">H√¥tel + Billets</option>
                    <option value="tickets_only">Billets seulement</option>
                </select>
                <div id="hotel_options_container">
                    <div id="hotel_selections"></div>
                    <button type="button" id="add_hotel_button">Ajouter une option d'h√¥tel</button>
                </div>
            </div>
            <div class="form-section">
                <h2>Vols</h2>
                <label><input type="checkbox" id="include_flights" name="include_flights"> Inclure les vols&nbsp;?</label>
                <div id="flight_details" class="hidden">
                    <div class="flight-inputs">
                        <h3>Vol Aller</h3>
                        <label for="departure_date_aller">Date de d√©part (Aller)&nbsp;:</label>
                        <input type="date" id="departure_date_aller" name="departure_date_aller">
                        <label for="departure_time_aller">Heure de d√©part (Aller)&nbsp;:</label>
                        <input type="time" id="departure_time_aller" name="departure_time_aller">
                        <label for="departure_airport_aller">A√©roport de d√©part (Aller)&nbsp;:</label>
                        <input type="text" id="departure_airport_aller" name="departure_airport_aller" placeholder="Ex: YUL - Montr√©al">
                        <label for="arrival_airport_aller">A√©roport d'arriv√©e (Aller)&nbsp;:</label>
                        <input type="text" id="arrival_airport_aller" name="arrival_airport_aller" placeholder="Ex: MCO - Orlando" value="MCO - Orlando">
                        <label for="arrival_date_aller">Date d'arriv√©e (Aller)&nbsp;:</label>
                        <input type="date" id="arrival_date_aller" name="arrival_date_aller">
                        <label for="arrival_time_aller">Heure d'arriv√©e (Aller)&nbsp;:</label>
                        <input type="time" id="arrival_time_aller" name="arrival_time_aller">
                        <label for="airline_aller">Compagnie A√©rienne (Aller)&nbsp;:</label>
                        <input type="text" id="airline_aller" name="airline_aller" placeholder="Ex: Air Canada">
                        <label for="flight_number_aller">Num√©ro de vol (Aller)&nbsp;:</label>
                        <input type="text" id="flight_number_aller" name="flight_number_aller" placeholder="Ex: AC1676">
                    </div>
                     <div class="flight-inputs">
                        <h3>Vol Retour</h3>
                        <label for="departure_date_retour">Date de d√©part (Retour)&nbsp;:</label>
                        <input type="date" id="departure_date_retour" name="departure_date_retour">
                        <label for="departure_time_retour">Heure de d√©part (Retour)&nbsp;:</label>
                        <input type="time" id="departure_time_retour" name="departure_time_retour">
                        <label for="departure_airport_retour">A√©roport de d√©part (Retour)&nbsp;:</label>
                        <input type="text" id="departure_airport_retour" name="departure_airport_retour" placeholder="Ex: MCO - Orlando" value="MCO - Orlando">
                        <label for="arrival_airport_retour">A√©roport d'arriv√©e (Retour)&nbsp;:</label>
                        <input type="text" id="arrival_airport_retour" name="arrival_airport_retour" placeholder="Ex: YUL - Montr√©al">
                        <label for="arrival_date_retour">Date d'arriv√©e (Retour)&nbsp;:</label>
                        <input type="date" id="arrival_date_retour" name="arrival_date_retour">
                        <label for="arrival_time_retour">Heure d'arriv√©e (Retour)&nbsp;:</label>
                        <input type="time" id="arrival_time_retour" name="arrival_time_retour">
                        <label for="airline_retour">Compagnie A√©rienne (Retour)&nbsp;:</label>
                        <input type="text" id="airline_retour" name="airline_retour" placeholder="Ex: Air Canada">
                        <label for="flight_number_retour">Num√©ro de vol (Retour)&nbsp;:</label>
                        <input type="text" id="flight_number_retour" name="flight_number_retour" placeholder="Ex: AC1677">
                    </div>
                    <label for="flight_price">Prix total approximatif des vols (CAD)&nbsp;:</label>
                    <input type="number" id="flight_price" name="flight_price" step="0.01">
                    <label for="flight_notes">Notes sur les vols&nbsp;:</label>
                    <textarea id="flight_notes" name="flight_notes" placeholder="Ajoutez ici des d√©tails importants (ex: compagnie, escale, type de bagages inclus...)"></textarea>
                </div>
            </div>
            <div class="form-section">
                <h2>Promotion</h2>
                <label for="promotion_type">Type de promotion&nbsp;:</label>
                <select id="promotion_type" name="promotion_type">
                    <option value="aucune">Aucune promotion pour l'instant</option>
                    <option value="specifique">Promotion sp√©cifique</option>
                </select>
                <div id="promotion_details" class="hidden">
                    <label for="promotion_name">Nom de la promotion&nbsp;:</label>
                    <input type="text" id="promotion_name" name="promotion_name" placeholder="Nom de la promotion (ex: Rabais estival)">
                    <label for="promotion_end_date">Date de fin de la promotion (si applicable)&nbsp;:</label>
                    <input type="date" id="promotion_end_date" name="promotion_end_date">
                </div>
            </div>
            <button type="submit">G√©n√©rer l'e-mail</button>
        </form>

        <div id="emailOutputContainer">
            <h2>E-mail G√©n√©r√© (Pr√™t √† copier)</h2>
            <div id="emailOutput" contenteditable="true"></div>
            <button type="button" id="copyHtmlButton">Copier le contenu de l'e-mail</button>
        </div>
    </div>

    <script>
        const DISNEY_HOTELS = [
             // Deluxe Villas
            { name: "Bay Lake Tower at Contemporary", description: "Ce croissant de lune moderne adjacent au Contemporary offre des villas luxueuses et une vue imprenable sur Magic Kingdom. Son sky-bridge le connecte directement √† l'h√¥tel principal et au monorail.", level: "Deluxe Villa", pointsForts: ["Distance de marche de Magic Kingdom", "Acc√®s √† la ligne du monorail", "Vues spectaculaires sur les feux d'artifice", "Piscine priv√©e avec glissade d'eau"] },
            { name: "Villas at Grand Floridian", description: "Le summum du luxe et de l'√©l√©gance victorienne dans un format de villa spacieuse. Profitez du service impeccable et des restaurants prim√©s du Grand Floridian, le tout sur la ligne du monorail.", level: "Deluxe Villa", pointsForts: ["H√©bergement le plus luxueux de Disney", "Restaurants gastronomiques sur place", "Spa Senses de classe mondiale", "Acc√®s direct au monorail"] },
            { name: "Polynesian Villas & Bungalows", description: "√âvadez-vous dans un paradis tropical avec ces villas et bungalows sur l'eau. L'ambiance des √Æles du Pacifique Sud, la vue sur le lagon et l'acc√®s au monorail en font une escapade de r√™ve.", level: "Deluxe Villa", pointsForts: ["Bungalows uniques sur pilotis", "Ambiance tropicale immersive", "Situ√© sur la ligne du monorail", "Excellents restaurants th√©matiques ('Ohana)"] },
            { name: "BoardWalk Villas", description: "Revivez le charme d'une promenade c√¥ti√®re du d√©but du XXe si√®cle. Ces villas offrent un acc√®s direct √† l'animation effervescente du BoardWalk, avec ses restaurants, boutiques et spectacles de rue.", level: "Deluxe Villa", pointsForts: ["Distance de marche de EPCOT et Hollywood Studios", "Vie nocturne et restaurants sur le BoardWalk", "Piscine Luna Park sur le th√®me du cirque", "Service de bateau-taxi (Friendship)"] },
            { name: "Beach Club Villas", description: "Profitez de l'ambiance d√©contract√©e d'une villa de la Nouvelle-Angleterre. Le point d'orgue est Stormalong Bay, un incroyable complexe aquatique de 3 acres avec fond de sable et rivi√®re tranquille.", level: "Deluxe Villa", pointsForts: ["Acc√®s √† la meilleure piscine de Disney World", "√Ä quelques pas de l'entr√©e d'EPCOT", "Atmosph√®re baln√©aire relaxante", "Restaurant populaire Beaches & Cream"] },
            { name: "Riviera Resort", description: "Inspir√© par l'√©l√©gance de la Riviera europ√©enne, cet h√¥tel sophistiqu√© allie le glamour europ√©en √† la magie de Disney. Ses studios et villas offrent des vues magnifiques et une d√©coration raffin√©e.", level: "Deluxe Villa", pointsForts: ["Station principale du Disney Skyliner", "Restaurant sur le toit avec personnages (Topolino's)", "Design europ√©en √©l√©gant et artistique", "Piscines magnifiques et jeux d'eau"] },
            { name: "Wilderness Lodge - Copper Creek Villas", description: "Inspir√©es par l'h√©ritage ferroviaire du Nord-Ouest Pacifique, ces villas et cabines au bord de l'eau offrent une touche de luxe moderne dans un cadre rustique et sauvage.", level: "Deluxe Villa", pointsForts: ["Cabines priv√©es luxueuses au bord du lac", "Piscine th√©matique avec geyser", "Ambiance √† la fois rustique et moderne", "Acc√®s par bateau-taxi √† Magic Kingdom"] },
            { name: "Wilderness Lodge - Boulder Ridge Villas", description: "Adjacent au lodge principal, ce b√¢timent √©voque le charme des g√Ætes des parcs nationaux de l'Ouest am√©ricain. Une ambiance chaleureuse et rustique, parfaite pour une retraite paisible.", level: "Deluxe Villa", pointsForts: ["Atmosph√®re calme et plus intime", "Th√®me des parcs nationaux am√©ricains", "Acc√®s facile aux commodit√©s du lodge", "Feu de camp et activit√©s ext√©rieures"] },
            { name: "Animal Kingdom Lodge - Jambo House Villas", description: "Vivez une exp√©rience immersive dans le b√¢timent principal d'Animal Kingdom Lodge. Le lobby grandiose et les vues directes sur la savane depuis certaines villas sont inoubliables.", level: "Deluxe Villa", pointsForts: ["Vues imprenables sur la savane animali√®re", "Lobby spectaculaire et collection d'art africain", "Acc√®s aux restaurants prim√©s (Jiko, Boma)", "Piscine Uzima avec vue sur les animaux"] },
            { name: "Animal Kingdom Lodge - Kidani Village", description: "Ce b√¢timent d√©di√© aux villas offre une ambiance plus calme et des vues √©tendues sur la savane. Id√©al pour les familles qui souhaitent plus d'espace et une cuisine compl√®te.", level: "Deluxe Villa", pointsForts: ["Excellent pour l'observation des animaux", "Piscine Samawati avec glissades et jeux d'eau", "Restaurant Sanaa avec vue sur la savane", "Villas spacieuses avec cuisines compl√®tes"] },
            { name: "Saratoga Springs Resort & Spa", description: "Inspir√© par la ville thermale historique de Saratoga Springs, ce complexe de style victorien propose des villas, un spa complet, et un acc√®s facile √† Disney Springs par bateau ou √† pied.", level: "Deluxe Villa", pointsForts: ["Distance de marche de Disney Springs", "Treehouse Villas uniques en leur genre", "Parcours de golf sur place (Lake Buena Vista)", "Ambiance de station thermale relaxante"] },
            { name: "Old Key West Resort", description: "√âvoquant l'ambiance d√©contract√©e de Key West, ce vaste complexe propose des villas parmi les plus spacieuses du site, de magnifiques fairways et une atmosph√®re de communaut√© insulaire.", level: "Deluxe Villa", pointsForts: ["Villas extr√™mement spacieuses", "Ambiance d√©contract√©e et luxuriante", "Restaurant Olivia's Caf√© (un classique)", "Transport par bateau vers Disney Springs"] },

            // Deluxe Resorts
            { name: "Contemporary Resort", description: "Iconique et ultra-moderne, cet h√¥tel en forme de A est le seul o√π le monorail passe directement √† l'int√©rieur. Il est si proche de Magic Kingdom que vous pouvez y aller √† pied.", level: "Deluxe", pointsForts: ["Le plus proche de Magic Kingdom (√† pied)", "Le monorail traverse le lobby de l'h√¥tel", "Restaurant sur le toit (California Grill)", "Design moderne et vues exceptionnelles"] },
            { name: "Grand Floridian Resort & Spa", description: "L'h√¥tel le plus luxueux et embl√©matique de Disney. Son √©l√©gance victorienne, son service impeccable, son spa de renomm√©e mondiale et sa proximit√© avec Magic Kingdom en font le summum du luxe.", level: "Deluxe", pointsForts: ["Service 5 √©toiles et √©l√©gance victorienne", "Spa Senses de classe mondiale", "Restaurants gastronomiques (Victoria & Albert's)", "Sur la ligne du monorail vers Magic Kingdom"] },
            { name: "Polynesian Village Resort", description: "Une escapade tropicale luxuriante qui vous transporte dans les √Æles du Pacifique Sud. Profitez de son ambiance exotique, de sa plage de sable blanc avec vue sur le ch√¢teau et de son acc√®s direct au monorail.", level: "Deluxe", pointsForts: ["Ambiance des √Æles du Pacifique Sud", "Vue sur les feux d'artifice de Magic Kingdom", "Acc√®s au monorail et aux bateaux-taxis", "Restaurant populaire 'Ohana"] },
            { name: "Wilderness Lodge", description: "Inspir√© des grands lodges des parcs nationaux am√©ricains, ce complexe majestueux est un chef-d'≈ìuvre d'artisanat. Son lobby spectaculaire avec une chemin√©e de 82 pieds et son geyser en font une destination en soi.", level: "Deluxe", pointsForts: ["Lobby et architecture spectaculaires", "Ambiance immersive de parc national", "Transport par bateau vers Magic Kingdom", "Piscine avec geyser 'Fire Rock'"] },
            { name: "Yacht Club Resort", description: "Plongez dans l'√©l√©gance nautique d'un club de yacht de la Nouvelle-Angleterre. Son atmosph√®re est plus formelle que son h√¥tel jumeau, le Beach Club, avec qui il partage l'exceptionnelle piscine Stormalong Bay.", level: "Deluxe", pointsForts: ["Partage l'acc√®s √† la piscine Stormalong Bay", "Restaurant signature (Yachtsman Steakhouse)", "Atmosph√®re nautique et raffin√©e", "Distance de marche d'EPCOT"] },
            { name: "Beach Club Resort", description: "Avec son ambiance d√©contract√©e de station baln√©aire de la Nouvelle-Angleterre, cet h√¥tel est un favori des familles. Son atout majeur est l'acc√®s √† Stormalong Bay, un mini parc aquatique avec fond de sable.", level: "Deluxe", pointsForts: ["Acc√®s au complexe aquatique Stormalong Bay", "Le plus pr√®s de l'entr√©e d'EPCOT (√† pied)", "Ambiance familiale et ensoleill√©e", "Glaces et repas au Beaches & Cream"] },
            { name: "BoardWalk Inn", description: "Cet h√¥tel charmant vous transporte sur une promenade c√¥ti√®re des ann√©es 1920. Le soir, le 'Boardwalk' s'anime avec ses restaurants, ses artistes de rue et sa vie nocturne, le tout √† quelques pas d'EPCOT.", level: "Deluxe", pointsForts: ["Acc√®s √† pied √† EPCOT et Hollywood Studios", "Promenade anim√©e avec restaurants et spectacles", "Piscine 'Luna Park' sur le th√®me du carnaval", "√âl√©gance d'une √©poque r√©volue"] },
            { name: "Animal Kingdom Lodge", description: "√âvadez-vous dans un lodge africain authentique o√π l'aventure vous attend √† votre fen√™tre. Cet h√¥tel majestueux est entour√© de savanes luxuriantes, offrant des vues sur plus de 30 esp√®ces d'animaux.", level: "Deluxe", pointsForts: ["Vues spectaculaires sur la savane animali√®re", "Collection d'art africain de calibre mondial", "Restaurants th√©matiques exceptionnels (Jiko, Boma)", "Immersion culturelle unique"] },
            
            // Moderate Resorts
            { name: "Coronado Springs Resort", description: "Ce complexe tentaculaire allie une architecture coloniale espagnole √† l'√©l√©gance moderne de la tour Gran Destino. Il offre des commodit√©s de luxe √† un prix de cat√©gorie mod√©r√©e.", level: "Moderate", pointsForts: ["Ambiance de luxe √† prix mod√©r√©", "Options de restauration vari√©es et excellentes", "Piscine 'The Lost City of Cibola' avec pyramide", "La tour Gran Destino offre des chambres modernes"] },
            { name: "Caribbean Beach Resort", description: "√âvadez-vous dans l'ambiance color√©e et tropicale des Cara√Øbes. Ce resort tentaculaire est le hub central du Disney Skyliner, offrant un transport rapide et amusant vers deux parcs.", level: "Moderate", pointsForts: ["Hub principal du Disney Skyliner", "Piscine th√©matique 'Fuentes del Morro'", "Chambres sur le th√®me des pirates", "Ambiance de vacances tropicales"] },
            { name: "Port Orleans - French Quarter", description: "Ce charmant h√¥tel √©voque les rues pav√©es et les balcons en fer forg√© du Vieux Carr√© de La Nouvelle-Orl√©ans. Sa petite taille le rend intime et facile √† parcourir, avec un seul arr√™t d'autobus.", level: "Moderate", pointsForts: ["H√¥tel le plus compact et intime", "Beignets Mickey frais et d√©licieux", "Ambiance jazz et romantique", "Service de bateau-taxi vers Disney Springs"] },
            { name: "Port Orleans - Riverside", description: "Explorez les bayous rustiques de la Louisiane ou les manoirs √©l√©gants du Sud. Ce vaste complexe offre une grande vari√©t√© de paysages et une atmosph√®re paisible au bord de la rivi√®re.", level: "Moderate", pointsForts: ["Choix entre manoirs ou cabanes rustiques", "Chambres th√©matiques 'Royal Rooms'", "Atmosph√®re relaxante au bord de la rivi√®re", "Activit√©s comme la p√™che et les cal√®ches"] },
            { name: "The Cabins at Fort Wilderness", description: "Offrant une v√©ritable immersion dans la nature, ces cabines rustiques sont nich√©es dans une for√™t de 750 acres. Chaque cabine peut loger jusqu‚Äô√† six personnes et dispose d'une cuisine compl√®te.", level: "Moderate", pointsForts: ["Cuisine compl√®te et barbecue priv√©", "Immersion totale dans la nature", "Nombreuses activit√©s r√©cr√©atives", "Peut accueillir jusqu'√† 6 personnes"] },
            
            // Value Resorts
            { name: "Art of Animation Resort", description: "Plongez litt√©ralement dans les mondes de N√©mo, Cars, Le Roi Lion et La Petite Sir√®ne. Cet h√¥tel est c√©l√®bre pour ses suites familiales immersives et sa piscine 'Big Blue', la plus grande de Disney World.", level: "Value", pointsForts: ["Suites familiales th√©matiques (jusqu'√† 6 pers.)", "La plus grande piscine de tout Disney World", "Station d√©di√©e sur le Disney Skyliner", "D√©cors et personnages g√©ants spectaculaires"] },
            { name: "Pop Century Resort", description: "Voyagez √† travers les d√©cennies marquantes du XXe si√®cle. Cet h√¥tel est l'un des favoris pour son excellent rapport qualit√©-prix et son acc√®s direct et rapide au Disney Skyliner.", level: "Value", pointsForts: ["Acc√®s direct au Disney Skyliner", "Excellent rapport qualit√©-prix", "R√©cemment r√©nov√© avec lits queen", "Ambiance nostalgique et amusante"] },
            { name: "All-Star Movies Resort", description: "Vibrez au rythme des classiques du cin√©ma Disney dans cet h√¥tel aux d√©cors spectaculaires. Id√©al pour les familles, chaque b√¢timent est une c√©l√©bration de films comme Fantasia ou Toy Story.", level: "Value", pointsForts: ["Th√©matisation immersive et ic√¥nes g√©antes", "L'une des options les plus abordables sur site", "Grande aire de restauration 'World Premiere'", "Piscine sur le th√®me de Fantasia"] },
            { name: "All-Star Music Resort", description: "C√©l√©brez tous les genres musicaux, du calypso au rock'n'roll. C'est le seul h√¥tel 'All-Star' √† proposer des suites familiales, une option √©conomique pour les grands groupes.", level: "Value", pointsForts: ["Propose des suites familiales abordables", "Piscine principale en forme de guitare", "Th√®me musical entra√Ænant et amusant", "Excellent choix pour les fanfares scolaires"] },
            { name: "All-Star Sports Resort", description: "Pour les amateurs de sport, cet h√¥tel est un terrain de jeu g√©ant. Les ic√¥nes surdimensionn√©es de ballons de football, de battes de baseball et de planches de surf cr√©ent une atmosph√®re √©nergique.", level: "Value", pointsForts: ["Th√®me sportif et dynamique", "Parfait pour les groupes sportifs de jeunes", "Tarifs parmi les plus bas de Disney", "Aires de jeux sur le th√®me du sport"] }
        ];

        function getHotelByName(name) { return DISNEY_HOTELS.find(hotel => hotel.name === name); }
        function formatDateFR(dateStr) { if (!dateStr) return ""; try { const date = new Date(dateStr + 'T00:00:00'); const options = { year: 'numeric', month: 'long', day: 'numeric' }; return date.toLocaleDateString('fr-FR', options); } catch (e) { return dateStr; } }
        function formatTime(timeStr) { if (!timeStr) return ""; try { const [hours, minutes] = timeStr.split(':'); return `${String(hours).padStart(2, '0')}h${String(minutes).padStart(2, '0')}`; } catch (e) { return timeStr; } }

        function generateEmailHTML(data) {
             const C = {
                blue: '#0078C1',
                blueDark: '#005a9c',
                orange: '#FF7F50',
                textDark: '#222222',
                textLight: '#555555',
                border: '#EAEAEA',
                background: '#f0f2f5',
                white: '#FFFFFF',
                blueLight: '#e6f2fa',
                orangeLight: '#fff4e6',
                level: { value: '#28a745', moderate: '#2196F3', deluxe: '#6f42c1', deluxe_villa: '#9C27B0' },
                tags: ['#0078C1', '#5A67D8', '#d9480f', '#0ca678']
            };

            const S = {
                fontStack: `Arial, Helvetica, sans-serif`,
                p: `font-family: Arial, Helvetica, sans-serif; font-size: 16px; line-height: 1.6; color: ${C.textDark}; margin: 1em 0; text-align: justify;`,
                strong: `font-weight: bold;`,
                italic: `font-style: italic;`,
            };
            
            function createBanner(text, type = 'main') {
                let style, titleStyle, wrapperStyle;
                switch (type) {
                    case 'closing': style = `background-color: ${C.orange}; padding: 12px 30px;`; titleStyle = `font-family: Georgia, serif; font-size: 24px; color: ${C.white}; font-weight: bold; text-transform: uppercase; margin: 0; text-align: center; letter-spacing: 1px;`; wrapperStyle = `padding: 5px 0;`; break;
                    case 'sub': style = `background-color: ${C.blue}; padding: 10px 30px;`; titleStyle = `font-family: ${S.fontStack}; font-size: 20px; color: ${C.white}; font-weight: bold; text-transform: uppercase; margin: 0; text-align: center;`; wrapperStyle = `padding: 0;`; break;
                    case 'main': default: style = `background: linear-gradient(to right, ${C.blue}, ${C.blueDark}); padding: 25px 30px;`; titleStyle = `font-family: Georgia, serif; font-size: 32px; color: ${C.white}; font-weight: bold; text-transform: uppercase; margin: 0; text-align: center; letter-spacing: 1.5px; line-height:1.2;`; wrapperStyle = `border-top: 1px solid rgba(255,255,255,0.3); border-bottom: 1px solid rgba(255,255,255,0.3); padding: 10px 0;`; break;
                }
                return `<tr><td style="${style}"><div style="${wrapperStyle}"><h1 style="${titleStyle}">${text}</h1></div></td></tr>`;
            }
            
            function createCalloutBox(title, text, color) {
                return `<table width="100%" border="0" cellpadding="0" cellspacing="0" style="margin-top:20px;"><tr><td style="padding: 20px 25px; background-color: ${C[`${color}Light`]}; border-left: 5px solid ${C[color]}; border-radius: 0 8px 8px 0;"><h2 style="font-family:${S.fontStack}; font-size:18px; color:${C[color]}; margin:0 0 10px 0; font-weight:bold;">${title}</h2><p style="font-family:${S.fontStack}; margin:0; text-align:justify;">${text}</p></td></tr></table>`;
            }

            const T = {
                banner1: "Votre Aventure Magique Commence Ici",
                greeting: `Bonjour <strong style="${S.strong}">${data.client_name || 'estim√©(e) voyageur(se)'}</strong>,`,
                intro1: `Je vous √©cris au nom de Voyages en Route, o√π nous avons le plaisir d‚Äôaccompagner les familles et voyageurs dans la planification de leurs s√©jours. Je m'appelle Pierre-Luc Morin et je serais votre conseiller en voyages sp√©cialis√© en destinations <strong style="${S.strong}">Disney et Universal</strong>.`,
                intro2: `Merci de nous avoir confi√© votre projet de voyage. J‚Äôai pris soin de pr√©parer une proposition bas√©e sur les crit√®res que vous avez partag√©s dans votre demande. Cette soumission est <strong style="${S.strong}">ajustable</strong>, et je serai heureux d‚Äôexplorer avec vous diff√©rentes options afin de vous cr√©er une exp√©rience <strong style="${S.strong}">propre √† vous et inoubliable</strong>.`,
                disney_advantages_intro: `S√©journer dans un h√¥tel Disney, c‚Äôest profiter d‚Äôun univers immersif du matin au soir, mais aussi de <strong style="${S.strong}">nombreux avantages exclusifs</strong>&nbsp;:</p>`,
                disney_advantages_list_items: [
                    `<strong style="${S.strong}">L‚ÄôEarly Theme Park Entry</strong>, pour acc√©der aux parcs avant l‚Äôouverture officielle&nbsp;;`,
                    `Le <strong style="${S.strong}">transport gratuit</strong> vers tous les parcs et sites Disney (excluant les transferts a√©roports)&nbsp;;`,
                    `L‚Äô<strong style="${S.strong}">acc√®s simplifi√©</strong> aux r√©servations avec l‚Äôapplication Disney Experience&nbsp;;`,
                    `Et un <strong style="${S.strong}">service client exceptionnel</strong>, sign√© Disney, √† chaque √©tape de votre s√©jour.`
                ],
                disney_price_disclaimer: "Veuillez noter que tous les prix pour l'h√©bergement et les billets Disney sont indiqu√©s en dollars am√©ricains (USD) et sont sujets √† disponibilit√©.",
                tickets_only_price_disclaimer: "Veuillez noter que tous les prix des billets Disney sont indiqu√©s en dollars am√©ricains (USD) et sont sujets √† disponibilit√©.",
                banner_travel_fees: "Itin√©raire de Vol",
                flight_intro: "Pour compl√©ter votre voyage vers la magie, voici les d√©tails concernant le transport a√©rien que nous avons explor√©&nbsp;:",
                flight_price_info: `<em style="${S.italic}">Les prix sont √† titre indicatif et peuvent changer √† tout moment.</em>`,
                flight_important_label: `IMPORTANT`,
                flight_important_text: `Les tarifs a√©riens sont dynamiques et peuvent changer jusqu'√† la r√©servation. Des frais de service de <strong style="${S.strong}">50$ CAD par personne</strong> s'appliquent pour la r√©servation des vols via nos services. En me confiant vos vols, je m'occupe de tout d√©sagr√©ment potentiel. Si vous optez pour une r√©servation personnelle, ces frais ne s'appliquent pas, mais le support en cas de probl√®me avec les vols ne sera pas inclus pour cette portion.`,
                banner_magic_continues: "La Magie Continue...",
                closing1: `Prenez le temps de r√™ver √† ces options et de consid√©rer ce qui ferait de ce voyage une exp√©rience <strong style="${S.strong}">v√©ritablement inoubliable</strong>. Je suis √† votre <strong style="${S.strong}">enti√®re disposition</strong> pour r√©pondre √† toutes vos questions, affiner chaque d√©tail ou proc√©der √† la r√©servation de cette <em style="${S.italic}">aventure m√©morable</em>.`,
                closing2: `N'h√©sitez pas √† me joindre par courriel (en r√©pondant simplement √† celui-ci) ou par t√©l√©phone au <strong style="${S.strong}">819-347-9103</strong>. Merci de me faire savoir si le message a bien √©t√© re√ßu`,
                closing3: `Merci encore pour votre confiance. J'ai sinc√®rement h√¢te de transformer ce <strong style="${S.strong}">r√™ve Disney</strong> en une <strong style="${S.strong}">magnifique r√©alit√© pour vous&nbsp;!</strong>`
            };
            
            let introSection = `<p style="${S.p}">${T.greeting}</p><p style="${S.p}">${T.intro1}</p><p style="${S.p}">${T.intro2}</p>`;
            let hotelSection = '';
            const selectedHotels = data.hotels || [];

            if (data.booking_type === 'hotel_tickets' && selectedHotels.length > 0) {
if (selectedHotels.length === 1) {
                    const hotel = selectedHotels[0];
                    const levelColor = C.level[hotel.level.toLowerCase().replace(/ /g, '_')] || C.textLight;
                    
                    let prosList = `<span style="background-color:${levelColor}; color:${C.white}; padding: 5px 12px; margin: 0 8px 8px 0; border-radius: 15px; font-size: 14px; font-weight: bold; display:inline-block;">${hotel.level}</span>`;
                    hotel.pointsForts.forEach((p, i) => {
                        const tagColor = C.tags[i % C.tags.length];
                        prosList += `<span style="display:inline-block; background-color:${tagColor}; color:${C.white}; padding: 5px 12px; margin: 0 8px 8px 0; border-radius: 15px; font-size: 14px; font-weight: bold;">${p}</span>`;
                    });

                    let hotelCard = `
                        <div class="hotel-card" style="margin-top: 25px; border: 1px solid ${C.border}; border-radius: 8px;">
                            <div style="background-color:${C.blue}; color:${C.white}; padding:15px 20px; border-radius: 8px 8px 0 0;">
                                <strong style="font-family:${S.fontStack}; font-size:20px;">${hotel.name}</strong>
                            </div>
                            <div style="background-color:${C.white}; padding: 20px;">
                                <p style="font-family:${S.fontStack}; font-size:15px; line-height:1.5; color:${C.textLight}; margin:0 0 15px 0; text-align:justify;">${hotel.description}</p>
                                <div style="padding:10px 0;">${prosList}</div>
                            </div>
                            <div style="background-color:${C.blueLight}; padding: 15px 20px; text-align:center; border-radius: 0 0 8px 8px; border-top: 1px solid ${C.border};">
                                <span style="font-size:14px; color:${C.textLight}; font-weight:bold; text-transform:uppercase;">PRIX DU FORFAIT</span><br>
                                <strong style="font-size:28px; color:${C.textDark}; line-height:1.2;">${hotel.price ? hotel.price + '&nbsp;USD' : 'Voir PDF'}</strong>
                            </div>
                        </div>
                    `;
                    hotelSection += `<p style="${S.p}">Pour votre s√©jour, voici l'option que j'ai s√©lectionn√©e pour vous :</p>${hotelCard}`;
                } else {
                    hotelSection += `<p style="${S.p}">Voici plusieurs options d‚Äôh√©bergement pour votre s√©jour. Chaque proposition ci-dessous correspond √† un forfait d√©taill√© dans un document PDF distinct.</p>`;
                    let hotelCards = '';
                    selectedHotels.forEach(hotel => {
                        const levelColor = C.level[hotel.level.toLowerCase().replace(/ /g, '_')] || C.textLight;
                        
                        let prosList = `<span style="background-color:${levelColor}; color:${C.white}; padding: 5px 12px; margin: 0 8px 8px 0; border-radius: 15px; font-size: 14px; font-weight: bold; display:inline-block;">${hotel.level}</span>`;
                        hotel.pointsForts.forEach((p, i) => {
                            const tagColor = C.tags[i % C.tags.length];
                            prosList += `<span style="display:inline-block; background-color:${tagColor}; color:${C.white}; padding: 5px 12px; margin: 0 8px 8px 0; border-radius: 15px; font-size: 14px; font-weight: bold;">${p}</span>`;
                        });

                        hotelCards += `
                            <div class="hotel-card" style="margin-top: 25px; border: 1px solid ${C.border}; border-radius: 8px;">
                                <div style="background-color:${C.blue}; color:${C.white}; padding:15px 20px; border-radius: 8px 8px 0 0;">
                                    <strong style="font-family:${S.fontStack}; font-size:20px;">${hotel.name}</strong>
                                </div>
                                <div style="background-color:${C.white}; padding: 20px;">
                                    <p style="font-family:${S.fontStack}; font-size:15px; line-height:1.5; color:${C.textLight}; margin:0 0 15px 0; text-align:justify;">${hotel.description}</p>
                                    <div style="padding:10px 0;">${prosList}</div>
                                </div>
                                <div style="background-color:${C.blueLight}; padding: 15px 20px; text-align:center; border-radius: 0 0 8px 8px; border-top: 1px solid ${C.border};">
                                    <span style="font-size:14px; color:${C.textLight}; font-weight:bold; text-transform:uppercase;">PRIX DU FORFAIT</span><br>
                                    <strong style="font-size:28px; color:${C.textDark}; line-height:1.2;">${hotel.price ? hotel.price + '&nbsp;USD' : 'Voir PDF'}</strong>
                                </div>
                            </div>
                        `;
                    });
                    hotelSection += hotelCards;
                }
                
                hotelSection += `<p style="${S.p} margin-top:20px;">Chaque proposition de forfait inclut l'h√©bergement √† l'h√¥tel ainsi que les billets d'entr√©e pour les parcs Disney. Tous les autres d√©tails, inclusions et conditions se trouvent dans le ou les documents PDF correspondants.</p>`
                let advantagesList = T.disney_advantages_list_items.map(item => `<li style="margin-bottom:8px;"><span style="color:${C.blue}; font-size:18px; vertical-align:middle; margin-right:8px; font-weight:bold;">&#10004;</span><span style="vertical-align:middle;">${item}</span></li>`).join('');
                hotelSection += `<p style="${S.p} margin-top:30px; text-align:left;">${T.disney_advantages_intro}<ul style="margin:1em 0; padding:0; list-style-type:none; text-align:left;">${advantagesList}</ul>`;

            } else if (data.booking_type === 'tickets_only') {
                hotelSection = `<p style="${S.p}">J‚Äôai pr√©par√© pour vous un document ci-joint indiquant le prix ainsi que les conditions applicables aux billets de parc.</p>`;
            }

            let promoText = "";
            if (data.promotion_type === 'aucune') {
                promoText = `Pour garantir votre place, un d√©p√¥t de seulement <strong style="${S.strong}">200 USD</strong> est requis. Les promotions Disney deviennent souvent disponibles et sont parfois compl√®tement r√©serv√©es √† l'int√©rieur de quelques heures. Il est donc important de r√©server d'avance pour que je sois en mesure de les obtenir pour vous de mani√®re rapide et syst√©matique, afin que vous ayez toujours le meilleur rapport qualit√©-prix. Le reste de la balance de paiement est aussi √† effectuer 30 jours avant le check-in.`;
            } else {
                let promoEndDateInfo = data.promotion_end_date ? ` (prend fin le <strong style="${S.strong}">${formatDateFR(data.promotion_end_date)}</strong>)` : "";
                let promoNameInfo = data.promotion_name ? `&nbsp;: <strong style="${S.strong}">${data.promotion_name}</strong>` : "";
                promoText = `Une promotion est applicable pour votre s√©jour${promoNameInfo}${promoEndDateInfo}. L‚Äôoffre est cependant <em style="${S.italic}">limit√©e</em>. Pour garantir votre place au c≈ìur de la magie, un d√©p√¥t de seulement <strong style="${S.strong}">200 USD</strong> est requis. Ce d√©p√¥t est <strong style="${S.strong}">enti√®rement remboursable jusqu'√† 30 jours avant votre arriv√©e</strong>, vous offrant une flexibilit√© totale. Le reste de la balance de paiement est aussi √† effectuer 30 jours avant le check-in.`;
            }
            
            let promotionSection = createCalloutBox("PROMOTIONS ET D√âP√îT REQUIS", promoText, "orange");
            let priceDisclaimer = (data.booking_type === 'hotel_tickets' && selectedHotels.length > 0) ? T.disney_price_disclaimer : T.tickets_only_price_disclaimer;

            let flightSection = '';
            let flightBlock = '';
            if (data.include_flights) {
                const hasFlightInfo = [
                    data.departure_date_aller,
                    data.departure_time_aller,
                    data.departure_airport_aller,
                    data.arrival_airport_aller,
                    data.arrival_date_aller,
                    data.arrival_time_aller,
                    data.airline_aller,
                    data.flight_number_aller,
                    data.departure_date_retour,
                    data.departure_time_retour,
                    data.departure_airport_retour,
                    data.arrival_airport_retour,
                    data.arrival_date_retour,
                    data.arrival_time_retour,
                    data.airline_retour,
                    data.flight_number_retour,
                    data.flight_price,
                    data.flight_notes
                ].some(v => v && v.trim() !== '');

                if (hasFlightInfo) {
                 const arrow = `<span style="color:${C.orange}; font-weight:bold; font-size:24px; line-height:1;">&nbsp;&rarr;&nbsp;</span>`;

                 let flightDetails = `<p style="${S.p}">${T.flight_intro}</p>
                    <div style="border: 1px solid ${C.border}; border-radius: 8px; margin-top:20px;">
                        <div style="padding:20px; border-bottom:1px dashed ${C.border};">
                            <h3 style="margin:0 0 20px 0; font-size:18px; color:${C.blue};">‚úàÔ∏è Vol aller</h3>
                             <table width="100%" border="0" cellpadding="0" cellspacing="0">
                                <tr>
                                    <td class="flight-column" style="width:45%; text-align:center; vertical-align:top;">
                                        <div style="font-size:16px; color:${C.textLight}; text-transform:uppercase; margin-bottom:10px;">D√©part</div>
                                        <div style="font-size:20px; font-weight:bold; color:${C.blue}; margin-bottom:10px;">${data.departure_airport_aller || 'N/A'}</div>
                                        <table border="0" cellpadding="0" cellspacing="0" style="margin:0 auto; text-align:left;">
                                            <tr><td style="padding-bottom:10px;">üìÖ&nbsp;${formatDateFR(data.departure_date_aller)}</td></tr>
                                            <tr><td>üïí&nbsp;${formatTime(data.departure_time_aller)}</td></tr>
                                        </table>
                                    </td>
                                    <td class="flight-arrow" style="width:10%; text-align:center; vertical-align:top;">
                                        ${arrow}
                                    </td>
                                    <td class="flight-column" style="width:45%; text-align:center; vertical-align:top;">
                                        <div style="font-size:16px; color:${C.textLight}; text-transform:uppercase; margin-bottom:10px;">Arriv√©e</div>
                                        <div style="font-size:20px; font-weight:bold; color:${C.blue}; margin-bottom:10px;">${data.arrival_airport_aller || 'N/A'}</div>
                                        <table border="0" cellpadding="0" cellspacing="0" style="margin:0 auto; text-align:left;">
                                            <tr><td style="padding-bottom:10px;">üìÖ&nbsp;${formatDateFR(data.arrival_date_aller)}</td></tr>
                                            <tr><td>üïí&nbsp;${formatTime(data.arrival_time_aller)}</td></tr>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3" style="padding-top:10px; text-align:center;">
                                        <div style="font-size:14px; color:${C.textLight}; line-height:1.3;">
                                            ${data.airline_aller || ''}<br>${data.flight_number_aller || ''}
                                        </div>
                                    </td>
                                </tr>
                              </table>
                          </div>
                        <div style="padding:20px;">
                            <h3 style="margin:0 0 20px 0; font-size:18px; color:${C.blue};">‚úàÔ∏è Vol retour</h3>
                             <table width="100%" border="0" cellpadding="0" cellspacing="0">
                                <tr>
                                    <td class="flight-column" style="width:45%; text-align:center; vertical-align:top;">
                                        <div style="font-size:16px; color:${C.textLight}; text-transform:uppercase; margin-bottom:10px;">D√©part</div>
                                        <div style="font-size:20px; font-weight:bold; color:${C.blue}; margin-bottom:10px;">${data.departure_airport_retour || 'N/A'}</div>
                                         <table border="0" cellpadding="0" cellspacing="0" style="margin:0 auto; text-align:left;">
                                            <tr><td style="padding-bottom:10px;">üìÖ&nbsp;${formatDateFR(data.departure_date_retour)}</td></tr>
                                            <tr><td>üïí&nbsp;${formatTime(data.departure_time_retour)}</td></tr>
                                        </table>
                                    </td>
                                    <td class="flight-arrow" style="width:10%; text-align:center; vertical-align:top;">
                                        ${arrow}
                                    </td>
                                    <td class="flight-column" style="width:45%; text-align:center; vertical-align:top;">
                                        <div style="font-size:16px; color:${C.textLight}; text-transform:uppercase; margin-bottom:10px;">Arriv√©e</div>
                                        <div style="font-size:20px; font-weight:bold; color:${C.blue}; margin-bottom:10px;">${data.arrival_airport_retour || 'N/A'}</div>
                                        <table border="0" cellpadding="0" cellspacing="0" style="margin:0 auto; text-align:left;">
                                            <tr><td style="padding-bottom:10px;">üìÖ&nbsp;${formatDateFR(data.arrival_date_retour)}</td></tr>
                                            <tr><td>üïí&nbsp;${formatTime(data.arrival_time_retour)}</td></tr>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3" style="padding-top:10px; text-align:center;">
                                        <div style="font-size:14px; color:${C.textLight}; line-height:1.3;">
                                            ${data.airline_retour || ''}<br>${data.flight_number_retour || ''}
                                        </div>
                                    </td>
                                </tr>
                              </table>
                          </div>
                        <div style="background-color:${C.blueLight}; padding: 15px 20px; text-align:center; border-radius: 0 0 8px 8px; border-top: 1px solid ${C.border};">
                            <span style="font-size:14px; color:${C.textLight}; font-weight:bold; text-transform:uppercase;">PRIX APPROXIMATIF DES VOLS</span><br>
                            <strong style="font-size:28px; color:${C.textDark}; line-height:1.2;">${data.flight_price ? data.flight_price + '&nbsp;CAD' : 'N/A'}</strong>
                        </div>
                    </div>`;

                if (data.flight_notes) {
                    flightDetails += `<p style="${S.p} font-style:italic; font-weight:bold; color:${C.textLight}; border-left:3px solid ${C.border}; padding-left:15px; margin-top:20px;">${data.flight_notes.replace(/\n/g, '<br>')}</p>`;
                }
                
                flightDetails += createCalloutBox(T.flight_important_label, T.flight_important_text, "orange");
                flightDetails += `<p style="${S.p} font-size:14px; color:${C.textLight}; text-align:left; margin-top:20px;">${T.flight_price_info}</p>`;
                                  
                flightSection = `<tr><td style="padding: 20px 30px 30px 30px;">${flightDetails}</td></tr>`;
                flightBlock = `${createBanner(T.banner_travel_fees, 'sub')}${flightSection}`;
                }
            }

            let closingSection = `<p style="${S.p}">${T.closing1}</p><p style="${S.p}">${T.closing2}</p><p style="${S.p}">${T.closing3}</p>`;
            
            const hotelBannerText = data.booking_type === 'tickets_only' ? "Billets de Parc Disney" : "Forfaits H√¥tel & Billets Disney";

            return `<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>${T.banner1}</title></head><body style="margin:0; padding:0; background-color:${C.background};"><table width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="background-color:${C.background};"><tr><td align="center"><table width="680" border="0" cellpadding="0" cellspacing="0" role="presentation" style="width: 680px; max-width: 100%; margin: 20px auto; background-color: ${C.white};">
                ${createBanner(T.banner1, 'main')}
                <tr><td style="padding: 20px 30px 30px 30px;">${introSection}</td></tr>
                ${createBanner(hotelBannerText, 'sub')}
                <tr><td style="padding: 20px 30px 10px 30px;">${hotelSection}</td></tr>
                <tr><td style="padding: 10px 30px 30px 30px;">${promotionSection}</td></tr>
                <tr><td style="padding: 0 30px 30px 30px;"><p style="${S.p} font-size:14px; color:${C.textLight}; text-align:center; ${S.italic}">${priceDisclaimer}</p></td></tr>
                ${flightBlock}
                ${createBanner(T.banner_magic_continues, 'closing')}
                <tr><td style="padding: 20px 30px 30px 30px;">${closingSection}</td></tr>
            </table></td></tr></table></body></html>`;
        }

        // --- Le reste du script JS pour le formulaire reste identique ---
        document.addEventListener('DOMContentLoaded', function() {
            const hotelSelectionsDiv = document.getElementById('hotel_selections');
            const addHotelButton = document.getElementById('add_hotel_button');
            let hotelCounter = 0;

            function createHotelSelector() {
                hotelCounter++;
                const groupDiv = document.createElement('div');
                groupDiv.classList.add('hotel-option-group');
                groupDiv.id = `hotel_group_${hotelCounter}`;
                
                let content = `
                    <div class="hotel-option-header">
                        <label>Option d'h√¥tel</label>
                        <button type="button" class="remove-hotel-button" title="Supprimer cet h√¥tel">Supprimer</button>
                    </div>
                    <select name="hotel_name" required>
                        <option value="" disabled selected>S√©lectionnez un h√¥tel</option>
                        ${DISNEY_HOTELS.sort((a,b) => a.name.localeCompare(b.name)).map(hotel => `<option value="${hotel.name}">${hotel.name}</option>`).join('')}
                    </select>
                    <label for="hotel_price_${hotelCounter}">Prix du Forfait (USD)&nbsp;:</label>
                    <input type="number" name="hotel_price" id="hotel_price_${hotelCounter}" placeholder="Ex: 4500.50" step="0.01">
                `;
                groupDiv.innerHTML = content;

                groupDiv.querySelector('.remove-hotel-button').addEventListener('click', function() {
                    groupDiv.remove();
                    updateAddHotelButtonState();
                });

                return groupDiv;
            }

            function updateAddHotelButtonState() {
                const currentHotelSelectors = hotelSelectionsDiv.querySelectorAll('.hotel-option-group').length;
                addHotelButton.disabled = currentHotelSelectors >= 5;
                addHotelButton.textContent = currentHotelSelectors >= 5 ? "Maximum 5 h√¥tels atteints" : "Ajouter une option d'h√¥tel";
            }

            addHotelButton.addEventListener('click', function() {
                if (hotelSelectionsDiv.querySelectorAll('.hotel-option-group').length < 5) {
                    hotelSelectionsDiv.appendChild(createHotelSelector());
                    updateAddHotelButtonState();
                }
            });

            hotelSelectionsDiv.appendChild(createHotelSelector());
            updateAddHotelButtonState();
            
            const form = document.getElementById('disneyForm');
            const emailOutputDiv = document.getElementById('emailOutput');
            
            form.addEventListener('submit', function(event) {
                event.preventDefault();
                const formData = new FormData(form);
                const data = {};
                
                for (let [key, value] of formData.entries()) {
                    if (!key.startsWith('hotel_')) {
                        data[key] = value;
                    }
                }
                data.include_flights = formData.has('include_flights');
                
                data.hotels = [];
                const hotelGroups = hotelSelectionsDiv.querySelectorAll('.hotel-option-group');
                hotelGroups.forEach(group => {
                    const name = group.querySelector('select[name="hotel_name"]').value;
                    const price = group.querySelector('input[name="hotel_price"]').value;
                    if(name) {
                        const hotelData = getHotelByName(name);
                        data.hotels.push({
                            name: name,
                            description: hotelData.description,
                            level: hotelData.level,
                            pointsForts: hotelData.pointsForts,
                            price: price
                        });
                    }
                });
                
                const emailHtmlContent = generateEmailHTML(data);
                emailOutputDiv.innerHTML = emailHtmlContent;
            });

            const copyHtmlButton = document.getElementById('copyHtmlButton');
            copyHtmlButton.addEventListener('click', function() {
                const emailContent = emailOutputDiv.innerHTML;
                 navigator.clipboard.writeText(emailContent).then(function() {
                    alert('Contenu HTML de l\'e-mail copi√© dans le presse-papiers !');
                }, function(err) {
                    alert('Erreur lors de la copie. Veuillez essayer manuellement.');
                    console.error('Could not copy text: ', err);
                });
            });
            
            const includeFlightsCheckbox = document.getElementById('include_flights');
            const flightDetailsDiv = document.getElementById('flight_details');
            const bookingTypeSelect = document.getElementById('booking_type');
            const hotelOptionsContainer = document.getElementById('hotel_options_container');
            const promotionTypeSelect = document.getElementById('promotion_type');
            const promotionDetailsDiv = document.getElementById('promotion_details');
            
            function toggleFlightDetails() { flightDetailsDiv.classList.toggle('hidden', !includeFlightsCheckbox.checked); }
            function toggleHotelOptions() { hotelOptionsContainer.classList.toggle('hidden', bookingTypeSelect.value !== 'hotel_tickets'); }
            function togglePromotionDetails() { promotionDetailsDiv.classList.toggle('hidden', promotionTypeSelect.value !== 'specifique'); }

            includeFlightsCheckbox.addEventListener('change', toggleFlightDetails);
            bookingTypeSelect.addEventListener('change', toggleHotelOptions);
            promotionTypeSelect.addEventListener('change', togglePromotionDetails);
            
            toggleFlightDetails();
            toggleHotelOptions();
            togglePromotionDetails();
        });
    </script>
</body>
</html>
