<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur d'e-mail Disney (Client-Side)</title>
    <style>
        body { font-family: sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; line-height: 1.6; }
        .container { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); max-width: 900px; margin: auto;}
        h1, h2 { color: #007bff; }
        h1 { text-align: center; margin-bottom: 30px;}
        h2 { margin-top: 25px; border-bottom: 1px solid #eee; padding-bottom: 5px;}
        label { display: block; margin-top: 15px; font-weight: bold; }
        input[type="text"], input[type="number"], input[type="date"], input[type="time"], select, textarea {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        input[type="checkbox"] { margin-right: 5px; vertical-align: middle; }
        button {
            background-color: #007bff; color: white; padding: 12px 25px;
            border: none; border-radius: 4px; cursor: pointer; margin-top: 20px;
            font-size: 1em;
        }
        button:hover { background-color: #0056b3; }
        .form-section { border: 1px solid #eee; padding: 15px; margin-bottom: 20px; border-radius: 5px; background-color: #fdfdfd; }
        .hidden { display: none; }
        #emailOutputContainer { margin-top: 30px; }
        #emailOutput {
            padding: 20px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
            border-radius: 5px;
            white-space: pre-wrap; /* Conserve les sauts de ligne pour l'affichage initial */
            min-height: 200px;
            font-family: Aptos, Arial, sans-serif; /* Juste pour la prévisualisation */
        }
        .email-title, .email-subtitle { /* Styles pour l'aperçu, seront appliqués inline pour l'email réel */
            font-family: Aptos, Arial, sans-serif;
            color: blue;
            text-transform: uppercase;
            font-weight: bold;
        }
        .email-title { font-size: 1.2em; margin-top: 1em; margin-bottom: 0.5em; }
        .email-subtitle { font-size: 1.1em; margin-top: 1em; margin-bottom: 0.5em; }
        .hotel-selection { margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Générateur d'e-mail pour Voyages Disney</h1>

        <form id="disneyForm">
            <div class="form-section">
                <h2>Informations Générales</h2>
                <label for="langue">Langue de l'e-mail :</label>
                <select id="langue" name="langue">
                    <option value="fr" selected>Français</option>
                    </select>

                <label for="client_name">Nom de la personne cliente :</label>
                <input type="text" id="client_name" name="client_name" required>

                <label for="adults">Nombre d'adultes :</label>
                <input type="number" id="adults" name="adults" min="1" value="2" required>

                <label for="children">Nombre d'enfants (0 si aucun) :</label>
                <input type="number" id="children" name="children" min="0" value="0" required>
            </div>

            <div class="form-section">
                <h2>Hébergement et Billets</h2>
                <label for="booking_type">Type de réservation :</label>
                <select id="booking_type" name="booking_type">
                    <option value="hotel_tickets">Hôtel + Billets</option>
                    <option value="tickets_only">Billets seulement</option>
                </select>

                <div id="hotel_options_container">
                    <label>Choix d'hôtel(s) :</label>
                    <div id="hotel_selections">
                        <div class="hotel-selection">
                            <select name="hotel_name[]" class="hotel-name-select">
                                <option value="">Sélectionnez un hôtel</option>
                                </select>
                        </div>
                    </div>
                    <button type="button" id="add_hotel_button">Ajouter une autre option d'hôtel (max 5)</button>
                </div>
            </div>

            <div class="form-section">
                <h2>Vols</h2>
                <label><input type="checkbox" id="include_flights" name="include_flights"> Inclure les vols ?</label>
                <div id="flight_details" class="hidden">
                    <label for="departure_date_aller">Date de départ (Aller) :</label>
                    <input type="date" id="departure_date_aller" name="departure_date_aller">
                    <label for="departure_time_aller">Heure de départ (Aller) :</label>
                    <input type="time" id="departure_time_aller" name="departure_time_aller">
                    <label for="departure_airport_aller">Aéroport de départ (Aller) :</label>
                    <input type="text" id="departure_airport_aller" name="departure_airport_aller" placeholder="Ex: YUL - Montréal">
                    <label for="arrival_airport_aller">Aéroport d'arrivée (Aller) :</label>
                    <input type="text" id="arrival_airport_aller" name="arrival_airport_aller" placeholder="Ex: MCO - Orlando" value="MCO - Orlando">

                    <label for="departure_date_retour">Date de départ (Retour) :</label>
                    <input type="date" id="departure_date_retour" name="departure_date_retour">
                    <label for="departure_time_retour">Heure de départ (Retour) :</label>
                    <input type="time" id="departure_time_retour" name="departure_time_retour">
                    <label for="departure_airport_retour">Aéroport de départ (Retour) :</label>
                    <input type="text" id="departure_airport_retour" name="departure_airport_retour" placeholder="Ex: MCO - Orlando" value="MCO - Orlando">
                    <label for="arrival_airport_retour">Aéroport d'arrivée (Retour) :</label>
                    <input type="text" id="arrival_airport_retour" name="arrival_airport_retour" placeholder="Ex: YUL - Montréal">

                    <label for="flight_price">Prix total approximatif des vols (CAD) :</label>
                    <input type="number" id="flight_price" name="flight_price" step="0.01">
                </div>
            </div>

            <div class="form-section">
                <h2>Promotion</h2>
                <label for="promotion_type">Type de promotion :</label>
                <select id="promotion_type" name="promotion_type">
                    <option value="aucune">Aucune promotion pour l'instant</option>
                    <option value="specifique">Promotion spécifique</option>
                </select>
                <div id="promotion_details" class="hidden">
                    <label for="promotion_name">Nom de la promotion :</label>
                    <input type="text" id="promotion_name" name="promotion_name">
                    <label for="promotion_end_date">Date de fin de la promotion (si applicable) :</label>
                    <input type="date" id="promotion_end_date" name="promotion_end_date">
                </div>
            </div>

            <button type="submit">Générer l'e-mail</button>
        </form>

        <div id="emailOutputContainer">
            <h2>E-mail Généré (Prêt à copier)</h2>
            <p><em>Assurez-vous que votre client e-mail est configuré pour envoyer des e-mails au format HTML pour conserver la mise en forme.</em></p>
            <div id="emailOutput" contenteditable="true">
                </div>
            <button type="button" id="copyHtmlButton">Copier le HTML de l'e-mail</button>
        </div>
    </div>

    <script>
        // --- CONSTANTES ET DONNÉES ---
        const DISNEY_HOTELS = [
            { name: "Bay Lake Tower at Disney's Contemporary Resort", description: "Connecté au Magic Kingdom par une passerelle, cet hôtel moderne offre des vues spectaculaires et des villas luxueuses." },
            { name: "Boulder Ridge Villas at Disney's Wilderness Lodge", description: "Inspirées par les gîtes des parcs nationaux de l'Ouest américain de la fin du XIXe siècle, ces villas offrent un charme rustique et une ambiance chaleureuse." },
            { name: "Copper Creek Villas & Cabins at Disney's Wilderness Lodge", description: "Des villas et cabines élégantes au bord de l'eau, offrant un mélange de luxe moderne et de nature sauvage, inspirées par l'héritage ferroviaire du Nord-Ouest Pacifique." },
            { name: "Disney’s All-Star Movies Resort", description: "Plongez dans la magie du cinéma avec cet hôtel thématique qui rend hommage aux grands classiques d’animation de Disney, comme Toy Story, 101 Dalmatiens ou Fantasia. Les bâtiments colorés et les immenses statues de personnages emblématiques en font un lieu très apprécié des familles. Parmi les commodités offertes : deux piscines thématiques, une aire de jeux pour enfants, une arcade et une aire de restauration variée. Le transport vers les quatre parcs thématiques, les parcs aquatiques et Disney Springs est assuré uniquement par autobus." },
            { name: "Disney’s All-Star Music Resort", description: "Inspiré de différents genres musicaux comme le jazz, le rock, le calypso et le country, cet hôtel immersif propose des bâtiments décorés d’instruments géants et une ambiance rythmée. Il dispose de deux piscines thématiques (dont l'une en forme de guitare), d’un food court, d’une salle d’arcade, et propose des suites familiales dans certaines sections. Le transport est uniquement offert par autobus vers tous les parcs et destinations Disney." },
            { name: "Disney’s All-Star Sports Resort", description: "Idéal pour les amateurs d’activités physiques, cet hôtel célèbre les grands sports américains comme le football, le basketball, le tennis ou le baseball, avec des décorations géantes et une ambiance énergique. On y trouve deux piscines thématiques, une aire de restauration, une arcade, ainsi que des terrains pour s’amuser entre les visites. Le transport est offert par autobus vers tous les parcs et Disney Springs." },
            { name: "Disney’s Animal Kingdom Lodge", description: "Plongez dans l’univers africain avec ce lodge spectaculaire inspiré des hôtels safari. Le point fort : des savanes où vous pouvez observer plus de 30 espèces d’animaux depuis votre balcon ou les espaces communs. L’hôtel propose des restaurants renommés comme Boma et Jiko, une grande piscine avec toboggan, une aire de jeux aquatique pour enfants, et un centre de remise en forme. Le transport vers les parcs Disney se fait uniquement par autobus." },
            { name: "Disney’s Animal Kingdom Villas - Jambo House", description: "Faisant partie de l'Animal Kingdom Lodge, Jambo House offre des vues sur la savane, une architecture africaine authentique et un accès facile aux restaurants et commodités du lodge principal." },
            { name: "Disney’s Animal Kingdom Villas - Kidani Village", description: "Adjacent à Jambo House, Kidani Village propose principalement des villas DVC avec des vues étendues sur la savane, une piscine dédiée avec toboggan et le restaurant Sanaa." },
            { name: "Disney’s Art of Animation Resort", description: "Cet hôtel transporte les visiteurs dans les mondes colorés de La Petite Sirène, Le Roi Lion, Némo et Cars, avec des décors grandeur nature, des suites thématiques immersives et des détails visuels spectaculaires. Les familles y trouvent des suites spacieuses, la plus grande piscine de Walt Disney World (inspirée de Némo), une aire de restauration variée et une zone de jeux aquatiques pour les enfants. Le Disney Skyliner est accessible directement depuis l’hôtel, permettant de se rendre à EPCOT et à Disney’s Hollywood Studios en gondole aérienne." },
            { name: "Disney’s Beach Club Resort", description: "Ce charmant hôtel d’inspiration Nouvelle-Angleterre, avec ses couleurs pastel et ses façades élégantes, est particulièrement populaire pour sa piscine Stormalong Bay : un mini-parc aquatique avec sable au fond, rivière lente et toboggan. On y trouve également plusieurs restaurants, des courts de tennis et une salle de sport. Situé à quelques minutes à pied d’EPCOT, il offre aussi un accès par bateau à Hollywood Studios et des autobus vers les autres destinations." },
            { name: "Disney’s Beach Club Villas", description: "Partageant les commodités du Beach Club Resort, ces villas offrent plus d'espace et de flexibilité, y compris des cuisines, tout en conservant l'atmosphère balnéaire élégante." },
            { name: "Disney’s BoardWalk Inn", description: "Cet hôtel rappelle les promenades côtières des années 1920, avec une ambiance festive et animée en soirée grâce à son boardwalk rempli de restaurants, boutiques, artistes de rue et boîtes de nuit. L’hôtel dispose de piscines thématiques, d’un spa, d’un centre de remise en forme, et de restaurants comme Flying Fish. Vous pouvez marcher jusqu’à EPCOT, prendre un bateau pour Hollywood Studios, et utiliser les autobus pour les autres parcs." },
            { name: "Disney’s BoardWalk Villas", description: "Ces villas offrent le charme du BoardWalk Inn avec des hébergements plus spacieux, parfaits pour les familles, et un accès direct à l'animation du BoardWalk." },
            { name: "Disney’s Caribbean Beach Resort", description: "Ce vaste complexe vous transporte dans l’ambiance relaxante des Caraïbes, avec ses plages artificielles, ses palmiers et ses bâtiments colorés représentant différentes îles comme la Barbade ou Trinité. L’hôtel propose une piscine principale sur le thème d’un fort espagnol, plusieurs piscines secondaires, des restaurants comme le Sebastian’s Bistro, et des promenades au bord de l’eau. Il s'agit également du nœud principal du Disney Skyliner, avec des trajets vers EPCOT et Hollywood Studios directement depuis la station centrale." },
            { name: "Disney’s Contemporary Resort", description: "Un des hôtels les plus iconiques de Disney, reconnaissable à sa structure en forme de A traversée par le monorail. Cet hôtel moderne et élégant offre un accès à pied au parc Magic Kingdom en moins de 10 minutes, en plus du monorail vers EPCOT. Les commodités incluent une grande piscine, un spa, un centre de conférence, et le célèbre restaurant California Grill, avec vue sur les feux d’artifice." },
            { name: "Disney’s Coronado Springs Resort", description: "Mariant l’architecture espagnole coloniale et l’élégance d’un hôtel de congrès moderne, Coronado Springs propose une ambiance sophistiquée. Le complexe inclut la tour Gran Destino (moderne et luxueuse), une immense piscine à thème maya avec toboggan, plusieurs restaurants (dont Toledo, en rooftop), un centre de remise en forme et des salles de conférence. Bien que haut de gamme, les transports sont offerts uniquement par autobus vers tous les parcs et lieux Disney." },
            { name: "Disney’s Grand Floridian Resort & Spa", description: "L’hôtel le plus luxueux de Disney, inspiré des stations balnéaires victoriennes, propose une ambiance élégante avec chandeliers, musique en direct au piano et service haut de gamme. Il dispose d’un spa complet, de plusieurs piscines, d’un centre de remise en forme et de restaurants de renom comme Victoria & Albert’s et Narcoossee’s. Le Grand Floridian est connecté par monorail et bateau à Magic Kingdom, et par monorail (avec correspondance) à EPCOT." },
            { name: "Disney’s Old Key West Resort", description: "Évoquant l'ambiance décontractée de Key West, ce vaste complexe propose des villas spacieuses, des terrains de golf, des piscines tranquilles et un service de bateau vers Disney Springs." },
            { name: "Disney’s Polynesian Village Resort", description: "Ambiance tropicale, torches enflammées, et bâtiments inspirés des îles du Pacifique vous attendent dans cet hôtel emblématique de Disney. On y trouve des restaurants très appréciés comme ‘Ohana et Kona Café, une plage avec vue sur les feux de Magic Kingdom, une piscine thématique avec toboggan, et des spectacles polynésiens. Il est relié par monorail et bateau à Magic Kingdom, et par monorail avec correspondance à EPCOT." },
            { name: "Disney's Polynesian Villas & Bungalows", description: "Des villas et des bungalows sur pilotis luxueux offrant une expérience polynésienne ultime, avec un accès facile aux commodités du Polynesian Village Resort." },
            { name: "Disney’s Pop Century Resort", description: "Remontez le temps à travers les décennies du 20e siècle avec cet hôtel coloré qui célèbre la culture populaire des années 1950 à 1990. Les bâtiments sont ornés d’objets emblématiques de chaque époque, comme des disques vinyles, des yo-yos géants ou des téléphones rétro. Le complexe propose des piscines thématiques, un food court, une boutique de souvenirs et des services de transport. Il est relié au Disney Skyliner, vous offrant un accès rapide à EPCOT et à Hollywood Studios." },
            { name: "Disney’s Port Orleans Resort - French Quarter", description: "Ce charmant hôtel évoque le Vieux Carré de La Nouvelle-Orléans avec ses rues pavées, ses balcons en fer forgé et son ambiance jazz. Il s'agit du plus petit hôtel Disney, idéal pour ceux qui veulent un séjour paisible. Les commodités comprennent une piscine avec un toboggan en forme de serpent géant, des beignets faits maison au Scat Cat’s Café, et une promenade en bateau pittoresque vers Disney Springs. Le reste du transport (vers les parcs thématiques) se fait par autobus." },
            { name: "Disney’s Port Orleans Resort - Riverside", description: "Ce complexe est divisé en deux sections : Magnolia Bend (grands manoirs inspirés des plantations du Sud) et Alligator Bayou (cabines rustiques et boisées). Il propose des piscines, des activités comme la pêche, des balades en calèche, et des restaurants comme Boatwright’s Dining Hall. Un bateau mène à Disney Springs, tandis que les autres destinations Disney sont desservies par autobus." },
            { name: "Disney’s Saratoga Springs Resort & Spa", description: "Inspiré par la ville thermale historique de Saratoga Springs dans l'État de New York, ce complexe de style victorien propose des villas, un spa, des terrains de golf et un accès facile à Disney Springs par bateau ou à pied." },
            { name: "Disney’s Wilderness Lodge", description: "Inspiré des grands lodges des parcs nationaux américains, ce complexe majestueux propose un décor rustique en bois et pierre, une cheminée monumentale et des sentiers dans la forêt. On y retrouve une piscine à cascades, des feux de camp, un geyser artificiel, et des restaurants comme Whispering Canyon Café. Il est accessible à Magic Kingdom en bateau, et aux autres parcs par autobus." },
            { name: "Disney’s Yacht Club Resort", description: "Voisin du Beach Club et partageant avec lui l’accès à Stormalong Bay, cet hôtel présente une esthétique nautique raffinée avec boiseries sombres et ambiance yacht club de Nouvelle-Angleterre. Il propose des restaurants comme Yachtsman Steakhouse, une salle de sport, et des sports nautiques. Vous pouvez marcher jusqu’à EPCOT, prendre un bateau pour Hollywood Studios, ou un autobus pour les autres destinations." },
            { name: "Disney’s Riviera Resort", description: "Inspiré par l'élégance de la Riviera européenne, cet hôtel propose des studios et des villas, des restaurants sophistiqués (comme Topolino's Terrace), et un accès direct au Disney Skyliner." },
            { name: "The Cabins at Disney's Fort Wilderness Resort", description: "Offrant une véritable immersion dans la nature, ces cabines rustiques sont nichées dans une forêt de 750 acres. Chaque cabine peut loger jusqu’à six personnes, avec une cuisine équipée, une terrasse et un barbecue. Le complexe propose du tir à l’arc, des feux de camp avec personnages Disney, des spectacles de style western et des randonnées. Le transport se fait en autobus interne, puis en bateau jusqu’à Magic Kingdom, ou en autobus vers les autres parcs." },
            { name: "The Cabins at Disney's Fort Wilderness Resort – A Disney Vacation Club Resort", description: "Ces cabines, faisant partie du Disney Vacation Club, offrent les mêmes avantages que les cabines classiques du Fort Wilderness, avec la flexibilité des points DVC." },
            { name: "Les terrains de camping au Disney's Fort Wilderness Resort", description: "Des emplacements de camping spacieux pour tentes et véhicules récréatifs, offrant une expérience en pleine nature avec toutes les commodités d'un complexe Disney, y compris piscines, activités et transport." },
            { name: "Les villas au Disney's Grand Floridian Resort & Spa", description: "Des villas luxueuses offrant l'élégance victorienne du Grand Floridian avec plus d'espace, des cuisines et des vues magnifiques, pour une expérience DVC haut de gamme." }
        ];

        // --- STYLES POUR L'EMAIL (appliqués inline) ---
        const EMAIL_STYLE_COMMON = "font-family: Aptos, Arial, Helvetica, sans-serif; color: #000000; font-size: 11pt; line-height: 1.5;";
        const EMAIL_TITLE_STYLE = "font-family: Aptos, Arial, Helvetica, sans-serif; color: blue; text-transform: uppercase; font-weight: bold; font-size: 1.3em; margin-top: 1.2em; margin-bottom: 0.6em;";
        const EMAIL_SUBTITLE_STYLE = "font-family: Aptos, Arial, Helvetica, sans-serif; color: blue; text-transform: uppercase; font-weight: bold; font-size: 1.15em; margin-top: 1.2em; margin-bottom: 0.6em;";

        // --- FONCTIONS UTILITAIRES ---
        function getHotelByName(name) {
            return DISNEY_HOTELS.find(hotel => hotel.name === name);
        }

        function formatDateFR(dateStr) {
            if (!dateStr) return "";
            try {
                const date = new Date(dateStr + 'T00:00:00'); // Assurer que c'est interprété comme date locale
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                return date.toLocaleDateString('fr-FR', options);
            } catch (e) {
                return dateStr;
            }
        }
        
        function formatTime(timeStr) {
            if (!timeStr) return "";
             try {
                const [hours, minutes] = timeStr.split(':');
                const d = new Date();
                d.setHours(parseInt(hours, 10), parseInt(minutes, 10));
                return d.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit', hour12: false }).replace(':', ' h ');
            } catch (e) {
                return timeStr;
            }
        }


        // --- LOGIQUE DE GÉNÉRATION DE L'EMAIL ---
        function generateEmailHTML(data) {
            let emailParts = [`<div style="${EMAIL_STYLE_COMMON}">`]; // Conteneur principal
            const lang = data.langue || 'fr'; // Pour l'instant, seul 'fr' est géré

            // Textes (pour une future internationalisation, ces textes pourraient venir d'un objet)
            const TEXTS_FR = {
                banner1: "VOTRE SÉJOUR AU WALT DISNEY WORLD RESORT EN FLORIDE",
                greeting: `Bonjour ${data.client_name || 'estimé(e) voyageur(se)'},`,
                intro1: "Je vous écris au nom de Voyages en Route, où nous avons le plaisir d’accompagner les familles et voyageurs dans la planification de leurs séjours. Je m'appelle Pierre-Luc Morin et je serais votre conseiller en voyages spécialisé en destinations Disney et Universal.",
                intro2: "Merci de nous avoir confié votre projet de voyage. J’ai pris soin de préparer une proposition basée sur les critères que vous avez partagés dans votre demande. Cette soumission est ajustable, et je serai heureux d’explorer avec vous différentes options afin de vous créer une expérience propre à vous et inoubliable.",
                banner_disney_stay: "SÉJOUR DISNEY",
                disney_advantages_intro: "Séjourner dans un hôtel Disney, c’est profiter d’un univers immersif du matin au soir, mais aussi de nombreux avantages exclusifs, tels que :",
                disney_advantages_list: `
                    <ul style="padding-left: 20px; margin-top: 0.5em;">
                        <li style="margin-bottom: 0.3em;">l’Early Theme Park Entry, pour accéder aux parcs avant l’ouverture officielle ;</li>
                        <li style="margin-bottom: 0.3em;">le transport gratuit vers tous les parcs et sites Disney (excluant les transferts aéroports) ;</li>
                        <li style="margin-bottom: 0.3em;">l’accès simplifié aux réservations avec l’application Disney Experience ;</li>
                        <li style="margin-bottom: 0.3em;">et un service client exceptionnel, signé Disney, à chaque étape de votre séjour.</li>
                    </ul>`,
                disney_price_disclaimer: "Veuillez noter que tous les prix pour l'hébergement et les billets Disney sont indiqués en dollars américains (USD) et sont sujets à disponibilité.",
                tickets_only_price_disclaimer: "Veuillez noter que tous les prix des billets Disney sont indiqués en dollars américains (USD) et sont sujets à disponibilité.",
                banner_travel_fees: "FRAIS DE DÉPLACEMENT",
                flight_intro: "Pour compléter votre voyage vers la magie, voici les détails concernant le transport aérien que nous avons exploré :",
                flight_price_info: "Les prix sont à titre indicatif et peuvent changer à tout moment.",
                flight_important: "IMPORTANT : Les tarifs aériens sont dynamiques et peuvent changer jusqu'à la réservation. Des frais de service de 50$ CAD par personne s'appliquent pour la réservation des vols via nos services. En me confiant vos vols, je m'occupe de tout désagrément potentiel. Si vous optez pour une réservation personnelle, ces frais ne s'appliquent pas, mais le support en cas de problème avec les vols ne sera pas inclus pour cette portion.",
                banner_magic_continues: "LA MAGIE CONTINUE",
                closing1: "Prenez le temps de rêver à ces options et de considérer ce qui ferait de ce voyage une expérience véritablement inoubliable. Je suis à votre entière disposition pour répondre à toutes vos questions, affiner chaque détail ou procéder à la réservation de cette escapade féérique.",
                closing2: "N'hésitez pas à me joindre par courriel (en répondant simplement à celui-ci) ou par téléphone au 819-347-9103.",
                closing3: "Merci encore pour votre confiance. J'ai sincèrement hâte de transformer ce rêve Disney en une magnifique réalité pour vous !",
                signature_greeting: "Chaleureusement,",
                signature_name: "Pierre-Luc Morin",
                signature_title: "Conseiller en Voyages",
                signature_company: "Voyages en Route"
            };
            const T = TEXTS_FR; // Alias pour faciliter

            // Section 1: Introduction
            emailParts.push(`<h2 style="${EMAIL_TITLE_STYLE}">${T.banner1}</h2>`);
            emailParts.push(`<p>${T.greeting}</p>`);
            emailParts.push(`<p>${T.intro1}</p>`);
            emailParts.push(`<p>${T.intro2}</p>`);
            emailParts.push("<hr style='border: none; border-top: 1px solid #ccc; margin: 20px 0;'>");

            // Section 2: Séjour Disney
            emailParts.push(`<h2 style="${EMAIL_SUBTITLE_STYLE}">${T.banner_disney_stay}</h2>`);

            const selectedHotels = Array.isArray(data.hotel_names) ? data.hotel_names.filter(h => h) : [];

            if (data.booking_type === 'hotel_tickets' && selectedHotels.length > 0) {
                if (selectedHotels.length === 1) {
                    const hotel = getHotelByName(selectedHotels[0]);
                    emailParts.push(`<p>Pour votre séjour au Walt Disney World Resort en Floride, j’ai préparé une option qui répond pleinement à vos besoins. J’ai sélectionné comme l’hébergement <b>${hotel.name}</b>.</p>`);
                    emailParts.push("<p>Cette proposition inclut l’hébergement ainsi que les billets pour les parcs Disney.</p>");
                    emailParts.push("<p>Tous les détails (dates, prix, inclusions et conditions) se trouvent dans le document PDF ci-joint.</p>");
                    if (hotel) {
                        emailParts.push(`<div style="margin-top:1em;"><b>PRÉSENTATION DE L’HÔTEL – ${hotel.name.toUpperCase()}</b><br>${hotel.description}</div>`);
                    }
                } else {
                    emailParts.push("<p>Pour votre séjour au Walt Disney World Resort en Floride, plusieurs options d’hébergement sont possibles selon vos besoins. Les options possibles sont :</p>");
                    let hotelListHtml = "<ul style='padding-left: 20px;'>";
                    selectedHotels.forEach(hotelName => { hotelListHtml += `<li>${hotelName}</li>`; });
                    hotelListHtml += "</ul>";
                    emailParts.push(hotelListHtml);
                    emailParts.push("<p>Les propositions incluent l’hébergement ainsi que les billets pour les parcs Disney.</p>");
                    emailParts.push("<p>Tous les détails (dates, prix, inclusions et conditions) se trouvent dans les documents PDF ci-joints.</p>");
                    selectedHotels.forEach((hotelName, index) => {
                        const hotel = getHotelByName(hotelName);
                        if (hotel) {
                             emailParts.push(`<div style="margin-top:1em;"><b>OPTION ${index + 1}: PRÉSENTATION DE L’HÔTEL – ${hotel.name.toUpperCase()}</b><br>${hotel.description}</div>`);
                        }
                    });
                }
                emailParts.push(`<p style='margin-top:1em;'>${T.disney_advantages_intro}</p>`);
                emailParts.push(T.disney_advantages_list);

            } else if (data.booking_type === 'tickets_only') {
                emailParts.push("<p>Pour votre séjour au Walt Disney World Resort en Floride, j’ai préparé pour vous un document ci-joint indiquant le prix ainsi que les conditions applicables aux billets de parc.</p>");
            }

            // Section 3: Promotions
            let promoText = "";
            if (data.promotion_type === 'aucune') {
                promoText = "Pour garantir votre place au cœur de la magie, un dépôt de seulement 200 USD est requis. Soyez assuré que je veillerai personnellement à appliquer toute nouvelle promotion applicable d'ici votre départ pour optimiser la valeur de votre voyage. Ce dépôt est entièrement remboursable jusqu'à 30 jours avant votre arrivée, vous offrant une flexibilité totale pour planifier en toute sérénité.";
            } else { // specifique
                let promoEndDateInfo = data.promotion_end_date ? ` (prend fin le ${formatDateFR(data.promotion_end_date)})` : "";
                let promoNameInfo = data.promotion_name ? ` : <b>${data.promotion_name}</b>` : "";
                promoText = `Une promotion est applicable pour votre séjour${promoNameInfo}${promoEndDateInfo}. L’offre est cependant limitée. Pour garantir votre place au cœur de la magie, un dépôt de seulement 200 USD est requis. Soyez assuré que je veillerai personnellement à appliquer toute nouvelle promotion applicable d'ici votre départ pour optimiser la valeur de votre voyage. Ce dépôt est entièrement remboursable jusqu'à 30 jours avant votre arrivée, vous offrant une flexibilité totale pour planifier en toute sérénité.`;
            }
            emailParts.push(`<p style='margin-top:1em;'><b>PROMOTIONS :</b><br>${promoText}</p>`);
            
            if (data.booking_type === 'hotel_tickets' && selectedHotels.length > 0) {
                 emailParts.push(`<p style="font-style: italic;">${T.disney_price_disclaimer}</p>`);
            } else if (data.booking_type === 'tickets_only') {
                emailParts.push(`<p style="font-style: italic;">${T.tickets_only_price_disclaimer}</p>`);
            }
            emailParts.push("<hr style='border: none; border-top: 1px solid #ccc; margin: 20px 0;'>");

            // Section 4: Frais de déplacement (Vols)
            if (data.include_flights) {
                emailParts.push(`<h2 style="${EMAIL_SUBTITLE_STYLE}">${T.banner_travel_fees}</h2>`);
                emailParts.push(`<p>${T.flight_intro}</p>`);
                
                let flightDetailsHtml = "<div style='margin-left: 20px;'>";
                flightDetailsHtml += `<p><b>Aller :</b> ${formatDateFR(data.departure_date_aller)} à ${formatTime(data.departure_time_aller)}<br>`;
                flightDetailsHtml += `De : ${data.departure_airport_aller || 'N/A'}<br>`;
                flightDetailsHtml += `Vers : ${data.arrival_airport_aller || 'N/A'}</p>`;
                
                flightDetailsHtml += `<p><b>Retour :</b> ${formatDateFR(data.departure_date_retour)} à ${formatTime(data.departure_time_retour)}<br>`;
                flightDetailsHtml += `De : ${data.departure_airport_retour || 'N/A'}<br>`;
                flightDetailsHtml += `Vers : ${data.arrival_airport_retour || 'N/A'}</p>`;
                
                const numAdults = parseInt(data.adults) || 0;
                const numChildren = parseInt(data.children) || 0;
                const totalPassengers = numAdults + numChildren;
                const adultText = numAdults > 1 ? "adultes" : "adulte";
                const childText = numChildren > 1 ? "enfants" : "enfant";
                
                flightDetailsHtml += `<p><b>Nombre de passagers :</b> ${totalPassengers} (${numAdults} ${adultText}, ${numChildren} ${childText})</p>`;
                flightDetailsHtml += `<p><b>Prix total approximatif des vols :</b> ${data.flight_price || 'N/A'} CAD</p>`;
                flightDetailsHtml += "</div>";
                emailParts.push(flightDetailsHtml);

                emailParts.push(`<p style="font-style: italic;">${T.flight_price_info}</p>`);
                emailParts.push(`<p><b>${T.flight_important}</b></p>`);
                emailParts.push("<hr style='border: none; border-top: 1px solid #ccc; margin: 20px 0;'>");
            }

            // Section 5: Conclusion
            emailParts.push(`<h2 style="${EMAIL_SUBTITLE_STYLE}">${T.banner_magic_continues}</h2>`);
            emailParts.push(`<p>${T.closing1}</p>`);
            emailParts.push(`<p>${T.closing2}</p>`);
            emailParts.push(`<p>${T.closing3}</p>`);
            emailParts.push(`<p style="margin-top: 1.5em;">${T.signature_greeting}</p>`);
            emailParts.push(`<p style="line-height: 1.3;">${T.signature_name}<br>${T.signature_title}<br>${T.signature_company}</p>`);

            emailParts.push("</div>"); // Ferme le conteneur principal
            return emailParts.join("\n");
        }


        // --- GESTION DU FORMULAIRE ET DES INTERACTIONS ---
        document.addEventListener('DOMContentLoaded', function() {
            const initialHotelSelect = document.querySelector('.hotel-name-select');
            DISNEY_HOTELS.forEach(hotel => {
                const option = document.createElement('option');
                option.value = hotel.name;
                option.textContent = hotel.name;
                initialHotelSelect.appendChild(option);
            });

            const includeFlightsCheckbox = document.getElementById('include_flights');
            const flightDetailsDiv = document.getElementById('flight_details');
            const bookingTypeSelect = document.getElementById('booking_type');
            const hotelOptionsContainer = document.getElementById('hotel_options_container');
            const addHotelButton = document.getElementById('add_hotel_button');
            const hotelSelectionsDiv = document.getElementById('hotel_selections');
            const promotionTypeSelect = document.getElementById('promotion_type');
            const promotionDetailsDiv = document.getElementById('promotion_details');
            const form = document.getElementById('disneyForm');
            const emailOutputDiv = document.getElementById('emailOutput');
            const copyHtmlButton = document.getElementById('copyHtmlButton');

            function toggleFlightDetails() {
                flightDetailsDiv.classList.toggle('hidden', !includeFlightsCheckbox.checked);
            }
            function toggleHotelOptions() {
                 hotelOptionsContainer.classList.toggle('hidden', bookingTypeSelect.value === 'tickets_only');
            }
            function togglePromotionDetails() {
                promotionDetailsDiv.classList.toggle('hidden', promotionTypeSelect.value !== 'specifique');
            }

            includeFlightsCheckbox.addEventListener('change', toggleFlightDetails);
            bookingTypeSelect.addEventListener('change', toggleHotelOptions);
            promotionTypeSelect.addEventListener('change', togglePromotionDetails);

            let hotelCount = 1;
            addHotelButton.addEventListener('click', function() {
                if (hotelCount < 5) {
                    hotelCount++;
                    const newHotelSelectionDiv = document.createElement('div');
                    newHotelSelectionDiv.classList.add('hotel-selection');
                    
                    const newSelect = document.createElement('select');
                    newSelect.name = 'hotel_name[]';
                    newSelect.classList.add('hotel-name-select');
                    
                    const placeholderOption = document.createElement('option');
                    placeholderOption.value = "";
                    placeholderOption.textContent = `Sélectionnez l'hôtel ${hotelCount}`;
                    newSelect.appendChild(placeholderOption);
                    
                    DISNEY_HOTELS.forEach(hotel => {
                        const option = document.createElement('option');
                        option.value = hotel.name;
                        option.textContent = hotel.name;
                        newSelect.appendChild(option);
                    });
                    
                    newHotelSelectionDiv.appendChild(newSelect);
                    hotelSelectionsDiv.appendChild(newHotelSelectionDiv);
                }
                if (hotelCount === 5) {
                    addHotelButton.disabled = true;
                    addHotelButton.textContent = "Maximum 5 hôtels atteints";
                }
            });
            
            form.addEventListener('submit', function(event) {
                event.preventDefault();
                const formData = new FormData(form);
                const data = {};
                
                const hotelNameElements = form.querySelectorAll('select[name="hotel_name[]"]');
                data.hotel_names = Array.from(hotelNameElements).map(select => select.value).filter(value => value !== "");


                for (let [key, value] of formData.entries()) {
                    // On ne veut pas écraser hotel_names qui est déjà traité
                    if (key !== 'hotel_name[]') {
                         if (key === 'include_flights') {
                            data[key] = true; // Checkbox coché
                        } else {
                            data[key] = value;
                        }
                    }
                }
                 if (!formData.has('include_flights')) {
                    data.include_flights = false; // Checkbox non coché
                }


                const emailHtmlContent = generateEmailHTML(data);
                emailOutputDiv.innerHTML = emailHtmlContent; // Affiche l'HTML rendu
            });

            copyHtmlButton.addEventListener('click', function() {
                // Pour copier l'HTML brut pour coller dans un client mail en mode "source HTML" si besoin
                // Ou simplement permettre à l'utilisateur de sélectionner et copier le contenu rendu.
                // La sélection manuelle du contenu rendu est souvent plus fiable.
                const range = document.createRange();
                range.selectNodeContents(emailOutputDiv);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
                try {
                    document.execCommand('copy');
                    alert('Contenu de l\'e-mail copié dans le presse-papiers !');
                } catch (err) {
                    alert('Erreur lors de la copie. Veuillez sélectionner manuellement le contenu.');
                }
                selection.removeAllRanges();
            });

            // Initial state
            toggleFlightDetails();
            toggleHotelOptions();
            togglePromotionDetails();
        });
    </script>
</body>
</html>
