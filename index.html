<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur d'e-mail Disney (Amélioré)</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, Helvetica, sans-serif;
            margin: 0;
            background: #f4f4f4;
            color: #222;
        }
        .container {
            max-width: 900px;
            margin: 20px auto;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 0 14px rgba(0,0,0,0.10);
            padding: 24px 10px 30px 10px;
        }
        h1, h2 {
            color: #0078c1;
            text-align: center;
        }
        h2 {
            font-size: 1.2em;
            margin-top: 30px;
        }
        label {
            font-weight: 600;
            margin-top: 16px;
            display: block;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            margin-top: 6px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 1em;
            box-sizing: border-box;
        }
        textarea {
            min-height: 60px;
            resize: vertical;
        }
        .form-section {
            background: #f8fafd;
            border: 1px solid #e3e8ee;
            border-radius: 7px;
            padding: 18px 16px;
            margin-bottom: 24px;
        }
        .hotel-selection {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .hotel-selection select {
            flex: 1;
        }
        .remove-hotel-button {
            background: #dc3545;
            color: #fff;
            border: none;
            border-radius: 4px;
            margin-left: 10px;
            padding: 8px 12px;
            cursor: pointer;
        }
        .remove-hotel-button:hover {
            background: #b52a38;
        }
        button, .remove-hotel-button {
            font-size: 1em;
        }
        button[type="submit"], #copyHtmlButton {
            background: #0078c1;
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 12px 20px;
            margin-top: 16px;
            cursor: pointer;
            font-weight: bold;
        }
        button[type="submit"]:hover, #copyHtmlButton:hover {
            background: #005b8a;
        }
        .hidden {
            display: none;
        }
        /* Responsive Table */
        .responsive-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 18px;
        }
        .responsive-table th, .responsive-table td {
            border: 1px solid #e3e8ee;
            padding: 10px 8px;
            text-align: left;
        }
        .responsive-table th {
            background: #0078c1;
            color: #fff;
            font-size: 1em;
        }
        @media (max-width: 600px) {
            .container {
                padding: 8px 2vw 16px 2vw;
            }
            .responsive-table, .responsive-table thead, .responsive-table tbody, .responsive-table th, .responsive-table td, .responsive-table tr {
                display: block;
            }
            .responsive-table th {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            .responsive-table td {
                border: none;
                position: relative;
                padding-left: 50%;
                min-height: 36px;
            }
            .responsive-table td:before {
                position: absolute;
                top: 10px;
                left: 10px;
                width: 45%;
                white-space: nowrap;
                font-weight: bold;
                color: #0078c1;
                content: attr(data-label);
            }
        }
        #emailOutputContainer {
            margin-top: 32px;
        }
        #emailOutput {
            background: #f7f7fa;
            border: 1px solid #d6d6e7;
            border-radius: 6px;
            padding: 20px;
            min-height: 210px;
            font-size: 1em;
            overflow-x: auto;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Générateur d'e-mail pour Voyages Disney</h1>
    <form id="disneyForm">
        <div class="form-section">
            <h2>Informations Générales</h2>
            <label for="client_name">Nom de la personne cliente :</label>
            <input type="text" id="client_name" name="client_name" required placeholder="Entrez le nom du client">
            <label for="adults">Nombre d'adultes :</label>
            <input type="number" id="adults" name="adults" min="1" value="2" required>
            <label for="children">Nombre d'enfants (0 si aucun) :</label>
            <input type="number" id="children" name="children" min="0" value="0" required>
        </div>
        <div class="form-section">
            <h2>Hébergement et Billets</h2>
            <label for="booking_type">Type de réservation :</label>
            <select id="booking_type" name="booking_type">
                <option value="hotel_tickets">Hôtel + Billets</option>
                <option value="tickets_only">Billets seulement</option>
            </select>
            <div id="hotel_options_container">
                <label>Choix d'hôtel(s) :</label>
                <div id="hotel_selections"></div>
                <button type="button" id="add_hotel_button">Ajouter une option d'hôtel</button>
            </div>
        </div>
        <div class="form-section">
            <h2>Vols</h2>
            <label><input type="checkbox" id="include_flights" name="include_flights"> Inclure les vols ?</label>
            <div id="flight_details" class="hidden">
                <label for="departure_date_aller">Date de départ (Aller) :</label>
                <input type="date" id="departure_date_aller" name="departure_date_aller">
                <label for="departure_time_aller">Heure de départ (Aller) :</label>
                <input type="time" id="departure_time_aller" name="departure_time_aller">
                <label for="departure_airport_aller">Aéroport de départ (Aller) :</label>
                <input type="text" id="departure_airport_aller" name="departure_airport_aller" placeholder="Ex: YUL - Montréal">
                <label for="arrival_airport_aller">Aéroport d'arrivée (Aller) :</label>
                <input type="text" id="arrival_airport_aller" name="arrival_airport_aller" placeholder="Ex: MCO - Orlando" value="MCO - Orlando">
                <label for="departure_date_retour">Date de départ (Retour) :</label>
                <input type="date" id="departure_date_retour" name="departure_date_retour">
                <label for="departure_time_retour">Heure de départ (Retour) :</label>
                <input type="time" id="departure_time_retour" name="departure_time_retour">
                <label for="departure_airport_retour">Aéroport de départ (Retour) :</label>
                <input type="text" id="departure_airport_retour" name="departure_airport_retour" placeholder="Ex: MCO - Orlando" value="MCO - Orlando">
                <label for="arrival_airport_retour">Aéroport d'arrivée (Retour) :</label>
                <input type="text" id="arrival_airport_retour" name="arrival_airport_retour" placeholder="Ex: YUL - Montréal">
                <label for="flight_price">Prix total approximatif des vols (CAD) :</label>
                <input type="number" id="flight_price" name="flight_price" step="0.01">
                <label for="flight_note">Note sur les vols (optionnel) :</label>
                <textarea id="flight_note" name="flight_note" placeholder="Ajoutez une note ou un commentaire sur les vols (ex: escale, bagages, conditions, etc.)"></textarea>
            </div>
        </div>
        <div class="form-section">
            <h2>Promotion</h2>
            <label for="promotion_type">Type de promotion :</label>
            <select id="promotion_type" name="promotion_type">
                <option value="aucune">Aucune promotion pour l'instant</option>
                <option value="specifique">Promotion spécifique</option>
            </select>
            <div id="promotion_details" class="hidden">
                <label for="promotion_name">Nom de la promotion :</label>
                <input type="text" id="promotion_name" name="promotion_name" placeholder="Nom de la promotion (ex: Rabais estival)">
                <label for="promotion_end_date">Date de fin de la promotion (si applicable) :</label>
                <input type="date" id="promotion_end_date" name="promotion_end_date">
            </div>
        </div>
        <button type="submit">Générer l'e-mail</button>
    </form>
    <div id="emailOutputContainer">
        <h2>E-mail Généré (Prêt à copier)</h2>
        <div id="emailOutput" contenteditable="true"></div>
        <button type="button" id="copyHtmlButton">Copier le contenu de l'e-mail</button>
    </div>
</div>

<script>
const DISNEY_HOTELS = [
    { name: "Disney's All-Star Movies Resort", description: "Plongez dans la magie du cinéma avec cet hôtel thématique qui rend hommage aux grands classiques d’animation de Disney.", pros: "Idéal familles, prix abordable, ambiance ludique" },
    { name: "Disney’s Art of Animation Resort", description: "Hôtel immersif dans les univers de Némo, Cars, Roi Lion et Petite Sirène. Suites familiales spacieuses.", pros: "Suites familiales, grande piscine, accès Skyliner" },
    { name: "Disney’s Caribbean Beach Resort", description: "Ambiance caribéenne, plages artificielles, piscine à thème, accès direct au Skyliner.", pros: "Piscine thématique, accès Skyliner, ambiance relaxante" },
    // ... Ajoutez d'autres hôtels ici selon vos besoins
];

function getHotelByName(name) {
    return DISNEY_HOTELS.find(h => h.name === name) || { name, description: "(Description non disponible)", pros: "" };
}

function formatDateFR(dateStr) {
    if (!dateStr) return "";
    try {
        const date = new Date(dateStr + 'T00:00:00');
        return date.toLocaleDateString('fr-FR', { year: 'numeric', month: 'long', day: 'numeric' });
    } catch {
        return dateStr;
    }
}
function formatTime(timeStr) {
    if (!timeStr) return "";
    const [h, m] = timeStr.split(':');
    return `${h}h${m}`;
}

function generateHotelTable(hotels) {
    let table = `<table class="responsive-table" style="margin-top:12px;">
        <thead>
            <tr>
                <th>Option</th>
                <th>Hôtel</th>
                <th>Description</th>
                <th>Prix (à remplir)</th>
                <th>Points forts</th>
            </tr>
        </thead>
        <tbody>`;
    hotels.forEach((name, idx) => {
        const h = getHotelByName(name);
        table += `<tr>
            <td data-label="Option">Option ${idx + 1}</td>
            <td data-label="Hôtel"><strong>${h.name}</strong></td>
            <td data-label="Description">${h.description}</td>
            <td data-label="Prix"><em style="color:#888;">À compléter</em></td>
            <td data-label="Points forts">${h.pros || '<em style="color:#888;">À compléter</em>'}</td>
        </tr>`;
    });
    table += '</tbody></table>';
    return table;
}

function generateEmailHTML(data) {
    let html = `<div style="font-family:Segoe UI,Arial,sans-serif;font-size:1em;color:#222;">`;
    html += `<h2 style="color:#0078c1;">Votre séjour Disney</h2>`;
    html += `<p>Bonjour <strong>${data.client_name || 'estimé(e) voyageur(se)'}</strong>,</p>`;
    html += `<p>Merci de nous avoir confié votre projet de voyage. Voici une proposition personnalisée selon vos critères.</p>`;

    // Hôtels
    const hotels = Array.isArray(data.hotel_names) ? data.hotel_names.filter(h => h) : [];
    if (data.booking_type === 'hotel_tickets' && hotels.length > 0) {
        if (hotels.length === 1) {
            const h = getHotelByName(hotels[0]);
            html += `<p>Nous vous proposons l'hébergement suivant :</p>
                <div style="margin:10px 0 16px 0;padding:12px 12px 10px 12px;background:#f0f7ff;border-radius:7px;">
                    <strong style="font-size:1.1em;">${h.name}</strong><br>
                    <span>${h.description}</span><br>
                    <span style="color:#0078c1;font-weight:600;">Prix : <em>À compléter</em></span><br>
                    <span><strong>Points forts :</strong> ${h.pros || '<em>À compléter</em>'}</span>
                </div>`;
        } else {
            html += `<p>Voici plusieurs options d’hébergement possibles. Comparez-les facilement dans le tableau ci-dessous :</p>`;
            html += generateHotelTable(hotels);
        }
        html += `<p style="margin-top:18px;"><strong>Avantages Disney :</strong></p>
        <ul>
            <li>Entrée anticipée dans les parcs (Early Theme Park Entry)</li>
            <li>Transport gratuit sur tout le site Disney</li>
            <li>Réservations simplifiées via l’application Disney Experience</li>
            <li>Service client Disney 24/7</li>
        </ul>`;
        html += `<p style="font-size:0.95em;color:#888;"><em>Les prix pour l’hébergement et les billets Disney sont en USD et sujets à disponibilité.</em></p>`;
    } else if (data.booking_type === 'tickets_only') {
        html += `<p>Vous trouverez en pièce jointe une proposition pour les billets de parc Disney.</p>`;
        html += `<p style="font-size:0.95em;color:#888;"><em>Les prix des billets Disney sont en USD et sujets à disponibilité.</em></p>`;
    }

    // Promotions
    html += `<hr style="margin:24px 0;">`;
    if (data.promotion_type === 'aucune') {
        html += `<p><strong>Promotion :</strong> Un dépôt de <strong>200 USD</strong> est requis pour garantir votre place. Ce dépôt est <strong>remboursable jusqu’à 30 jours avant l’arrivée</strong>.</p>`;
    } else {
        html += `<p><strong>Promotion :</strong> ${data.promotion_name ? `<strong>${data.promotion_name}</strong>` : ''} ${data.promotion_end_date ? `(jusqu’au ${formatDateFR(data.promotion_end_date)})` : ''}. Dépôt de <strong>200 USD</strong> requis, remboursable jusqu’à 30 jours avant l’arrivée.</p>`;
    }

    // Vols
    if (data.include_flights) {
        html += `<hr style="margin:24px 0;"><h2 style="color:#0078c1;">Détails des vols</h2>`;
        html += `<div style="margin:8px 0 14px 0;">
            <strong>Aller :</strong> ${formatDateFR(data.departure_date_aller)} à ${formatTime(data.departure_time_aller)}<br>
            De : ${data.departure_airport_aller || 'N/A'} → ${data.arrival_airport_aller || 'N/A'}
            <br>
            <strong>Retour :</strong> ${formatDateFR(data.departure_date_retour)} à ${formatTime(data.departure_time_retour)}<br>
            De : ${data.departure_airport_retour || 'N/A'} → ${data.arrival_airport_retour || 'N/A'}
            <br>
            <strong>Nombre de passagers :</strong> ${(parseInt(data.adults)||0)+(parseInt(data.children)||0)} (${data.adults} adulte(s)${data.children > 0 ? ', ' + data.children + ' enfant(s)' : ''})
            <br>
            <strong>Prix total estimé :</strong> ${data.flight_price ? data.flight_price + ' CAD' : '<em>À compléter</em>'}
        </div>`;
        if (data.flight_note) {
            html += `<div style="background:#fffbe6;border-left:4px solid #ffd700;padding:10px 12px;margin-bottom:10px;"><strong>Note sur les vols :</strong> ${data.flight_note}</div>`;
        }
        html += `<p style="font-size:0.95em;color:#888;"><em>Les prix des vols sont indicatifs et peuvent changer à tout moment.</em></p>
        <p><strong>IMPORTANT :</strong> Les tarifs aériens sont dynamiques jusqu’à la réservation. Des frais de service de 50$ CAD par personne s’appliquent pour la réservation via nos services.</p>`;
    }

    // Clôture
    html += `<hr style="margin:24px 0;">`;
    html += `<p>Je reste à votre disposition pour toute question ou pour ajuster cette proposition selon vos besoins. Merci pour votre confiance !</p>`;
    html += `<p>Cordialement,<br><strong>Pierre-Luc Morin</strong><br>Voyages en Route</p>`;
    html += `</div>`;
    return html;
}

// --- Gestion du formulaire et interactions
document.addEventListener('DOMContentLoaded', function() {
    const hotelSelectionsDiv = document.getElementById('hotel_selections');
    const addHotelButton = document.getElementById('add_hotel_button');
    function createHotelSelector(isFirst = false) {
        const hotelSelectionDiv = document.createElement('div');
        hotelSelectionDiv.classList.add('hotel-selection');
        const newSelect = document.createElement('select');
        newSelect.name = 'hotel_name[]';
        newSelect.classList.add('hotel-name-select');
        const placeholderOption = document.createElement('option');
        placeholderOption.value = "";
        placeholderOption.textContent = "Sélectionnez un hôtel";
        newSelect.appendChild(placeholderOption);
        DISNEY_HOTELS.forEach(hotel => {
            const option = document.createElement('option');
            option.value = hotel.name;
            option.textContent = hotel.name;
            newSelect.appendChild(option);
        });
        hotelSelectionDiv.appendChild(newSelect);
        if (!isFirst) {
            const removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.classList.add('remove-hotel-button');
            removeButton.textContent = '✕';
            removeButton.title = 'Supprimer cet hôtel';
            removeButton.addEventListener('click', function() {
                hotelSelectionDiv.remove();
                updateAddHotelButtonState();
            });
            hotelSelectionDiv.appendChild(removeButton);
        }
        return hotelSelectionDiv;
    }
    function updateAddHotelButtonState() {
        const currentHotelSelectors = hotelSelectionsDiv.querySelectorAll('.hotel-selection').length;
        addHotelButton.disabled = currentHotelSelectors >= 5;
        addHotelButton.textContent = currentHotelSelectors >= 5 ? "Maximum 5 hôtels atteints" : "Ajouter une option d'hôtel";
    }
    addHotelButton.addEventListener('click', function() {
        const currentHotelSelectors = hotelSelectionsDiv.querySelectorAll('.hotel-selection').length;
        if (currentHotelSelectors < 5) {
            hotelSelectionsDiv.appendChild(createHotelSelector());
            updateAddHotelButtonState();
        }
    });
    hotelSelectionsDiv.appendChild(createHotelSelector(true));
    updateAddHotelButtonState();

    const includeFlightsCheckbox = document.getElementById('include_flights');
    const flightDetailsDiv = document.getElementById('flight_details');
    const bookingTypeSelect = document.getElementById('booking_type');
    const hotelOptionsContainer = document.getElementById('hotel_options_container');
    const promotionTypeSelect = document.getElementById('promotion_type');
    const promotionDetailsDiv = document.getElementById('promotion_details');
    const form = document.getElementById('disneyForm');
    const emailOutputDiv = document.getElementById('emailOutput');
    const copyHtmlButton = document.getElementById('copyHtmlButton');

    function toggleFlightDetails() {
        flightDetailsDiv.classList.toggle('hidden', !includeFlightsCheckbox.checked);
    }
    function toggleHotelOptions() {
        const isHotelBooking = bookingTypeSelect.value === 'hotel_tickets';
        hotelOptionsContainer.classList.toggle('hidden', !isHotelBooking);
        if (isHotelBooking && hotelSelectionsDiv.children.length === 0) {
            hotelSelectionsDiv.appendChild(createHotelSelector(true));
        }
        updateAddHotelButtonState();
    }
    function togglePromotionDetails() {
        promotionDetailsDiv.classList.toggle('hidden', promotionTypeSelect.value !== 'specifique');
    }
    includeFlightsCheckbox.addEventListener('change', toggleFlightDetails);
    bookingTypeSelect.addEventListener('change', toggleHotelOptions);
    promotionTypeSelect.addEventListener('change', togglePromotionDetails);

    form.addEventListener('submit', function(event) {
        event.preventDefault();
        const formData = new FormData(form);
        const data = {};
        const hotelNameElements = form.querySelectorAll('select[name="hotel_name[]"]');
        data.hotel_names = Array.from(hotelNameElements).map(select => select.value).filter(Boolean);
        for (let [key, value] of formData.entries()) {
            if (key !== 'hotel_name[]') {
                if (key === 'include_flights') {
                    data[key] = true;
                } else {
                    data[key] = value;
                }
            }
        }
        if (!formData.has('include_flights')) {
            data.include_flights = false;
        }
        const emailHtmlContent = generateEmailHTML(data);
        emailOutputDiv.innerHTML = emailHtmlContent;
    });

    copyHtmlButton.addEventListener('click', function() {
        const range = document.createRange();
        range.selectNodeContents(emailOutputDiv);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        try {
            document.execCommand('copy');
            alert('Contenu copié !');
        } catch (err) {
            alert('Erreur copie.');
        }
        selection.removeAllRanges();
    });

    toggleFlightDetails();
    toggleHotelOptions();
    togglePromotionDetails();
});
</script>
</body>
</html>
