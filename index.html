<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur de courriels Disney - Voyages en Route</title>
    <style>
        /* Styles for the generator page itself (unchanged from your previous version) */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: linear-gradient(135deg, #2c3e50, #3498db); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .content { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; padding: 30px; }
        .form-section { background: #f8f9fa; padding: 25px; border-radius: 10px; border-left: 4px solid #3498db; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; transition: border-color 0.3s ease; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #3498db; box-shadow: 0 0 8px rgba(52, 152, 219, 0.2); }
        .checkbox-group { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .checkbox-group input[type="checkbox"] { width: auto; }
        .btn { width: 100%; padding: 15px; background: linear-gradient(135deg, #3498db, #2980b9); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3); }
        
        .output-section { background: #ffffff; border: 2px solid #e0e0e0; border-radius: 10px; padding: 25px; max-height: 800px; overflow-y: auto; }
        .output-section h2 { color: #2c3e50; margin-bottom: 20px; font-size: 1.6em; text-align: center; font-weight: 600; }
        
        /* Styles for the HTML code preview */
        .email-code-preview {
            font-family: 'Courier New', Courier, monospace; /* Monospace font for code */
            font-size: 13px;
            line-height: 1.5;
            white-space: pre-wrap; /* Preserve whitespace and newlines */
            word-wrap: break-word; /* Break long lines */
            background-color: #f4f4f4; /* Light background for code block */
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 5px;
            color: #333;
            max-height: 600px; /* Ensure it doesn't get too tall */
            overflow: auto; /* Add scrollbars if content overflows */
        }
        .email-code-preview code {
            font-family: inherit; /* Inherit from pre */
        }

        .copy-btn { margin-top: 20px; background: linear-gradient(135deg, #27ae60, #2ecc71); }
        .copy-btn:hover { background: linear-gradient(135deg, #2ecc71, #27ae60); transform: translateY(-2px); box-shadow: 0 8px 20px rgba(39, 174, 96, 0.3); }
        .hotel-option { border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 15px; background: white; position: relative; }
        .hotel-option h4 { color: #2c3e50; margin-bottom: 10px; margin-right: 90px; }
        .add-hotel-btn { background: linear-gradient(135deg, #e67e22, #d35400); padding: 10px 20px; margin-bottom: 15px; }
        .add-hotel-btn:hover { background: linear-gradient(135deg, #d35400, #e67e22); transform: translateY(-2px); box-shadow: 0 8px 20px rgba(230, 126, 34, 0.3); }
        .remove-hotel-btn { background: linear-gradient(135deg, #e74c3c, #c0392b) !important; color: white !important; border: none !important; padding: 8px 15px !important; border-radius: 5px !important; cursor: pointer !important; transition: transform 0.2s ease, box-shadow 0.2s ease !important; font-size: 0.9em; position: absolute; top: 15px; right: 15px; }
        .remove-hotel-btn:hover { transform: translateY(-2px) !important; box-shadow: 0 6px 15px rgba(231, 76, 60, 0.3) !important; }

        @media (max-width: 768px) {
            .content { grid-template-columns: 1fr; }
            .hotel-option h4 { margin-right: 0; }
            .remove-hotel-btn { position: relative; float: none; display: block; margin-top: 10px; top: auto; right: auto; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè∞ G√©n√©rateur de courriels Disney</h1>
            <p>Voyages en Route - Sp√©cialiste Disney & Universal</p>
        </div>
        
        <div class="content">
            <div class="form-section">
                <h2>Informations du voyage</h2>
                {/* Form content remains the same as your previous version */}
                <div class="form-group">
                    <label for="langue">Langue du courriel :</label>
                    <select id="langue">
                        <option value="fr">Fran√ßais</option>
                        <option value="en">English</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="nomClient">Nom du client :</label>
                    <input type="text" id="nomClient" placeholder="Nom complet du client">
                </div>
                <div class="form-group">
                    <label for="nbAdultes">Nombre d'adultes :</label>
                    <input type="number" id="nbAdultes" min="1" value="2">
                </div>
                <div class="form-group">
                    <label for="nbEnfants">Nombre d'enfants :</label>
                    <input type="number" id="nbEnfants" min="0" value="0">
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="billetSeulement">
                    <label for="billetSeulement">Billets seulement (pas d'h√¥tel)</label>
                </div>
                <div id="hotelSection">
                    <button type="button" class="btn add-hotel-btn" onclick="ajouterHotel()">+ Ajouter un h√¥tel</button>
                    <div id="hotelOptions"></div>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="avionInclus">
                    <label for="avionInclus">Avion inclus</label>
                </div>
                <div id="avionSection" style="display: none;">
                    <div class="form-group">
                        <label for="dateAller">Date et heure de d√©part :</label>
                        <input type="datetime-local" id="dateAller">
                    </div>
                    <div class="form-group">
                        <label for="aeroportDepart">A√©roport de d√©part :</label>
                        <input type="text" id="aeroportDepart" placeholder="Ex: YUL - Montr√©al">
                    </div>
                    <div class="form-group">
                        <label for="dateRetour">Date et heure de retour :</label>
                        <input type="datetime-local" id="dateRetour">
                    </div>
                    <div class="form-group">
                        <label for="aeroportRetour">A√©roport de retour :</label>
                        <input type="text" id="aeroportRetour" placeholder="Ex: MCO - Orlando">
                    </div>
                    <div class="form-group">
                        <label for="prixAvion">Prix total avion (CAD) :</label> 
                        <input type="number" id="prixAvion" placeholder="0">
                    </div>
                </div>
                <div class="form-group">
                    <label for="promotion">Promotion applicable :</label>
                    <input type="text" id="promotion" placeholder="Nom de la promotion ou laissez vide si aucune">
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="promotionDateFin">
                    <label for="promotionDateFin">La promotion a une date de fin connue</label>
                </div>
                <button type="button" class="btn" onclick="genererCourriel()">G√©n√©rer le courriel</button>
            </div>

            <div class="output-section">
                <h2>Code HTML du Courriel</h2> {/* MODIFIED TITLE */}
                <div id="emailPreviewContainer" class="email-code-preview"> {/* MODIFIED class for styling the code view */}
                    <code>{/* Generated HTML code will appear here, escaped */}</code>
                </div>
                <button type="button" class="btn copy-btn" onclick="copierCourriel()">üìã Copier le Code HTML</button> {/* MODIFIED BUTTON TEXT */}
            </div>
        </div>
    </div>

    <script>
        const hotelsList = [ /* ... Same as before ... */ 
             "Bay Lake Tower at Disney's Contemporary Resort", "Boulder Ridge Villas at Disney's Wilderness Lodge", "Copper Creek Villas & Cabins √† Disney's Wilderness Lodge", "Disney's All-Star Movies Resort", "Disney's All-Star Music Resort", "Disney's All-Star Sports Resort", "Disney's Animal Kingdom Lodge", "Disney's Animal Kingdom Villas - Jambo House", "Disney's Animal Kingdom Villas - Kidani Village", "Disney's Art of Animation Resort", "Disney's Beach Club Resort", "Disney's Beach Club Villas", "Disney's BoardWalk Inn", "Disney's BoardWalk Villas", "Disney's Caribbean Beach Resort", "Disney's Contemporary Resort", "Disney's Coronado Springs Resort", "Disney's Grand Floridian Resort & Spa", "Disney's Old Key West Resort", "Disney's Polynesian Village Resort", "Disney's Polynesian Villas & Bungalows", "Disney's Pop Century Resort", "Disney's Port Orleans Resort - French Quarter", "Disney's Port Orleans Resort - Riverside", "Disney's Saratoga Springs Resort & Spa", "Disney's Wilderness Lodge", "Disney's Yacht Club Resort", "Disney's Riviera Resort", "The Cabins at Disney's Fort Wilderness Resort", "The Cabins at Disney's Fort Wilderness Resort ‚Äì A Disney Vacation Club Resort", "Les terrains de camping au Disney's Fort Wilderness Resort", "Les villas au Disney's Grand Floridian Resort & Spa"
        ];
        const hotelDescriptions = { /* ... Same as before ... */ 
            "Bay Lake Tower at Disney's Contemporary Resort": { fr: "CAT√âGORIE DELUXE VILLA - Complexe Disney Vacation Club moderne au th√®me contemporain/futuriste. Situ√© adjacent au Contemporary Resort avec acc√®s monorail direct au Magic Kingdom. Villas spacieuses avec cuisinettes, vue sur Magic Kingdom ou Bay Lake. Avantages : Early Theme Park Entry, piscine avec toboggan, restaurants sur place, acc√®s aux installations du Contemporary Resort.", en: "DELUXE VILLA CATEGORY - Modern Disney Vacation Club resort with contemporary/futuristic theme. Located adjacent to Contemporary Resort with direct monorail access to Magic Kingdom. Spacious villas with kitchenettes, Magic Kingdom or Bay Lake views. Benefits: Early Theme Park Entry, pool with slide, on-site restaurants, access to Contemporary Resort amenities." },
            "Boulder Ridge Villas at Disney's Wilderness Lodge": { fr: "CAT√âGORIE DELUXE VILLA - Villas Disney Vacation Club au th√®me des parcs nationaux am√©ricains dans une ambiance de lodge rustique. Architecture inspir√©e du Old Faithful Inn. Villas avec cuisinettes, balcons donnant sur la for√™t ou la cour. Avantages : Early Theme Park Entry, piscines th√©matiques, transport en bateau vers Magic Kingdom, restaurants signature.", en: "DELUXE VILLA CATEGORY - Disney Vacation Club villas with American national parks theme in rustic lodge atmosphere. Architecture inspired by Old Faithful Inn. Villas with kitchenettes, balconies overlooking forest or courtyard. Benefits: Early Theme Park Entry, themed pools, boat transportation to Magic Kingdom, signature restaurants." },
            "Copper Creek Villas & Cabins √† Disney's Wilderness Lodge": { fr: "CAT√âGORIE DELUXE VILLA - Villas et cabines Disney Vacation Club au th√®me des parcs nationaux dans un cadre de nature sauvage. Nouvelles villas avec cuisinettes compl√®tes, cabines isol√©es en for√™t. Ambiance rustique luxueuse. Avantages : Early Theme Park Entry, piscines avec toboggan, transport en bateau, spa Senses, restaurants gastronomiques.", en: "DELUXE VILLA CATEGORY - Disney Vacation Club villas and cabins with national parks theme in wilderness setting. New villas with full kitchenettes, secluded forest cabins. Luxurious rustic atmosphere. Benefits: Early Theme Park Entry, pools with slide, boat transportation, Senses Spa, gourmet restaurants." },
            "Disney's All-Star Movies Resort": { fr: "CAT√âGORIE VALUE - H√¥tel th√©matique c√©l√©brant les films Disney classiques avec des ic√¥nes g√©antes (101 Dalmatiens, Toy Story, Fantasia, Love Bug, Mighty Ducks). Chambres standard √©conomiques pour familles. Avantages : Early Theme Park Entry, piscines th√©matiques, aires de jeux, food court, transport en autobus vers tous les parcs.", en: "VALUE CATEGORY - Themed hotel celebrating classic Disney movies with giant icons (101 Dalmatians, Toy Story, Fantasia, Love Bug, Mighty Ducks). Budget-friendly standard rooms for families. Benefits: Early Theme Park Entry, themed pools, playgrounds, food court, bus transportation to all parks." },
            "Disney's All-Star Music Resort": { fr: "CAT√âGORIE VALUE - H√¥tel th√©matique d√©di√© √† la musique avec des sections country, jazz, rock, calypso et Broadway. D√©corations musicales g√©antes color√©es. Chambres standard abordables. Avantages : Early Theme Park Entry, piscines th√©matiques avec musique, aires de jeux, food court, transport en autobus.", en: "VALUE CATEGORY - Music-themed hotel with country, jazz, rock, calypso and Broadway sections. Giant colorful musical decorations. Affordable standard rooms. Benefits: Early Theme Park Entry, themed pools with music, playgrounds, food court, bus transportation." },
            "Disney's All-Star Sports Resort": { fr: "CAT√âGORIE VALUE - H√¥tel sportif avec sections baseball, football am√©ricain, tennis, basketball et surf. D√©corations sportives g√©antes et terrains de jeux. Chambres standard √©conomiques parfaites pour les familles actives. Avantages : Early Theme Park Entry, piscines th√©matiques, terrains de sport, food court, transport en autobus.", en: "VALUE CATEGORY - Sports-themed hotel with baseball, football, tennis, basketball and surfing sections. Giant sports decorations and playing fields. Budget standard rooms perfect for active families. Benefits: Early Theme Park Entry, themed pools, sports courts, food court, bus transportation." },
            "Disney's Animal Kingdom Lodge": { fr: "CAT√âGORIE DELUXE - H√¥tel safari luxueux avec architecture africaine authentique o√π plus de 200 animaux √©voluent dans 4 savanes. Chambres avec vue sur savane ou piscine. Restaurants africains prim√©s. Avantages : Early Theme Park Entry, piscines avec toboggan, programmes √©ducatifs animaliers, restaurants signature, spa Senses.", en: "DELUXE CATEGORY - Luxurious safari hotel with authentic African architecture where over 200 animals roam 4 savannas. Rooms with savanna or pool views. Award-winning African restaurants. Benefits: Early Theme Park Entry, pools with slide, animal educational programs, signature restaurants, Senses Spa." },
            "Disney's Animal Kingdom Villas - Jambo House": { fr: "CAT√âGORIE DELUXE VILLA - Villas Disney Vacation Club dans le b√¢timent principal d'Animal Kingdom Lodge. Architecture africaine avec vue sur les savanes peupl√©es d'animaux. Villas avec cuisinettes, balcons donnant sur la savane. Avantages : Early Theme Park Entry, observation d'animaux 24h/24, piscines th√©matiques, restaurants africains, programmes √©ducatifs.", en: "DELUXE VILLA CATEGORY - Disney Vacation Club villas in the main Animal Kingdom Lodge building. African architecture with animal-populated savanna views. Villas with kitchenettes, savanna-view balconies. Benefits: Early Theme Park Entry, 24/7 animal viewing, themed pools, African restaurants, educational programs." },
            "Disney's Animal Kingdom Villas - Kidani Village": { fr: "CAT√âGORIE DELUXE VILLA - Villas Disney Vacation Club avec th√®me africain et savanes priv√©es. Architecture inspir√©e de village africain traditionnel. Villas spacieuses avec cuisinettes compl√®tes, terrasses avec vue sur savane. Avantages : Early Theme Park Entry, savanes exclusives, piscines avec aire de jeux aquatique, restaurants, programmes animaliers.", en: "DELUXE VILLA CATEGORY - Disney Vacation Club villas with African theme and private savannas. Architecture inspired by traditional African village. Spacious villas with full kitchenettes, savanna-view terraces. Benefits: Early Theme Park Entry, exclusive savannas, pools with water play area, restaurants, animal programs." },
            "Disney's Art of Animation Resort": { fr: "CAT√âGORIE VALUE - H√¥tel immersif c√©l√©brant l'animation Disney avec sections La Petite Sir√®ne, Le Roi Lion, Cars et Nemo. Chambres standard et suites familiales. D√©corations spectaculaires grandeur nature. Avantages : Early Theme Park Entry, plus grande piscine Disney World (Big Blue Pool), aires de jeux th√©matiques, food court, transport en autobus.", en: "VALUE CATEGORY - Immersive hotel celebrating Disney animation with Little Mermaid, Lion King, Cars and Finding Nemo sections. Standard rooms and family suites. Spectacular life-size decorations. Benefits: Early Theme Park Entry, Disney World's largest pool (Big Blue Pool), themed playgrounds, food court, bus transportation." },
            "Disney's Beach Club Resort": { fr: "CAT√âGORIE DELUXE - H√¥tel √©l√©gant au th√®me nautique de la Nouvelle-Angleterre des ann√©es 1870. Situ√© pr√®s d'EPCOT avec plage de sable et la spectaculaire Stormalong Bay. Chambres luxueuses avec balcons. Avantages : Early Theme Park Entry, acc√®s √† pied √† EPCOT et Hollywood Studios, Stormalong Bay (3 acres), restaurants signature, spa.", en: "DELUXE CATEGORY - Elegant hotel with 1870s New England nautical theme. Located near EPCOT with sandy beach and spectacular Stormalong Bay. Luxurious rooms with balconies. Benefits: Early Theme Park Entry, walking distance to EPCOT and Hollywood Studios, Stormalong Bay (3 acres), signature restaurants, spa." },
            "Disney's Beach Club Villas": { fr: "CAT√âGORIE DELUXE VILLA - Villas Disney Vacation Club adjacentes au Beach Club Resort avec m√™me th√®me nautique √©l√©gant. Villas avec cuisinettes, proche d'EPCOT. Acc√®s √† Stormalong Bay. Avantages : Early Theme Park Entry, acc√®s √† pied aux parcs EPCOT/Hollywood Studios, Stormalong Bay, restaurants du Beach Club, transport en bateau.", en: "DELUXE VILLA CATEGORY - Disney Vacation Club villas adjacent to Beach Club Resort with same elegant nautical theme. Villas with kitchenettes, near EPCOT. Access to Stormalong Bay. Benefits: Early Theme Park Entry, walking distance to EPCOT/Hollywood Studios, Stormalong Bay, Beach Club restaurants, boat transportation." },
            "Disney's BoardWalk Inn": { fr: "CAT√âGORIE DELUXE - H√¥tel romantique inspir√© du boardwalk atlantique des ann√©es 1930 avec promenade anim√©e. Architecture victorienne color√©e, divertissements de rue, boutiques. Avantages : Early Theme Park Entry, acc√®s √† pied √† EPCOT et Hollywood Studios, BoardWalk avec restaurants et bars, piscines th√©matiques, spa, transport en bateau.", en: "DELUXE CATEGORY - Romantic hotel inspired by 1930s Atlantic boardwalk with lively promenade. Colorful Victorian architecture, street entertainment, shops. Benefits: Early Theme Park Entry, walking distance to EPCOT and Hollywood Studios, BoardWalk with restaurants and bars, themed pools, spa, boat transportation." },
            "Disney's BoardWalk Villas": { fr: "CAT√âGORIE DELUXE VILLA - Villas Disney Vacation Club sur le BoardWalk avec th√®me ann√©es 1930. Villas avec cuisinettes, balcons donnant sur le BoardWalk ou jardins. Ambiance festive permanente. Avantages : Early Theme Park Entry, acc√®s √† pied aux parcs, divertissements sur le BoardWalk, restaurants et bars, piscines, transport en bateau.", en: "DELUXE VILLA CATEGORY - Disney Vacation Club villas on the BoardWalk with 1930s theme. Villas with kitchenettes, balconies overlooking BoardWalk or gardens. Permanent festive atmosphere. Benefits: Early Theme Park Entry, walking distance to parks, BoardWalk entertainment, restaurants and bars, pools, boat transportation." },
            "Disney's Caribbean Beach Resort": { fr: "CAT√âGORIE MODERATE - Complexe tropical inspir√© des Cara√Øbes avec 6 villages color√©s autour du lac Barefoot Bay. Th√®me pirate avec secteur Skyliner. Chambres r√©nov√©es avec mobilier tropical. Avantages : Early Theme Park Entry, Skyliner vers EPCOT/Hollywood Studios, plages de sable, piscines avec forteresse pirate, restaurants, bars.", en: "MODERATE CATEGORY - Tropical resort inspired by the Caribbean with 6 colorful villages around Barefoot Bay lake. Pirate theme with Skyliner section. Renovated rooms with tropical furnishings. Benefits: Early Theme Park Entry, Skyliner to EPCOT/Hollywood Studios, sandy beaches, pools with pirate fortress, restaurants, bars." },
            "Disney's Contemporary Resort": { fr: "CAT√âGORIE DELUXE - H√¥tel iconique futuriste en forme de A o√π le monorail traverse le hall principal. Architecture moderne des ann√©es 1970, vue sur Magic Kingdom et Bay Lake. Avantages : Early Theme Park Entry, monorail direct vers Magic Kingdom, restaurants signature dont California Grill, piscines, plage, spa, marina.", en: "DELUXE CATEGORY - Iconic futuristic A-frame hotel where monorail runs through main lobby. Modern 1970s architecture, Magic Kingdom and Bay Lake views. Benefits: Early Theme Park Entry, direct monorail to Magic Kingdom, signature restaurants including California Grill, pools, beach, spa, marina." },
            "Disney's Coronado Springs Resort": { fr: "CAT√âGORIE MODERATE - Complexe au th√®me du Sud-Ouest am√©ricain et Mexique avec lac artificiel de 15 acres. Tour Gran Destino r√©cemment ajout√©e. Chambres r√©nov√©es, centre de congr√®s. Avantages : Early Theme Park Entry, restaurants vari√©s dont rooftop, piscines avec pyramide maya, spa, centre de fitness, transport en autobus.", en: "MODERATE CATEGORY - Resort with American Southwest and Mexican theme featuring 15-acre man-made lake. Recently added Gran Destino Tower. Renovated rooms, convention center. Benefits: Early Theme Park Entry, varied restaurants including rooftop, pools with Mayan pyramid, spa, fitness center, bus transportation." },
            "Disney's Grand Floridian Resort & Spa": { fr: "CAT√âGORIE DELUXE - Le plus luxueux h√¥tel Disney avec th√®me victorien √©l√©gant de la Floride des ann√©es 1880. Architecture blanche majestueuse, orchestre dans le hall. Service de conciergerie disponible. Avantages : Early Theme Park Entry, monorail vers Magic Kingdom, restaurants gastronomiques, spa Senses complet, plage priv√©e, marina, mariage Disney.", en: "DELUXE CATEGORY - Disney's most luxurious hotel with elegant Victorian Florida 1880s theme. Majestic white architecture, lobby orchestra. Concierge service available. Benefits: Early Theme Park Entry, monorail to Magic Kingdom, gourmet restaurants, full Senses Spa, private beach, marina, Disney weddings." },
            "Disney's Old Key West Resort": { fr: "CAT√âGORIE DELUXE VILLA - Premier complexe Disney Vacation Club avec th√®me des Keys de Floride. Villas spacieuses style maisons de vacances avec cuisinettes compl√®tes, terrasses priv√©es. Ambiance d√©contract√©e de village. Avantages : Early Theme Park Entry, villas les plus spacieuses, piscines paisibles, terrain de golf, restaurants, transport en bateau vers Disney Springs.", en: "DELUXE VILLA CATEGORY - First Disney Vacation Club resort with Florida Keys theme. Spacious vacation home-style villas with full kitchenettes, private porches. Relaxed village atmosphere. Benefits: Early Theme Park Entry, most spacious villas, peaceful pools, golf course, restaurants, boat transportation to Disney Springs." },
            "Disney's Polynesian Village Resort": { fr: "CAT√âGORIE DELUXE - Paradis tropical inspir√© des √Æles du Pacifique Sud avec plages de sable volcanique. B√¢timents longhouses polyn√©siens, v√©g√©tation luxuriante. Ambiance Tiki romantique. Avantages : Early Theme Park Entry, monorail vers Magic Kingdom, restaurants polyn√©siens authentiques, plage avec feux de camp, piscines volcaniques, spa, spirit d'Aloha.", en: "DELUXE CATEGORY - Tropical paradise inspired by South Pacific islands with volcanic sand beaches. Polynesian longhouse buildings, lush vegetation. Romantic Tiki atmosphere. Benefits: Early Theme Park Entry, monorail to Magic Kingdom, authentic Polynesian restaurants, beach with campfires, volcanic pools, spa, spirit of Aloha." },
            "Disney's Polynesian Villas & Bungalows": { fr: "CAT√âGORIE DELUXE VILLA - Villas et bungalows Disney Vacation Club avec th√®me polyn√©sien authentique. Bungalows sur pilotis au-dessus du Seven Seas Lagoon, villas dans les arbres. Vues spectaculaires sur Magic Kingdom. Avantages : Early Theme Park Entry, bungalows uniques sur l'eau, monorail, vues sur feux d'artifice, restaurants polyn√©siens, plages priv√©es.", en: "DELUXE VILLA CATEGORY - Disney Vacation Club villas and bungalows with authentic Polynesian theme. Overwater bungalows above Seven Seas Lagoon, tree-house villas. Spectacular Magic Kingdom views. Benefits: Early Theme Park Entry, unique overwater bungalows, monorail, fireworks views, Polynesian restaurants, private beaches." },
            "Disney's Pop Century Resort": { fr: "CAT√âGORIE VALUE - H√¥tel nostalgique c√©l√©brant la culture pop am√©ricaine des d√©cennies 1950-1990. Ic√¥nes g√©antes color√©es (yo-yo, t√©l√©phones, etc.). Chambres r√©nov√©es avec mobilier moderne. Avantages : Early Theme Park Entry, Skyliner vers EPCOT/Hollywood Studios, piscines th√©matiques par d√©cennie, food court, transport rapide, prix abordable.", en: "VALUE CATEGORY - Nostalgic hotel celebrating American pop culture from 1950s-1990s decades. Giant colorful icons (yo-yo, phones, etc.). Renovated rooms with modern furnishings. Benefits: Early Theme Park Entry, Skyliner to EPCOT/Hollywood Studios, decade-themed pools, food court, rapid transportation, affordable pricing." },
            "Disney's Port Orleans Resort - French Quarter": { fr: "CAT√âGORIE MODERATE - H√¥tel au charme intime du Vieux Carr√© fran√ßais de La Nouvelle-Orl√©ans. Architecture cr√©ole, cours paisibles, ambiance jazz. Plus petit et romantique des resorts mod√©r√©s. Avantages : Early Theme Park Entry, transport en bateau vers Disney Springs, piscines avec toboggan dragon, restaurants cajuns, bars, atmosph√®re authentique.", en: "MODERATE CATEGORY - Hotel with intimate French Quarter New Orleans charm. Creole architecture, peaceful courtyards, jazz atmosphere. Smallest and most romantic of moderate resorts. Benefits: Early Theme Park Entry, boat transportation to Disney Springs, pools with dragon slide, Cajun restaurants, bars, authentic atmosphere." },
            "Disney's Port Orleans Resort - Riverside": { fr: "CAT√âGORIE MODERATE - Grand complexe au th√®me du Sud am√©ricain avec sections plantation et bayou. Architecture antebellum, jardins luxuriants, rivi√®re Sassagoula. Chambres Royal Guest rooms dans Alligator Bayou. Avantages : Early Theme Park Entry, transport en bateau vers Disney Springs, piscines avec aire de jeux, restaurants du Sud, location de v√©los, p√™che.", en: "MODERATE CATEGORY - Large resort with American South theme featuring plantation and bayou sections. Antebellum architecture, lush gardens, Sassagoula River. Royal Guest rooms in Alligator Bayou. Benefits: Early Theme Park Entry, boat transportation to Disney Springs, pools with play area, Southern restaurants, bike rentals, fishing." },
            "Disney's Saratoga Springs Resort & Spa": { fr: "CAT√âGORIE DELUXE VILLA - Villas Disney Vacation Club inspir√©es des sources thermales victorieuses de Saratoga Springs, NY. Architecture victorienne √©l√©gante, terrains de golf, lac. Villas spacieuses avec cuisinettes. Avantages : Early Theme Park Entry, transport en bateau vers Disney Springs, spa Senses, golf, piscines paisibles, restaurants, villas tr√®s spacieuses.", en: "DELUXE VILLA CATEGORY - Disney Vacation Club villas inspired by Victorian Saratoga Springs, NY hot springs. Elegant Victorian architecture, golf course, lake. Spacious villas with kitchenettes. Benefits: Early Theme Park Entry, boat transportation to Disney Springs, Senses Spa, golf, peaceful pools, restaurants, very spacious villas." },
            "Disney's Wilderness Lodge": { fr: "CAT√âGORIE DELUXE - Lodge rustique inspir√© des parcs nationaux am√©ricains avec architecture de rondins monumentale. Hall impressionnant avec chemin√©e g√©ante, geyser artificiel. Ambiance nature authentique. Avantages : Early Theme Park Entry, transport en bateau vers Magic Kingdom, piscines avec sources chaudes, restaurants signature, spa, programmes nature.", en: "DELUXE CATEGORY - Rustic lodge inspired by American national parks with monumental log architecture. Impressive lobby with giant fireplace, artificial geyser. Authentic nature atmosphere. Benefits: Early Theme Park Entry, boat transportation to Magic Kingdom, pools with hot springs, signature restaurants, spa, nature programs." },
            "Disney's Yacht Club Resort": { fr: "CAT√âGORIE DELUXE - H√¥tel nautique √©l√©gant inspir√© des yacht clubs de Nouvelle-Angleterre des ann√©es 1880. Architecture bleu et blanc sophistiqu√©e, ambiance maritime de luxe. Avantages : Early Theme Park Entry, acc√®s √† pied √† EPCOT et Hollywood Studios, Stormalong Bay (partag√©e avec Beach Club), restaurants signature, spa, plage, transport en bateau.", en: "DELUXE CATEGORY - Elegant nautical hotel inspired by 1880s New England yacht clubs. Sophisticated blue and white architecture, luxury maritime atmosphere. Benefits: Early Theme Park Entry, walking distance to EPCOT and Hollywood Studios, Stormalong Bay (shared with Beach Club), signature restaurants, spa, beach, boat transportation." },
            "Disney's Riviera Resort": { fr: "CAT√âGORIE DELUXE VILLA - Nouveau complexe Disney Vacation Club (2019) au th√®me de la Riviera europ√©enne avec art Disney. Architecture m√©diterran√©enne √©l√©gante, terrasse sur le toit. Villas modernes avec cuisinettes. Avantages : Early Theme Park Entry, Skyliner vers EPCOT/Hollywood Studios, restaurants raffin√©s dont rooftop, piscines avec toboggan, art Disney exclusif, villas contemporaines.", en: "DELUXE VILLA CATEGORY - New Disney Vacation Club resort (2019) with European Riviera theme featuring Disney art. Elegant Mediterranean architecture, rooftop terrace. Modern villas with kitchenettes. Benefits: Early Theme Park Entry, Skyliner to EPCOT/Hollywood Studios, refined restaurants including rooftop, pools with slide, exclusive Disney art, contemporary villas." },
            "The Cabins at Disney's Fort Wilderness Resort": { fr: "CAT√âGORIE MODERATE - Cabines rustiques dans une for√™t de 750 acres pour une exp√©rience de camping de luxe. Cabines avec cuisinettes compl√®tes, terrasses avec barbecue. Ambiance nature authentique avec cerfs et lapins. Avantages : Early Theme Park Entry, transport en bateau vers Magic Kingdom, activit√©s de plein air, feux de camp avec guimauves, piscines, location de v√©los et voiturettes de golf.", en: "MODERATE CATEGORY - Rustic cabins in 750-acre forest for luxury camping experience. Cabins with full kitchenettes, decks with grills. Authentic nature atmosphere with deer and rabbits. Benefits: Early Theme Park Entry, boat transportation to Magic Kingdom, outdoor activities, campfires with marshmallows, pools, bike and golf cart rentals." },
            "The Cabins at Disney's Fort Wilderness Resort ‚Äì A Disney Vacation Club Resort": { fr: "CAT√âGORIE DELUXE VILLA - Cabines Disney Vacation Club r√©nov√©es dans la for√™t de Fort Wilderness. Cabines spacieuses avec cuisinettes compl√®tes, terrasses dans la nature. Exp√©rience unique de 'glamping' Disney. Avantages : Early Theme Park Entry, transport en bateau vers Magic Kingdom, activit√©s nature, feux de camp Disney, piscines, vie sauvage, location d'√©quipements de plein air.", en: "DELUXE VILLA CATEGORY - Renovated Disney Vacation Club cabins in Fort Wilderness forest. Spacious cabins with full kitchenettes, nature decks. Unique Disney 'glamping' experience. Benefits: Early Theme Park Entry, boat transportation to Magic Kingdom, nature activities, Disney campfires, pools, wildlife, outdoor equipment rentals." },
            "Les terrains de camping au Disney's Fort Wilderness Resort": { fr: "CAT√âGORIE MODERATE - Terrains de camping dans une for√™t de 750 acres pour VR, roulottes et tentes. Sites avec hookups complets, certains en bord de lac. Exp√©rience camping authentique avec commodit√©s Disney. Avantages : Early Theme Park Entry, transport en bateau vers Magic Kingdom, activit√©s familiales, feux de camp avec personnages Disney, piscines, location d'√©quipements, magasins g√©n√©ral.", en: "MODERATE CATEGORY - Campgrounds in 750-acre forest for RVs, trailers and tents. Sites with full hookups, some lakefront. Authentic camping experience with Disney amenities. Benefits: Early Theme Park Entry, boat transportation to Magic Kingdom, family activities, campfires with Disney characters, pools, equipment rentals, general store." },
            "Les villas au Disney's Grand Floridian Resort & Spa": { fr: "CAT√âGORIE DELUXE VILLA - Villas Disney Vacation Club dans le plus prestigieux h√¥tel Disney avec √©l√©gance victorienne. Villas luxueuses avec cuisinettes, certaines avec vue sur Magic Kingdom. Service exceptionnel. Avantages : Early Theme Park Entry, monorail vers Magic Kingdom, restaurants gastronomiques, spa Senses complet, plage priv√©e, service de conciergerie, mariage Disney.", en: "DELUXE VILLA CATEGORY - Disney Vacation Club villas in Disney's most prestigious hotel with Victorian elegance. Luxurious villas with kitchenettes, some with Magic Kingdom views. Exceptional service. Benefits: Early Theme Park Entry, monorail to Magic Kingdom, gourmet restaurants, full Senses Spa, private beach, concierge service, Disney weddings." }
        };

        let generatedHtmlEmail = ''; // MODIFIED: Variable to hold the generated HTML email code

        document.getElementById('avionInclus').addEventListener('change', function() {
            document.getElementById('avionSection').style.display = this.checked ? 'block' : 'none';
        });

        document.getElementById('billetSeulement').addEventListener('change', function() {
            document.getElementById('hotelSection').style.display = this.checked ? 'none' : 'block';
            if(this.checked) { 
                document.getElementById('hotelOptions').innerHTML = '';
            } else {
                if (document.getElementById('hotelOptions').childElementCount === 0) ajouterHotel();
            }
        });

        function ajouterHotel() {
            const hotelDiv = document.createElement('div');
            hotelDiv.className = 'hotel-option';
            const uniqueDivId = `hotel_div_${Date.now()}_${Math.random().toString(36).substr(2, 5)}`; 
            hotelDiv.id = uniqueDivId;
            const hotelNumber = document.getElementById('hotelOptions').childElementCount + 1;
            const selectId = `hotelSelect_${uniqueDivId}`;

            hotelDiv.innerHTML = `
                <button type="button" class="remove-hotel-btn" onclick="supprimerHotel('${uniqueDivId}')">Supprimer</button>
                <h4>H√¥tel Option ${hotelNumber}</h4>
                <div class="form-group">
                    <label for="${selectId}">S√©lectionner l'h√¥tel :</label>
                    <select id="${selectId}" class="hotel-select-dropdown">
                        <option value="">-- Choisir un h√¥tel --</option>
                        ${hotelsList.map(hotel => `<option value="${hotel}">${hotel}</option>`).join('')}
                    </select>
                </div>
            `;
            document.getElementById('hotelOptions').appendChild(hotelDiv);
        }

        function supprimerHotel(id) {
            const hotelDiv = document.getElementById(id);
            if (hotelDiv) {
                hotelDiv.remove();
                const hotelOptionsContainer = document.getElementById('hotelOptions');
                const remainingHotels = hotelOptionsContainer.getElementsByClassName('hotel-option');
                for (let i = 0; i < remainingHotels.length; i++) {
                    remainingHotels[i].querySelector('h4').textContent = `H√¥tel Option ${i + 1}`;
                }
            }
        }
        
        // MODIFIED: This function now generates HTML for hotel descriptions
        function formaterDescriptionHotelHTML(description, langue, styles) {
            if (!description) return "";
            let htmlOutput = "";
            const categorieKey = langue === 'fr' ? "CAT√âGORIE" : "CATEGORY";
            const avantagesKey = langue === 'fr' ? "Avantages :" : "Benefits:";
            
            const categorieMatch = description.match(new RegExp(`^(${categorieKey}[^-]+?) - `, "i"));
            let restDescription = description;

            if (categorieMatch && categorieMatch[1]) {
                htmlOutput += `<p style="${styles.p} ${styles.em}">${categorieMatch[1].trim()}</p>`;
                restDescription = description.substring(categorieMatch[0].length); 
            }

            const avantagesIndex = restDescription.toLowerCase().indexOf(avantagesKey.toLowerCase());
            if (avantagesIndex !== -1) {
                const mainDescText = restDescription.substring(0, avantagesIndex).trim();
                const originalAvantagesKey = restDescription.substring(avantagesIndex, avantagesIndex + avantagesKey.length);
                const avantagesText = restDescription.substring(avantagesIndex + avantagesKey.length).trim();

                if (mainDescText) htmlOutput += `<p style="${styles.p}">${mainDescText.replace(/\n/g, "<br>")}</p>`;
                htmlOutput += `<p style="${styles.p} ${styles.strong}">${originalAvantagesKey}</p>`;
                htmlOutput += `<ul style="${styles.ul}">`;
                const avantagesList = avantagesText.split(/,\s*(?![^()]*\))/); 
                avantagesList.forEach(avantage => {
                    if (avantage.trim()) {
                       htmlOutput += `<li style="${styles.li}">${avantage.trim()}</li>`;
                    }
                });
                htmlOutput += `</ul>`;
            } else {
                 if (restDescription.trim()) htmlOutput += `<p style="${styles.p}">${restDescription.replace(/\n/g, "<br>")}</p>`;
            }
            return htmlOutput;
        }

        function obtenirDescriptionHotel(nomHotel, langue) {
            // ... (this function remains the same)
            if (hotelDescriptions[nomHotel] && hotelDescriptions[nomHotel][langue]) {
                return hotelDescriptions[nomHotel][langue];
            }
            if (langue === 'fr') {
                return "CAT√âGORIE NON SP√âCIFI√âE - Un magnifique h√¥tel Disney offrant le confort et la magie Disney dans un cadre enchanteur. Avantages : Early Theme Park Entry.";
            } else {
                return "CATEGORY UNSPECIFIED - A beautiful Disney hotel offering comfort and Disney magic in an enchanting setting. Benefits: Early Theme Park Entry.";
            }
        }
        
        // MODIFIED: This function now generates an HTML email string
        function genererCourriel() {
            const langue = document.getElementById('langue').value;
            const nomClient = document.getElementById('nomClient').value || (langue === 'fr' ? '[Nom du client]' : '[Client Name]');
            const nbAdultes = document.getElementById('nbAdultes').value;
            const nbEnfants = document.getElementById('nbEnfants').value;
            const billetSeulement = document.getElementById('billetSeulement').checked;
            const avionInclus = document.getElementById('avionInclus').checked;
            const promotion = document.getElementById('promotion').value;
            const promotionDateFin = document.getElementById('promotionDateFin').checked;

            // Inline styles object for consistency
            const styles = {
                body: "margin:0 !important; padding:0 !important; background-color:#f4f8fb; -webkit-text-size-adjust:100%; -ms-text-size-adjust:100%;",
                wrapper: "width:100%; table-layout:fixed; background-color:#f4f8fb;",
                mainTable: "background-color:#ffffff; margin:0 auto; width:100%; max-width:600px; border-spacing:0; font-family:Arial,sans-serif; color:#333333; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);",
                headerCell: "padding:0;",
                headerP: "text-align:center; margin:0; padding:25px 20px; background-color:#0050A0; color:white; font-size:26px; font-weight:bold; border-radius: 8px 8px 0 0;",
                contentCell: "padding:25px 30px;",
                footerCell: "background-color:#eef2f5; text-align:center; padding:20px; border-radius: 0 0 8px 8px;",
                footerP: "margin:0; font-size:12px; color:#555555; line-height:1.5;",
                p: "margin:0 0 1em 0; font-size:15px; line-height:1.65; color:#333333;",
                h2: "font-size:20px; color:#0050A0; margin:25px 0 15px 0; padding-bottom:8px; border-bottom:1px solid #ddeeff; text-transform:uppercase; font-weight:bold;",
                h3: "font-size:18px; color:#1a2533; margin:20px 0 10px 0; font-weight:bold;",
                ul: "margin:0 0 1em 20px; padding:0; list-style-type:disc;",
                li: "margin-bottom:6px; font-size:15px; line-height:1.65;",
                em: "font-style:italic;",
                strong: "font-weight:bold;",
                importantNote: "border-left:4px solid #ff9900; background-color:#fffaf0; padding:12px 15px; margin:18px 0; border-radius:0 6px 6px 0; font-size:14px; line-height:1.55; color:#444444;"
            };

            let htmlContent = ""; // This will build the content inside the main table cell

            // 1. Pr√©sentation
            if (langue === 'fr') {
                htmlContent += `<p style="${styles.p}">Bonjour ${nomClient},</p>`;
                htmlContent += `<p style="${styles.p}">J'esp√®re que vous allez bien.</p>`;
                htmlContent += `<p style="${styles.p}">C'est avec grand plaisir que je, Pierre-Luc Morin, votre conseiller en voyages d√©di√© chez Voyages en Route et sp√©cialiste des destinations Disney et Universal, vous accompagne dans la cr√©ation d'un voyage absolument magique !</p>`;
            } else {
                htmlContent += `<p style="${styles.p}">Hello ${nomClient},</p>`;
                htmlContent += `<p style="${styles.p}">I hope this email finds you well.</p>`;
                htmlContent += `<p style="${styles.p}">It is with great pleasure that I, Pierre-Luc Morin, your dedicated travel advisor at Voyages en Route and a specialist in Disney and Universal destinations, assist you in crafting an absolutely magical journey!</p>`;
            }

            // 2. Votre voyage
            const titreVoyage = langue === 'fr' ? "üè∞ VOTRE S√âJOUR MAGIQUE CHEZ DISNEY" : "üè∞ YOUR MAGICAL DISNEY STAY";
            htmlContent += `<h2 style="${styles.h2}">${titreVoyage}</h2>`;

            if (billetSeulement) {
                if (langue === 'fr') {
                    htmlContent += `<p style="${styles.p}">Voici les informations pour vos billets Disney seulement. Vous trouverez la soumission d√©taill√©e en pi√®ce jointe. Notez que tous les prix sont en dollars am√©ricains (USD).</p>`;
                } else {
                    htmlContent += `<p style="${styles.p}">Here is the information for your Disney tickets only. You will find the detailed quote attached. Please note that all prices are in US dollars (USD).</p>`;
                }
            } else {
                const hotelsSelectionn√©sElements = document.querySelectorAll('#hotelOptions .hotel-select-dropdown');
                const hotelsSelectionn√©s = [];
                hotelsSelectionn√©sElements.forEach(selectElement => {
                    if (selectElement.value) {
                        hotelsSelectionn√©s.push(selectElement.value);
                    }
                });

                if (hotelsSelectionn√©s.length > 0) {
                    const introHotels = langue === 'fr' ? 
                       `<p style="${styles.p}">Voici quelques magnifiques options d'h√¥tels que j'ai s√©lectionn√©es sp√©cialement pour vous, chacune offrant une exp√©rience Disney unique (soumissions en pi√®ce jointe) :</p>` :
                       `<p style="${styles.p}">Here are a few wonderful hotel options I've handpicked for you, each offering a unique Disney experience (quotes attached):</p>`;
                    htmlContent += introHotels;

                    hotelsSelectionn√©s.forEach((hotel, index) => {
                        const hotelTitre = langue === 'fr' ? 
                            (hotelsSelectionn√©s.length === 1 ? `VOTRE H√îTEL DE R√äVE : ${hotel}` : `OPTION D'H√âBERGEMENT ${index + 1} : ${hotel}`) :
                            (hotelsSelectionn√©s.length === 1 ? `YOUR DREAM HOTEL: ${hotel}` : `ACCOMMODATION OPTION ${index + 1}: ${hotel}`);
                        htmlContent += `<h3 style="${styles.h3}">${hotelTitre}</h3>`;
                        const descHotelText = obtenirDescriptionHotel(hotel, langue);
                        htmlContent += formaterDescriptionHotelHTML(descHotelText, langue, styles);
                    });
                    
                    const outroHotels = langue === 'fr' ? 
                        `<p style="${styles.p}">Chaque option est con√ßue pour vous plonger au c≈ìur de la f√©√©rie Disney.</p>`:
                        `<p style="${styles.p}">Each option is designed to immerse you in the heart of Disney magic.</p>`;
                    htmlContent += outroHotels;

                } else {
                     htmlContent += langue === 'fr' ? `<p style="${styles.p}">Aucun h√¥tel n'a √©t√© s√©lectionn√© pour le moment. N'h√©sitez pas √† me faire part de vos pr√©f√©rences !</p>` : `<p style="${styles.p}">No hotel has been selected yet. Feel free to let me know your preferences!</p>`;
                }
                htmlContent += langue === 'fr' ? 
                    `<p style="${styles.p}">Veuillez noter que tous les prix pour l'h√©bergement et les billets Disney sont indiqu√©s en dollars am√©ricains (USD) et sont sujets √† disponibilit√©.</p>` : 
                    `<p style="${styles.p}">Please note that all prices for accommodation and Disney tickets are quoted in US dollars (USD) and are subject to availability.</p>`;
            }

            // 3. Avion
            if (avionInclus) {
                const dateAller = document.getElementById('dateAller').value;
                const aeroportDepart = document.getElementById('aeroportDepart').value;
                const dateRetour = document.getElementById('dateRetour').value;
                const aeroportRetour = document.getElementById('aeroportRetour').value;
                const prixAvion = document.getElementById('prixAvion').value;
                const totalPersonnes = parseInt(nbAdultes) + parseInt(nbEnfants);
                
                const titreAvion = langue === 'fr' ? "‚úàÔ∏è VOTRE ENVOL VERS L'AVENTURE" : "‚úàÔ∏è YOUR FLIGHT TO ADVENTURE";
                htmlContent += `<h2 style="${styles.h2}">${titreAvion}</h2>`;
                
                const introAvion = langue === 'fr' ? 
                    `<p style="${styles.p}">Pour compl√©ter votre voyage vers la magie, voici les d√©tails concernant le transport a√©rien que nous avons explor√© :</p>` :
                    `<p style="${styles.p}">To complete your journey to the magic, here are the details regarding the air transportation we explored:</p>`;
                htmlContent += introAvion;

                let flightDetails = "";
                if (langue === 'fr') {
                    flightDetails += `<p style="${styles.p}"><strong>Aller :</strong> ${dateAller ? new Date(dateAller).toLocaleString('fr-CA', {dateStyle:'long', timeStyle:'short'}) : '[Date/heure de d√©part √† confirmer]'}<br>`;
                    flightDetails += `<strong>De :</strong> ${aeroportDepart || '[A√©roport de d√©part √† pr√©ciser]'}<br>`;
                    flightDetails += `<strong>Vers :</strong> ${aeroportRetour || '[A√©roport de destination √† pr√©ciser]'}</p>`;
                    flightDetails += `<p style="${styles.p}"><strong>Retour :</strong> ${dateRetour ? new Date(dateRetour).toLocaleString('fr-CA', {dateStyle:'long', timeStyle:'short'}) : '[Date/heure de retour √† confirmer]'}<br>`;
                    flightDetails += `<strong>De :</strong> ${aeroportRetour || '[A√©roport de destination √† pr√©ciser]'}<br>`;
                    flightDetails += `<strong>Vers :</strong> ${aeroportDepart || '[A√©roport de d√©part √† pr√©ciser]'}</p>`;
                    flightDetails += `<p style="${styles.p}"><strong>Nombre de passagers :</strong> ${totalPersonnes} (${nbAdultes} adulte${nbAdultes > 1 ? 's' : ''}${nbEnfants > 0 ? `, ${nbEnfants} enfant${nbEnfants > 1 ? 's' : ''}` : ''})</p>`;
                    flightDetails += `<p style="${styles.p}"><strong>Prix total approximatif des vols :</strong> ${prixAvion || '[Prix √† confirmer]'} CAD</p>`;
                    flightDetails += `<div style="${styles.importantNote}"><strong>IMPORTANT :</strong> Les tarifs a√©riens sont dynamiques et peuvent changer jusqu'√† la r√©servation. Des frais de service de 50$ CAD par personne s'appliquent pour la r√©servation des vols via nos services. En me confiant vos vols, je m'occupe de tout d√©sagr√©ment potentiel. Si vous optez pour une r√©servation personnelle, ces frais ne s'appliquent pas, mais le support en cas de probl√®me avec les vols ne sera pas inclus pour cette portion.</div>`;
                } else {
                    flightDetails += `<p style="${styles.p}"><strong>Departure:</strong> ${dateAller ? new Date(dateAller).toLocaleString('en-CA', {dateStyle:'long', timeStyle:'short'}) : '[Departure date/time to be confirmed]'}<br>`;
                    flightDetails += `<strong>From:</strong> ${aeroportDepart || '[Departure airport to be specified]'}<br>`;
                    flightDetails += `<strong>To:</strong> ${aeroportRetour || '[Destination airport to be specified]'}</p>`;
                    flightDetails += `<p style="${styles.p}"><strong>Return:</strong> ${dateRetour ? new Date(dateRetour).toLocaleString('en-CA', {dateStyle:'long', timeStyle:'short'}) : '[Return date/time to be confirmed]'}<br>`;
                    flightDetails += `<strong>From:</strong> ${aeroportRetour || '[Destination airport to be specified]'}<br>`;
                    flightDetails += `<strong>To:</strong> ${aeroportDepart || '[Departure airport to be specified]'}</p>`;
                    flightDetails += `<p style="${styles.p}"><strong>Number of passengers:</strong> ${totalPersonnes} (${nbAdultes} adult${nbAdultes > 1 ? 's' : ''}${nbEnfants > 0 ? `, ${nbEnfants} child${nbEnfants > 1 ? 'ren' : ''}` : ''})</p>`;
                    flightDetails += `<p style="${styles.p}"><strong>Approximate total flight price:</strong> ${prixAvion || '[Price to be confirmed]'} CAD</p>`;
                    flightDetails += `<div style="${styles.importantNote}"><strong>IMPORTANT:</strong> Airfares are dynamic and subject to change until booked. A service fee of $50 CAD per person applies for flight bookings through our services. By entrusting me with your flights, I will handle any potential issues. If you choose to book them personally, this fee does not apply, but support for flight-related issues will not be included for that portion.</div>`;
                }
                htmlContent += flightDetails;
            }

            // 4. Promotion
            if (promotion.trim()) {
                const titrePromo = langue === 'fr' ? "üéÅ UNE TOUCHE DE MAGIE SUPPL√âMENTAIRE : PROMOTION SP√âCIALE !" : "üéÅ AN EXTRA TOUCH OF MAGIC: SPECIAL PROMOTION!";
                htmlContent += `<h2 style="${styles.h2}">${titrePromo}</h2>`;
                if (langue === 'fr') {
                    htmlContent += `<p style="${styles.p}">Excellente nouvelle ! J'ai le plaisir de vous informer que la promotion "${promotion}" peut √™tre appliqu√©e √† votre r√©servation, ajoutant encore plus de valeur √† votre s√©jour magique !`;
                    htmlContent += promotionDateFin ? ` Cette offre est d'une dur√©e limit√©e, il est donc judicieux de r√©server rapidement pour enchanter votre voyage sans tarder.</p>` : ` La date de fin de cette promotion n'est pas encore connue, mais les meilleures offres partent vite !</p>`;
                } else {
                    htmlContent += `<p style="${styles.p}">Excellent news! I'm thrilled to let you know that the "${promotion}" promotion can be applied to your booking, adding even more value to your magical stay!`;
                    htmlContent += promotionDateFin ? ` This offer is for a limited time, so it's wise to book quickly to enchant your trip without delay.</p>` : ` The end date for this promotion is not yet known, but the best offers go quickly!</p>`;
                }
            } else {
                const titreReservation = langue === 'fr' ? "üåü R√âSERVATION ET OPTIMISATION DE VOTRE S√âJOUR" : "üåü BOOKING AND OPTIMIZING YOUR STAY";
                htmlContent += `<h2 style="${styles.h2}">${titreReservation}</h2>`;
                if (langue === 'fr') {
                    htmlContent += `<p style="${styles.p}">Pour garantir votre place au c≈ìur de la magie, un d√©p√¥t de seulement 200 USD est requis. Soyez assur√© que je veillerai personnellement √† appliquer toute nouvelle promotion applicable d'ici votre d√©part pour optimiser la valeur de votre voyage. Ce d√©p√¥t est enti√®rement remboursable jusqu'√† 30 jours avant votre arriv√©e, vous offrant une flexibilit√© totale pour planifier en toute s√©r√©nit√©.</p>`;
                } else {
                    htmlContent += `<p style="${styles.p}">To secure your spot in the heart of the magic, a deposit of only 200 USD is required. Rest assured, I will personally ensure any new applicable promotions are applied before your departure to maximize the value of your trip. This deposit is fully refundable up to 30 days before your check-in, offering you complete flexibility to plan with peace of mind.</p>`;
                }
            }

            // 5. La suite
            const titreSuite = langue === 'fr' ? "‚ú® LA MAGIE CONTINUE..." : "‚ú® THE MAGIC CONTINUES...";
            htmlContent += `<h2 style="${styles.h2}">${titreSuite}</h2>`;
            if (langue === 'fr') {
                htmlContent += `<p style="${styles.p}">Prenez le temps de r√™ver √† ces options et de consid√©rer ce qui ferait de ce voyage une exp√©rience v√©ritablement inoubliable. Je suis √† votre enti√®re disposition pour r√©pondre √† toutes vos questions, affiner chaque d√©tail ou proc√©der √† la r√©servation de cette escapade f√©√©rique.</p>`;
                htmlContent += `<p style="${styles.p}">N'h√©sitez pas √† me joindre par courriel (en r√©pondant simplement √† celui-ci) ou par t√©l√©phone au <a href="tel:819-347-9103" style="color:#0050A0; text-decoration:none;">819-347-9103</a>.</p>`;
                htmlContent += `<p style="${styles.p}">Merci encore pour votre confiance. J'ai sinc√®rement h√¢te de transformer ce r√™ve Disney en une magnifique r√©alit√© pour vous !</p>`;
                htmlContent += `<p style="${styles.p} margin-top:20px;">Chaleureusement,</p>`;
                htmlContent += `<p style="${styles.p} margin-bottom:0; ${styles.strong}">Pierre-Luc Morin</p>`;
                htmlContent += `<p style="${styles.p} margin-bottom:0; font-size:14px;">Conseiller en voyages | Sp√©cialiste Disney & Universal</p>`;
                htmlContent += `<p style="${styles.p} margin-bottom:0; font-size:14px;">Voyages en Route</p>`;
                htmlContent += `<p style="${styles.p} margin-bottom:0; font-size:14px; ${styles.em}">Votre cr√©ateur de souvenirs magiques</p>`;
            } else {
                htmlContent += `<p style="${styles.p}">Take your time to dream about these options and consider what would make this trip a truly unforgettable experience. I am at your complete disposal to answer any questions, refine every detail, or proceed with booking this enchanting getaway.</p>`;
                htmlContent += `<p style="${styles.p}">Please feel free to reach me by email (by simply replying to this one) or by phone at <a href="tel:819-347-9103" style="color:#0050A0; text-decoration:none;">819-347-9103</a>.</p>`;
                htmlContent += `<p style="${styles.p}">Thank you again for your trust. I genuinely look forward to turning this Disney dream into a wonderful reality for you!</p>`;
                htmlContent += `<p style="${styles.p} margin-top:20px;">Warmly,</p>`;
                htmlContent += `<p style="${styles.p} margin-bottom:0; ${styles.strong}">Pierre-Luc Morin</p>`;
                htmlContent += `<p style="${styles.p} margin-bottom:0; font-size:14px;">Travel Advisor | Disney & Universal Specialist</p>`;
                htmlContent += `<p style="${styles.p} margin-bottom:0; font-size:14px;">Voyages en Route</p>`;
                htmlContent += `<p style="${styles.p} margin-bottom:0; font-size:14px; ${styles.em}">Your Magical Memory Maker</p>`;
            }

            // Assemble the full HTML email
            let fullHtmlEmail = `<!DOCTYPE html>
<html lang="${langue}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${langue === 'fr' ? 'Votre Soumission Disney Personnalis√©e' : 'Your Personalized Disney Quote'}</title>
    <style type="text/css">
        body { ${styles.body} }
        a { color: #0050A0; text-decoration: underline; }
    </style>
</head>
<body style="${styles.body}">
    <center class="wrapper" style="${styles.wrapper}">
        <table class="main" width="100%" style="${styles.mainTable}">
            <tr>
                <td style="${styles.headerCell}">
                    <p style="${styles.headerP}">
                        üè∞ Voyages en Route üè∞
                    </p>
                </td>
            </tr>
            <tr>
                <td style="${styles.contentCell}">
                    ${htmlContent}
                </td>
            </tr>
            <tr>
                <td style="${styles.footerCell}">
                    <p style="${styles.footerP}">
                        Voyages en Route - Votre sp√©cialiste Disney & Universal<br>
                        ${langue === 'fr' ? 'Pour toute question, contactez' : 'For any questions, contact'} Pierre-Luc Morin: <a href="tel:819-347-9103" style="color:#0050A0; text-decoration:none;">819-347-9103</a>
                    </p>
                </td>
            </tr>
        </table>
    </center>
</body>
</html>`;

            generatedHtmlEmail = fullHtmlEmail; // Store for copying

            // Display HTML code in preview
            const previewContainer = document.getElementById('emailPreviewContainer');
            const codeElement = previewContainer.querySelector('code');
            // Escape HTML characters for display as text
            const escapedHtml = fullHtmlEmail.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
            codeElement.textContent = escapedHtml; // Use textContent to display as raw text
        }

        function copierCourriel() {
            if (!generatedHtmlEmail) { 
                console.warn('Aucun code HTML de courriel g√©n√©r√© √† copier.');
                const langElement = document.getElementById('langue');
                const lang = langElement ? langElement.value : 'fr';
                alert(lang === 'fr' ? 'Veuillez d\'abord g√©n√©rer un courriel.' : 'Please generate an email first.');
                return;
            }

            navigator.clipboard.writeText(generatedHtmlEmail).then(function() {
                const btn = document.querySelector('.copy-btn');
                const originalText = btn.textContent; 
                const langElement = document.getElementById('langue');
                const lang = langElement ? langElement.value : 'fr';
                btn.textContent = lang === 'fr' ? '‚úÖ Code HTML Copi√© !' : '‚úÖ HTML Code Copied!';
                btn.style.background = 'linear-gradient(135deg, #2ecc71, #27ae60)'; 
                
                setTimeout(function() {
                    btn.textContent = originalText;
                    btn.style.background = 'linear-gradient(135deg, #27ae60, #2ecc71)';
                }, 2500);
            }).catch(function(err) {
                console.error('Erreur lors de la copie du code HTML:', err);
                const langElement = document.getElementById('langue');
                const lang = langElement ? langElement.value : 'fr';
                let alertMsg = lang === 'fr' ? 'Erreur lors de la copie du code HTML. ' : 'Error copying HTML code. ';
                alert(alertMsg + (lang === 'fr' ? "V√©rifiez les permissions ou r√©essayez." : "Check permissions or try again."));
            });
        }

        window.onload = function() {
            if (!document.getElementById('billetSeulement').checked && document.getElementById('hotelOptions').childElementCount === 0) {
                 ajouterHotel(); 
            }
            // Initialize with empty code preview
            document.getElementById('emailPreviewContainer').querySelector('code').textContent = 
                document.getElementById('langue').value === 'fr' ? 
                "Le code HTML du courriel appara√Ætra ici..." : 
                "The email's HTML code will appear here...";
        };
    </script>
</body>
</html>
