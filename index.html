<script>
        const hotelsList = [ /* ... your list ... */ ];
        const hotelDescriptions = { /* ... your descriptions ... */ };
        let compteurHotels = 0;

        let plainTextEmailForCopying = ''; // <<<--- ADDED: Variable to hold the pure text email

        document.getElementById('avionInclus').addEventListener('change', function() {
            const avionSection = document.getElementById('avionSection');
            avionSection.style.display = this.checked ? 'block' : 'none';
        });

        document.getElementById('billetSeulement').addEventListener('change', function() {
            const hotelSection = document.getElementById('hotelSection');
            hotelSection.style.display = this.checked ? 'none' : 'block';
            if(this.checked) { 
                document.getElementById('hotelOptions').innerHTML = '';
                // compteurHotels = 0; // Resetting based on actual children count is better
            } else {
                if (document.getElementById('hotelOptions').childElementCount === 0) ajouterHotel();
            }
        });

        function ajouterHotel() {
            // compteurHotels++; // Using childElementCount for numbering is more robust
            const hotelDiv = document.createElement('div');
            hotelDiv.className = 'hotel-option';
            const uniqueId = `hotel_option_${Date.now()}_${Math.random().toString(36).substr(2, 5)}`; 
            hotelDiv.id = uniqueId;
            
            const hotelNumber = document.getElementById('hotelOptions').childElementCount + 1;

            hotelDiv.innerHTML = `
                <button type="button" class="remove-hotel-btn" onclick="supprimerHotel('${uniqueId}')">Supprimer</button>
                <h4>H√¥tel Option ${hotelNumber}</h4>
                <div class="form-group">
                    <label for="hotelSelect${uniqueId}">S√©lectionner l'h√¥tel :</label>
                    <select id="hotelSelect${uniqueId}" class="hotel-select-dropdown">
                        <option value="">-- Choisir un h√¥tel --</option>
                        ${hotelsList.map(hotel => `<option value="${hotel}">${hotel}</option>`).join('')}
                    </select>
                </div>
            `;
            document.getElementById('hotelOptions').appendChild(hotelDiv);
        }

        function supprimerHotel(id) {
            const hotelDiv = document.getElementById(id);
            if (hotelDiv) {
                hotelDiv.remove();
                const hotelOptionsContainer = document.getElementById('hotelOptions');
                const remainingHotels = hotelOptionsContainer.getElementsByClassName('hotel-option');
                for (let i = 0; i < remainingHotels.length; i++) {
                    remainingHotels[i].querySelector('h4').textContent = `H√¥tel Option ${i + 1}`;
                }
            }
        }
        
        function formaterDescriptionHotel(description, langue) {
            // ... (this function remains the same)
            if (!description) return "";
            let formattedDescription = "";
            const categorieKey = langue === 'fr' ? "CAT√âGORIE" : "CATEGORY";
            const avantagesKey = langue === 'fr' ? "Avantages :" : "Benefits:";
            const categorieMatch = description.match(new RegExp(`^(${categorieKey}[^-]+?) - `, "i"));
            let restDescription = description;

            if (categorieMatch && categorieMatch[1]) {
                formattedDescription += `*${categorieMatch[1].trim()}*\n`;
                restDescription = description.substring(categorieMatch[0].length); 
            }

            const avantagesIndex = restDescription.toLowerCase().indexOf(avantagesKey.toLowerCase());
            if (avantagesIndex !== -1) {
                const mainDesc = restDescription.substring(0, avantagesIndex).trim();
                const originalAvantagesKey = restDescription.substring(avantagesIndex, avantagesIndex + avantagesKey.length);
                const avantagesText = restDescription.substring(avantagesIndex + avantagesKey.length).trim();

                if (mainDesc) formattedDescription += `${mainDesc}\n\n`; else formattedDescription += '\n';
                formattedDescription += `**${originalAvantagesKey}**\n`; 
                const avantagesList = avantagesText.split(/,\s*(?![^()]*\))/); 
                avantagesList.forEach(avantage => {
                    if (avantage.trim()) {
                       formattedDescription += `  - ${avantage.trim()}\n`;
                    }
                });
            } else {
                 if (restDescription.trim()) formattedDescription += `${restDescription.trim()}\n`;
            }
            return formattedDescription;
        }

        function obtenirDescriptionHotel(nomHotel, langue) {
            // ... (this function remains the same)
            if (hotelDescriptions[nomHotel] && hotelDescriptions[nomHotel][langue]) {
                return hotelDescriptions[nomHotel][langue];
            }
            if (langue === 'fr') {
                return "CAT√âGORIE NON SP√âCIFI√âE - Un magnifique h√¥tel Disney offrant le confort et la magie Disney dans un cadre enchanteur. Avantages : Early Theme Park Entry.";
            } else {
                return "CATEGORY UNSPECIFIED - A beautiful Disney hotel offering comfort and Disney magic in an enchanting setting. Benefits: Early Theme Park Entry.";
            }
        }

        function genererCourriel() {
            const langue = document.getElementById('langue').value;
            const nomClient = document.getElementById('nomClient').value;
            const nbAdultes = document.getElementById('nbAdultes').value;
            const nbEnfants = document.getElementById('nbEnfants').value;
            const billetSeulement = document.getElementById('billetSeulement').checked;
            const avionInclus = document.getElementById('avionInclus').checked;
            const promotion = document.getElementById('promotion').value;
            const promotionDateFin = document.getElementById('promotionDateFin').checked;

            let courriel = ''; 

            // ... (ALL YOUR EXISTING LOGIC TO BUILD THE 'courriel' STRING)
            // For example:
            // 1. Pr√©sentation
            if (langue === 'fr') {
                courriel += `Bonjour ${nomClient || '[Nom du client]'},\n\nJ'esp√®re que vous allez bien.\n\n`;
                courriel += `C'est avec grand plaisir que je, Pierre-Luc Morin, votre conseiller en voyages d√©di√© chez Voyages en Route et sp√©cialiste des destinations Disney et Universal, vous accompagne dans la cr√©ation d'un voyage absolument magique !\n\n`;
            } else {
                courriel += `Hello ${nomClient || '[Client Name]'},\n\nI hope this email finds you well.\n\n`;
                courriel += `It is with great pleasure that I, Pierre-Luc Morin, your dedicated travel advisor at Voyages en Route and a specialist in Disney and Universal destinations, assist you in crafting an absolutely magical journey!\n\n`;
            }
            // ... (Rest of your email string building logic for all sections) ...
            // 2. Votre voyage ...
            // 3. Avion ...
            // 4. Promotion ...
            // 5. La suite ...
            const titreVoyage = langue === 'fr' ? "üè∞ VOTRE S√âJOUR MAGIQUE CHEZ DISNEY" : "üè∞ YOUR MAGICAL DISNEY STAY";
            courriel += `${titreVoyage}\n\n`;

            if (billetSeulement) {
                if (langue === 'fr') {
                    courriel += `Voici les informations pour vos billets Disney seulement. Vous trouverez la soumission d√©taill√©e en pi√®ce jointe. Notez que tous les prix sont en dollars am√©ricains (USD).\n\n`;
                } else {
                    courriel += `Here is the information for your Disney tickets only. You will find the detailed quote attached. Please note that all prices are in US dollars (USD).\n\n`;
                }
            } else {
                const hotelsSelectionn√©sElements = document.querySelectorAll('#hotelOptions .hotel-select-dropdown'); // Corrected selector
                const hotelsSelectionn√©s = [];
                hotelsSelectionn√©sElements.forEach(selectElement => {
                    if (selectElement.value) {
                        hotelsSelectionn√©s.push(selectElement.value);
                    }
                });


                if (hotelsSelectionn√©s.length > 0) {
                     const introHotels = langue === 'fr' ? 
                        `Voici quelques magnifiques options d'h√¥tels que j'ai s√©lectionn√©es sp√©cialement pour vous, chacune offrant une exp√©rience Disney unique (soumissions en pi√®ce jointe) :\n\n` :
                        `Here are a few wonderful hotel options I've handpicked for you, each offering a unique Disney experience (quotes attached):\n\n`;
                    courriel += introHotels;

                    if (langue === 'fr') {
                        if (hotelsSelectionn√©s.length === 1) {
                            courriel += `VOTRE H√îTEL DE R√äVE : ${hotelsSelectionn√©s[0]}\n\n`;
                            const descHotel = obtenirDescriptionHotel(hotelsSelectionn√©s[0], 'fr');
                            courriel += formaterDescriptionHotel(descHotel, 'fr') + '\n';
                        } else {
                            hotelsSelectionn√©s.forEach((hotel, index) => {
                                courriel += `OPTION D'H√âBERGEMENT ${index + 1} : ${hotel}\n\n`;
                                const descHotel = obtenirDescriptionHotel(hotel, 'fr');
                                courriel += formaterDescriptionHotel(descHotel, 'fr') + '\n';
                            });
                        }
                        courriel += `Chaque option est con√ßue pour vous plonger au c≈ìur de la f√©√©rie Disney.\n\n`;
                    } else { // English
                        if (hotelsSelectionn√©s.length === 1) {
                            courriel += `YOUR DREAM HOTEL: ${hotelsSelectionn√©s[0]}\n\n`;
                            const descHotel = obtenirDescriptionHotel(hotelsSelectionn√©s[0], 'en');
                            courriel += formaterDescriptionHotel(descHotel, 'en') + '\n';
                        } else {
                            hotelsSelectionn√©s.forEach((hotel, index) => {
                                courriel += `ACCOMMODATION OPTION ${index + 1}: ${hotel}\n\n`;
                                const descHotel = obtenirDescriptionHotel(hotel, 'en');
                                courriel += formaterDescriptionHotel(descHotel, 'en') + '\n';
                            });
                        }
                        courriel += `Each option is designed to immerse you in the heart of Disney magic.\n\n`;
                    }
                } else {
                     if (langue === 'fr') courriel += "Aucun h√¥tel n'a √©t√© s√©lectionn√© pour le moment. N'h√©sitez pas √† me faire part de vos pr√©f√©rences !\n\n";
                     else courriel += "No hotel has been selected yet. Feel free to let me know your preferences!\n\n";
                }
                if (langue === 'fr') {
                    courriel += `Veuillez noter que tous les prix pour l'h√©bergement et les billets Disney sont indiqu√©s en dollars am√©ricains (USD) et sont sujets √† disponibilit√©.\n\n`;
                } else {
                    courriel += `Please note that all prices for accommodation and Disney tickets are quoted in US dollars (USD) and are subject to availability.\n\n`;
                }
            }

            if (avionInclus) {
                const dateAller = document.getElementById('dateAller').value;
                const aeroportDepart = document.getElementById('aeroportDepart').value;
                const dateRetour = document.getElementById('dateRetour').value;
                const aeroportRetour = document.getElementById('aeroportRetour').value;
                const prixAvion = document.getElementById('prixAvion').value;
                const totalPersonnes = parseInt(nbAdultes) + parseInt(nbEnfants);
                const introAvion = langue === 'fr' ? 
                    `Pour compl√©ter votre voyage vers la magie, voici les d√©tails concernant le transport a√©rien que nous avons explor√© :\n\n` :
                    `To complete your journey to the magic, here are the details regarding the air transportation we explored:\n\n`;

                if (langue === 'fr') {
                    courriel += `‚úàÔ∏è VOTRE ENVOL VERS L'AVENTURE\n\n${introAvion}`;
                    courriel += `Aller : ${dateAller ? new Date(dateAller).toLocaleString('fr-CA', {dateStyle:'long', timeStyle:'short'}) : '[Date/heure de d√©part √† confirmer]'}\n`;
                    courriel += `De : ${aeroportDepart || '[A√©roport de d√©part √† pr√©ciser]'}\n`;
                    courriel += `Vers : ${aeroportRetour || '[A√©roport de destination √† pr√©ciser]'}\n\n`;
                    courriel += `Retour : ${dateRetour ? new Date(dateRetour).toLocaleString('fr-CA', {dateStyle:'long', timeStyle:'short'}) : '[Date/heure de retour √† confirmer]'}\n`;
                    courriel += `De : ${aeroportRetour || '[A√©roport de destination √† pr√©ciser]'}\n`;
                    courriel += `Vers : ${aeroportDepart || '[A√©roport de d√©part √† pr√©ciser]'}\n\n`;
                    courriel += `Nombre de passagers : ${totalPersonnes} (${nbAdultes} adulte${nbAdultes > 1 ? 's' : ''}${nbEnfants > 0 ? `, ${nbEnfants} enfant${nbEnfants > 1 ? 's' : ''}` : ''})\n`;
                    courriel += `Prix total approximatif des vols : ${prixAvion || '[Prix √† confirmer]'} CAD\n\n`;
                    courriel += `IMPORTANT : Les tarifs a√©riens sont dynamiques et peuvent changer jusqu'√† la r√©servation. Des frais de service de 50$ CAD par personne s'appliquent pour la r√©servation des vols via nos services. En me confiant vos vols, je m'occupe de tout d√©sagr√©ment potentiel. Si vous optez pour une r√©servation personnelle, ces frais ne s'appliquent pas, mais le support en cas de probl√®me avec les vols ne sera pas inclus pour cette portion.\n\n`;
                } else {
                    courriel += `‚úàÔ∏è YOUR FLIGHT TO ADVENTURE\n\n${introAvion}`;
                    courriel += `Departure: ${dateAller ? new Date(dateAller).toLocaleString('en-CA', {dateStyle:'long', timeStyle:'short'}) : '[Departure date/time to be confirmed]'}\n`;
                    courriel += `From: ${aeroportDepart || '[Departure airport to be specified]'}\n`;
                    courriel += `To: ${aeroportRetour || '[Destination airport to be specified]'}\n\n`;
                    courriel += `Return: ${dateRetour ? new Date(dateRetour).toLocaleString('en-CA', {dateStyle:'long', timeStyle:'short'}) : '[Return date/time to be confirmed]'}\n`;
                    courriel += `From: ${aeroportRetour || '[Destination airport to be specified]'}\n`;
                    courriel += `To: ${aeroportDepart || '[Departure airport to be specified]'}\n\n`;
                    courriel += `Number of passengers: ${totalPersonnes} (${nbAdultes} adult${nbAdultes > 1 ? 's' : ''}${nbEnfants > 0 ? `, ${nbEnfants} child${nbEnfants > 1 ? 'ren' : ''}` : ''})\n`;
                    courriel += `Approximate total flight price: ${prixAvion || '[Price to be confirmed]'} CAD\n\n`; 
                    courriel += `IMPORTANT: Airfares are dynamic and subject to change until booked. A service fee of $50 CAD per person applies for flight bookings through our services. By entrusting me with your flights, I will handle any potential issues. If you choose to book them personally, this fee does not apply, but support for flight-related issues will not be included for that portion.\n\n`;
                }
            }

            if (promotion.trim()) {
                if (langue === 'fr') {
                    courriel += `üéÅ UNE TOUCHE DE MAGIE SUPPL√âMENTAIRE : PROMOTION SP√âCIALE !\n\n`;
                    courriel += `Excellente nouvelle ! J'ai le plaisir de vous informer que la promotion "${promotion}" peut √™tre appliqu√©e √† votre r√©servation, ajoutant encore plus de valeur √† votre s√©jour magique !`;
                    if (promotionDateFin) {
                        courriel += ` Cette offre est d'une dur√©e limit√©e, il est donc judicieux de r√©server rapidement pour enchanter votre voyage sans tarder.\n\n`;
                    } else {
                        courriel += ` La date de fin de cette promotion n'est pas encore connue, mais les meilleures offres partent vite !\n\n`;
                    }
                } else {
                    courriel += `üéÅ AN EXTRA TOUCH OF MAGIC: SPECIAL PROMOTION!\n\n`;
                    courriel += `Excellent news! I'm thrilled to let you know that the "${promotion}" promotion can be applied to your booking, adding even more value to your magical stay!`;
                    if (promotionDateFin) {
                        courriel += ` This offer is for a limited time, so it's wise to book quickly to enchant your trip without delay.\n\n`;
                    } else {
                        courriel += ` The end date for this promotion is not yet known, but the best offers go quickly!\n\n`;
                    }
                }
            } else {
                if (langue === 'fr') {
                    courriel += `üåü R√âSERVATION ET OPTIMISATION DE VOTRE S√âJOUR\n\n`;
                    courriel += `Pour garantir votre place au c≈ìur de la magie, un d√©p√¥t de seulement 200 USD est requis. Soyez assur√© que je veillerai personnellement √† appliquer toute nouvelle promotion applicable d'ici votre d√©part pour optimiser la valeur de votre voyage. Ce d√©p√¥t est enti√®rement remboursable jusqu'√† 30 jours avant votre arriv√©e, vous offrant une flexibilit√© totale pour planifier en toute s√©r√©nit√©.\n\n`;
                } else {
                    courriel += `üåü BOOKING AND OPTIMIZING YOUR STAY\n\n`;
                    courriel += `To secure your spot in the heart of the magic, a deposit of only 200 USD is required. Rest assured, I will personally ensure any new applicable promotions are applied before your departure to maximize the value of your trip. This deposit is fully refundable up to 30 days before your check-in, offering you complete flexibility to plan with peace of mind.\n\n`;
                }
            }

            if (langue === 'fr') {
                courriel += `‚ú® LA MAGIE CONTINUE...\n\n`;
                courriel += `Prenez le temps de r√™ver √† ces options et de consid√©rer ce qui ferait de ce voyage une exp√©rience v√©ritablement inoubliable. Je suis √† votre enti√®re disposition pour r√©pondre √† toutes vos questions, affiner chaque d√©tail ou proc√©der √† la r√©servation de cette escapade f√©√©rique.\n\nN'h√©sitez pas √† me joindre par courriel (en r√©pondant simplement √† celui-ci) ou par t√©l√©phone au 819-347-9103.\n\n`;
                courriel += `Merci encore pour votre confiance. J'ai sinc√®rement h√¢te de transformer ce r√™ve Disney en une magnifique r√©alit√© pour vous !\n\n`;
                courriel += `Chaleureusement,\n\n`;
                courriel += `Pierre-Luc Morin\nConseiller en voyages | Sp√©cialiste Disney & Universal\nVoyages en Route\nVotre cr√©ateur de souvenirs magiques`;
            } else {
                courriel += `‚ú® THE MAGIC CONTINUES...\n\n`;
                courriel += `Take your time to dream about these options and consider what would make this trip a truly unforgettable experience. I am at your complete disposal to answer any questions, refine every detail, or proceed with booking this enchanting getaway.\n\nPlease feel free to reach me by email (by simply replying to this one) or by phone at 819-347-9103.\n\n`;
                courriel += `Thank you again for your trust. I genuinely look forward to turning this Disney dream into a wonderful reality for you!\n\n`;
                courriel += `Warmly,\n\n`;
                courriel += `Pierre-Luc Morin\nTravel Advisor | Disney & Universal Specialist\nVoyages en Route\nYour Magical Memory Maker`;
            }
            // END OF 'courriel' STRING BUILDING

            plainTextEmailForCopying = courriel; // <<<--- ADDED: Store the pure text email

            // --- Apply styling for the preview pane ---
            const preview = document.getElementById('emailPreview');
            let styledCourriel = courriel; // Start with the plain text for styling the preview

            function escapeRegExpLocal(string) {
                return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            }

            const mainTitles = [ /* ... your titles array ... */
                "üè∞ VOTRE S√âJOUR MAGIQUE CHEZ DISNEY", "üè∞ YOUR MAGICAL DISNEY STAY",
                "‚úàÔ∏è VOTRE ENVOL VERS L'AVENTURE", "‚úàÔ∏è YOUR FLIGHT TO ADVENTURE",
                "üéÅ UNE TOUCHE DE MAGIE SUPPL√âMENTAIRE : PROMOTION SP√âCIALE !", "üéÅ AN EXTRA TOUCH OF MAGIC: SPECIAL PROMOTION!",
                "üåü R√âSERVATION ET OPTIMISATION DE VOTRE S√âJOUR", "üåü BOOKING AND OPTIMIZING YOUR STAY",
                "‚ú® LA MAGIE CONTINUE...", "‚ú® THE MAGIC CONTINUES..."
            ];
            
            mainTitles.forEach(title => {
                const titleRegex = new RegExp(`^(${escapeRegExpLocal(title)})$`, "gm");
                styledCourriel = styledCourriel.replace(titleRegex, (match) => {
                    let hr = '<hr style="border:0; border-top: 1px solid #eee; margin: 30px 0 20px 0;">';
                    if (styledCourriel.toLowerCase().indexOf(match.toLowerCase()) < (courriel.indexOf('\n\n') + 150) && (match.startsWith("üè∞") || match.startsWith("‚úàÔ∏è"))) {
                         hr = ''; 
                    }
                    return `${hr}<div class="email-title">${match}</div>`;
                });
            });
            
            const hotelNameLineRegexFr = /^(VOTRE H√îTEL DE R√äVE : .*|OPTION D'H√âBERGEMENT \d+ : .*)$/gm;
            styledCourriel = styledCourriel.replace(hotelNameLineRegexFr, '<div style="font-weight: bold; color: #1a2533; margin-top: 18px; margin-bottom: 8px; font-size: 1.15em;">$1</div>');
            const hotelNameLineRegexEn = /^(YOUR DREAM HOTEL: .*|ACCOMMODATION OPTION \d+: .*)$/gm;
            styledCourriel = styledCourriel.replace(hotelNameLineRegexEn, '<div style="font-weight: bold; color: #1a2533; margin-top: 18px; margin-bottom: 8px; font-size: 1.15em;">$1</div>');
            
            styledCourriel = styledCourriel.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); 
            styledCourriel = styledCourriel.replace(/\*(.*?)\*/g, '<em>$1</em>');    
            
            styledCourriel = styledCourriel.replace(/^(IMPORTANT\s?:[\s\S]*?)(?=\n\n|\n[A-Z\s‚ú®üè∞‚úàÔ∏èüéÅüåü]+?:|$)/gim, (match) => {
                return `<div style="border: 1px solid #e67e22; background-color: #fff9f0; padding: 12px; margin: 15px 0; border-radius: 8px; font-size: 0.98em; line-height: 1.5;">${match.trim()}</div>`;
            });

            preview.innerHTML = styledCourriel;
        }

        function copierCourriel() {
            // <<<--- MODIFIED SECTION ---<<<
            if (!plainTextEmailForCopying) { // Check if the plain text variable has content
                console.warn('Aucun courriel g√©n√©r√© √† copier ou le contenu est vide.');
                const lang = document.getElementById('langue').value;
                alert(lang === 'fr' ? 'Veuillez d\'abord g√©n√©rer un courriel.' : 'Please generate an email first.');
                return;
            }

            const texteACopier = plainTextEmailForCopying; // Use the stored plain text
            // --- END OF MODIFIED SECTION ---<<<
            
            navigator.clipboard.writeText(texteACopier).then(function() {
                const btn = document.querySelector('.copy-btn');
                const originalText = btn.textContent; // Use textContent for buttons
                const lang = document.getElementById('langue').value;
                btn.textContent = lang === 'fr' ? '‚úÖ Copi√© avec succ√®s !' : '‚úÖ Copied successfully!';
                btn.style.background = 'linear-gradient(135deg, #2ecc71, #27ae60)'; 
                
                setTimeout(function() {
                    btn.textContent = originalText;
                    btn.style.background = 'linear-gradient(135deg, #27ae60, #2ecc71)';
                }, 2500);
            }).catch(function(err) {
                console.error('Erreur lors de la copie:', err);
                const lang = document.getElementById('langue').value;
                // Provide more specific error feedback if possible
                let alertMsg = lang === 'fr' ? 'Erreur lors de la copie. ' : 'Error copying. ';
                if (navigator.clipboard === undefined) {
                    alertMsg += lang === 'fr' ? "L'API Clipboard n'est pas support√©e par votre navigateur ou la page n'est pas s√©curis√©e (HTTPS)." : "Clipboard API not supported by your browser or page is not secure (HTTPS).";
                } else {
                    alertMsg += lang === 'fr' ? "V√©rifiez les permissions du presse-papiers ou r√©essayez." : "Check clipboard permissions or try again.";
                }
                alert(alertMsg);
            });
        }

        window.onload = function() {
            if (!document.getElementById('billetSeulement').checked && document.getElementById('hotelOptions').childElementCount === 0) {
                 ajouterHotel(); 
            }
        };
    </script>
</body>
</html>
