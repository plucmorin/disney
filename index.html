<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur d'e-mail Disney (Version Finale)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; margin: 20px; background-color: #f4f4f4; color: #333; line-height: 1.6; }
        .container { background-color: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 900px; margin: auto;}
        h1 { text-align: center; margin-bottom: 30px; color: #0078C1; font-weight: 700;}
        h2 { margin-top: 25px; color: #0078C1; border-bottom: 2px solid #eee; padding-bottom: 8px;}
        label { display: block; margin-top: 15px; font-weight: 600; color: #333; }
        input[type="text"], input[type="number"], input[type="date"], input[type="time"], select, textarea {
            width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 1em;
        }
        textarea { resize: vertical; min-height: 80px; }
        input[type="checkbox"] { margin-right: 8px; vertical-align: middle; width: auto; }
        button, .remove-hotel-button {
            background-color: #007bff; color: white; padding: 12px 20px;
            border: none; border-radius: 6px; cursor: pointer; margin-top: 20px; font-size: 1.05em; font-weight: 500;
        }
        button:hover { background-color: #0056b3; }
        .remove-hotel-button { background-color: #dc3545; padding: 5px 10px; font-size: 0.9em; margin-left: 10px; margin-top: 0;}
        .form-section { border: 1px solid #e9ecef; padding: 20px; margin-bottom: 25px; border-radius: 8px; background-color: #fdfdfd; }
        .hotel-option-group { border: 1px solid #e0e0e0; padding: 15px; margin-top: 15px; border-radius: 8px; background-color: #fafafa; }
        .hotel-option-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .hidden { display: none; }
        #emailOutputContainer { margin-top: 30px; }
        #emailOutput { padding: 20px; border: 1px solid #ccc; background-color: #f0f2f5; border-radius: 8px; min-height: 200px; overflow-x: auto;}
    </style>
</head>
<body>
    <div class="container">
        <h1>Générateur d'e-mail Disney</h1>
        <form id="disneyForm">
            <div class="form-section">
                <h2>Informations Générales</h2>
                <label for="client_name">Nom de la personne cliente&nbsp;:</label>
                <input type="text" id="client_name" name="client_name" placeholder="Entrez le nom du client" required>
                <label for="adults">Nombre d'adultes&nbsp;:</label>
                <input type="number" id="adults" name="adults" min="1" value="2" required>
                <label for="children">Nombre d'enfants (0 si aucun)&nbsp;:</label>
                <input type="number" id="children" name="children" min="0" value="0" required>
            </div>
            <div class="form-section">
                <h2>Hébergement et Billets</h2>
                <label for="booking_type">Type de réservation&nbsp;:</label>
                <select id="booking_type" name="booking_type">
                    <option value="hotel_tickets">Hôtel + Billets</option>
                    <option value="tickets_only">Billets seulement</option>
                </select>
                <div id="hotel_options_container">
                    <div id="hotel_selections"></div>
                    <button type="button" id="add_hotel_button">Ajouter une option d'hôtel</button>
                </div>
            </div>
            <div class="form-section">
                <h2>Vols</h2>
                <label><input type="checkbox" id="include_flights" name="include_flights"> Inclure les vols&nbsp;?</label>
                <div id="flight_details" class="hidden">
                    <label for="departure_date_aller">Date de départ (Aller)&nbsp;:</label>
                    <input type="date" id="departure_date_aller" name="departure_date_aller">
                    <label for="departure_time_aller">Heure de départ (Aller)&nbsp;:</label>
                    <input type="time" id="departure_time_aller" name="departure_time_aller">
                    <label for="departure_airport_aller">Aéroport de départ (Aller)&nbsp;:</label>
                    <input type="text" id="departure_airport_aller" name="departure_airport_aller" placeholder="Ex: YUL - Montréal">
                    <label for="arrival_airport_aller">Aéroport d'arrivée (Aller)&nbsp;:</label>
                    <input type="text" id="arrival_airport_aller" name="arrival_airport_aller" placeholder="Ex: MCO - Orlando" value="MCO - Orlando">
                    <label for="departure_date_retour">Date de départ (Retour)&nbsp;:</label>
                    <input type="date" id="departure_date_retour" name="departure_date_retour">
                    <label for="departure_time_retour">Heure de départ (Retour)&nbsp;:</label>
                    <input type="time" id="departure_time_retour" name="departure_time_retour">
                    <label for="departure_airport_retour">Aéroport de départ (Retour)&nbsp;:</label>
                    <input type="text" id="departure_airport_retour" name="departure_airport_retour" placeholder="Ex: MCO - Orlando" value="MCO - Orlando">
                    <label for="arrival_airport_retour">Aéroport d'arrivée (Retour)&nbsp;:</label>
                    <input type="text" id="arrival_airport_retour" name="arrival_airport_retour" placeholder="Ex: YUL - Montréal">
                    <label for="flight_price">Prix total approximatif des vols (CAD)&nbsp;:</label>
                    <input type="number" id="flight_price" name="flight_price" step="0.01">
                    <label for="flight_notes">Notes sur les vols&nbsp;:</label>
                    <textarea id="flight_notes" name="flight_notes" placeholder="Ajoutez ici des détails importants (ex: compagnie, escale, type de bagages inclus...)"></textarea>
                </div>
            </div>
            <div class="form-section">
                <h2>Promotion</h2>
                <label for="promotion_type">Type de promotion&nbsp;:</label>
                <select id="promotion_type" name="promotion_type">
                    <option value="aucune">Aucune promotion pour l'instant</option>
                    <option value="specifique">Promotion spécifique</option>
                </select>
                <div id="promotion_details" class="hidden">
                    <label for="promotion_name">Nom de la promotion&nbsp;:</label>
                    <input type="text" id="promotion_name" name="promotion_name" placeholder="Nom de la promotion (ex: Rabais estival)">
                    <label for="promotion_end_date">Date de fin de la promotion (si applicable)&nbsp;:</label>
                    <input type="date" id="promotion_end_date" name="promotion_end_date">
                </div>
            </div>
            <button type="submit">Générer l'e-mail</button>
        </form>

        <div id="emailOutputContainer">
            <h2>E-mail Généré (Prêt à copier)</h2>
            <div id="emailOutput" contenteditable="true"></div>
            <button type="button" id="copyHtmlButton">Copier le contenu de l'e-mail</button>
        </div>
    </div>

    <script>
        const DISNEY_HOTELS = [
            // Deluxe Villas
            { name: "Bay Lake Tower at Disney's Contemporary Resort", description: "Connecté au Magic Kingdom par une passerelle, cet hôtel moderne offre des vues spectaculaires et des villas luxueuses.", level: "Deluxe Villa" },
            { name: "Boulder Ridge Villas at Disney's Wilderness Lodge", description: "Inspirées par les gîtes des parcs nationaux de l'Ouest américain, ces villas offrent un charme rustique et une ambiance chaleureuse.", level: "Deluxe Villa" },
            { name: "Copper Creek Villas & Cabins at Disney's Wilderness Lodge", description: "Des villas et cabines élégantes au bord de l'eau, offrant un mélange de luxe moderne et de nature sauvage.", level: "Deluxe Villa" },
            { name: "Disney’s Animal Kingdom Villas - Jambo House", description: "Faisant partie de l'Animal Kingdom Lodge, Jambo House offre des vues sur la savane et une architecture africaine authentique.", level: "Deluxe Villa" },
            { name: "Disney’s Animal Kingdom Villas - Kidani Village", description: "Adjacent à Jambo House, Kidani Village propose principalement des villas avec des vues étendues sur la savane.", level: "Deluxe Villa" },
            { name: "Disney’s Beach Club Villas", description: "Partageant les commodités du Beach Club Resort, ces villas offrent plus d'espace et de flexibilité avec une atmosphère balnéaire.", level: "Deluxe Villa" },
            { name: "Disney’s BoardWalk Villas", description: "Ces villas offrent le charme du BoardWalk Inn avec des hébergements plus spacieux et un accès direct à l'animation.", level: "Deluxe Villa" },
            { name: "Disney's Polynesian Villas & Bungalows", description: "Des villas et des bungalows sur pilotis luxueux offrant une expérience polynésienne ultime.", level: "Deluxe Villa" },
            { name: "Disney’s Riviera Resort", description: "Inspiré par l'élégance de la Riviera européenne, cet hôtel propose des studios et des villas de luxe avec accès au Disney Skyliner.", level: "Deluxe Villa" },
            { name: "Disney’s Saratoga Springs Resort & Spa", description: "Inspiré par la ville thermale historique de Saratoga Springs, ce complexe de style victorien propose des villas et un accès facile à Disney Springs.", level: "Deluxe Villa" },
            { name: "Les villas au Disney's Grand Floridian Resort & Spa", description: "Des villas luxueuses offrant l'élégance victorienne du Grand Floridian avec plus d'espace, des cuisines et des vues magnifiques.", level: "Deluxe Villa" },
            { name: "Disney’s Old Key West Resort", description: "Évoquant l'ambiance décontractée de Key West, ce vaste complexe propose des villas spacieuses et des terrains de golf.", level: "Deluxe Villa" },
            
            // Deluxe Resorts
            { name: "Disney’s Animal Kingdom Lodge", description: "Plongez dans l’univers africain avec ce lodge spectaculaire. Le point fort : des savanes où vous pouvez observer plus de 30 espèces d’animaux.", level: "Deluxe" },
            { name: "Disney’s Beach Club Resort", description: "Particulièrement populaire pour sa piscine Stormalong Bay, un mini-parc aquatique. Situé à quelques minutes à pied d’EPCOT.", level: "Deluxe" },
            { name: "Disney’s BoardWalk Inn", description: "Rappelle les promenades côtières des années 1920, avec une ambiance festive et un accès à pied à EPCOT.", level: "Deluxe" },
            { name: "Disney’s Contemporary Resort", description: "Un des hôtels les plus iconiques de Disney, reconnaissable à sa structure en forme de A traversée par le monorail. Accès à pied à Magic Kingdom.", level: "Deluxe" },
            { name: "Disney’s Grand Floridian Resort & Spa", description: "L’hôtel le plus luxueux de Disney, inspiré des stations balnéaires victoriennes, avec un service haut de gamme et un spa complet.", level: "Deluxe" },
            { name: "Disney’s Polynesian Village Resort", description: "Ambiance tropicale, torches enflammées, et bâtiments inspirés des îles du Pacifique. Connecté par monorail à Magic Kingdom.", level: "Deluxe" },
            { name: "Disney’s Wilderness Lodge", description: "Inspiré des grands lodges des parcs nationaux américains, ce complexe majestueux propose un décor rustique et un accès en bateau à Magic Kingdom.", level: "Deluxe" },
            { name: "Disney’s Yacht Club Resort", description: "Voisin du Beach Club et partageant avec lui l’accès à Stormalong Bay, cet hôtel présente une esthétique nautique raffinée.", level: "Deluxe" },

            // Moderate Resorts
            { name: "Disney’s Caribbean Beach Resort", description: "Ce vaste complexe vous transporte dans l’ambiance relaxante des Caraïbes et sert de hub central pour le Disney Skyliner.", level: "Moderate" },
            { name: "Disney’s Coronado Springs Resort", description: "Mariant l’architecture espagnole coloniale et l’élégance de la tour Gran Destino, il offre une ambiance sophistiquée à un prix de catégorie modérée.", level: "Moderate" },
            { name: "Disney’s Port Orleans Resort - French Quarter", description: "Ce charmant hôtel évoque le Vieux Carré de La Nouvelle-Orléans. Sa petite taille le rend intime et facile à parcourir.", level: "Moderate" },
            { name: "Disney’s Port Orleans Resort - Riverside", description: "Divisé en deux sections, les manoirs élégants et les bayous rustiques, il offre une grande variété de paysages et des balades en calèche.", level: "Moderate" },
            { name: "The Cabins at Disney's Fort Wilderness Resort", description: "Offrant une véritable immersion dans la nature, ces cabines rustiques sont nichées dans une forêt et peuvent loger jusqu’à six personnes.", level: "Moderate" },
            
            // Value Resorts
            { name: "Disney’s All-Star Movies Resort", description: "Plongez dans la magie du cinéma avec cet hôtel thématique qui rend hommage aux grands classiques d’animation de Disney.", level: "Value" },
            { name: "Disney’s All-Star Music Resort", description: "Inspiré de différents genres musicaux, cet hôtel immersif propose une ambiance rythmée et des suites familiales.", level: "Value" },
            { name: "Disney’s All-Star Sports Resort", description: "Idéal pour les amateurs d’activités physiques, cet hôtel célèbre les grands sports américains avec une ambiance énergique.", level: "Value" },
            { name: "Disney’s Art of Animation Resort", description: "Cet hôtel transporte les visiteurs dans les mondes colorés de La Petite Sirène, Le Roi Lion, Némo et Cars. Suites familiales et accès au Skyliner.", level: "Value" },
            { name: "Disney’s Pop Century Resort", description: "Remontez le temps à travers la culture populaire des années 1950 à 1990. Excellent rapport qualité-prix et accès au Disney Skyliner.", level: "Value" }
        ];

        function getHotelByName(name) { return DISNEY_HOTELS.find(hotel => hotel.name === name); }
        function formatDateFR(dateStr) { if (!dateStr) return ""; try { const date = new Date(dateStr + 'T00:00:00'); const options = { year: 'numeric', month: 'long', day: 'numeric' }; return date.toLocaleDateString('fr-FR', options); } catch (e) { return dateStr; } }
        function formatTime(timeStr) { if (!timeStr) return ""; try { const [hours, minutes] = timeStr.split(':'); return `${String(hours).padStart(2, '0')}h${String(minutes).padStart(2, '0')}`; } catch (e) { return timeStr; } }

        function generateEmailHTML(data) {
             const C = {
                blue: '#0078C1',
                blueDark: '#005a9c',
                orange: '#FF7F50',
                textDark: '#222222',
                textLight: '#555555',
                border: '#E0E0E0',
                background: '#f0f2f5',
                white: '#FFFFFF',
                col1: '#f8fafd',
                col2: '#ffffff',
                col3: '#f8fafd',
                blueLight: '#e6f2fa',
                orangeLight: '#fff4e6',
                green: '#28a745',
                level: {
                    value: '#4CAF50',
                    moderate: '#2196F3',
                    deluxe: '#673AB7',
                    deluxe_villa: '#9C27B0'
                }
            };

            const S = {
                fontStack: `Arial, Helvetica, sans-serif`,
                p: `font-family: Arial, Helvetica, sans-serif; font-size: 16px; line-height: 1.6; color: ${C.textDark}; margin: 1em 0;`,
                strong: `font-weight: bold;`,
                italic: `font-style: italic;`,
            };
            
            function createBanner(text, type = 'main') {
                let style, titleStyle, wrapperStyle;
                switch (type) {
                    case 'closing':
                        style = `background-color: ${C.orange}; padding: 12px 30px;`;
                        titleStyle = `font-family: Georgia, serif; font-size: 24px; color: ${C.white}; font-weight: bold; text-transform: uppercase; margin: 0; text-align: center; letter-spacing: 1px;`;
                        wrapperStyle = `padding: 5px 0;`
                        break;
                    case 'sub':
                        style = `background-color: ${C.blue}; padding: 10px 30px;`;
                        titleStyle = `font-family: ${S.fontStack}; font-size: 20px; color: ${C.white}; font-weight: bold; text-transform: uppercase; margin: 0; text-align: center;`;
                        wrapperStyle = `padding: 0;`
                        break;
                    case 'main':
                    default:
                        style = `background: linear-gradient(to right, ${C.blue}, ${C.blueDark}); padding: 25px 30px;`;
                        titleStyle = `font-family: Georgia, serif; font-size: 32px; color: ${C.white}; font-weight: bold; text-transform: uppercase; margin: 0; text-align: center; letter-spacing: 1.5px; line-height:1.2;`;
                        wrapperStyle = `border-top: 1px solid rgba(255,255,255,0.3); border-bottom: 1px solid rgba(255,255,255,0.3); padding: 10px 0;`
                        break;
                }

                return `<tr><td style="${style}"><div style="${wrapperStyle}"><h1 style="${titleStyle}">${text}</h1></div></td></tr>`;
            }

            const T = {
                banner1: "Votre Aventure Magique Commence Ici",
                greeting: `Bonjour <strong style="${S.strong}">${data.client_name || 'estimé(e) voyageur(se)'}</strong>,`,
                intro1: `Je vous écris au nom de Voyages en Route, où nous avons le plaisir d’accompagner les familles et voyageurs dans la planification de leurs séjours. Je m'appelle Pierre-Luc Morin et je serais votre conseiller en voyages spécialisé en destinations <strong style="${S.strong}">Disney et Universal</strong>.`,
                intro2: `Merci de nous avoir confié votre projet de voyage. J’ai pris soin de préparer une proposition basée sur les critères que vous avez partagés dans votre demande. Cette soumission est <strong style="${S.strong}">ajustable</strong>, et je serai heureux d’explorer avec vous différentes options afin de vous créer une expérience <strong style="${S.strong}">propre à vous et inoubliable</strong>.`,
                banner_disney_stay: "Forfaits Hôtel & Billets",
                disney_advantages_intro: `Séjourner dans un hôtel Disney, c’est profiter d’un univers immersif du matin au soir, mais aussi de <strong style="${S.strong}">nombreux avantages exclusifs</strong>&nbsp;:</p>`,
                disney_advantages_list_items: [
                    `<strong style="${S.strong}">L’Early Theme Park Entry</strong>, pour accéder aux parcs avant l’ouverture officielle&nbsp;;`,
                    `Le <strong style="${S.strong}">transport gratuit</strong> vers tous les parcs et sites Disney (excluant les transferts aéroports)&nbsp;;`,
                    `L’<strong style="${S.strong}">accès simplifié</strong> aux réservations avec l’application Disney Experience&nbsp;;`,
                    `Et un <strong style="${S.strong}">service client exceptionnel</strong>, signé Disney, à chaque étape de votre séjour.`
                ],
                disney_price_disclaimer: "Veuillez noter que tous les prix pour l'hébergement et les billets Disney sont indiqués en dollars américains (USD) et sont sujets à disponibilité.",
                tickets_only_price_disclaimer: "Veuillez noter que tous les prix des billets Disney sont indiqués en dollars américains (USD) et sont sujets à disponibilité.",
                banner_travel_fees: "Transport Aérien",
                flight_intro: "Pour compléter votre voyage vers la magie, voici les détails concernant le transport aérien que nous avons exploré&nbsp;:",
                flight_price_info: `<em style="${S.italic}">Les prix sont à titre indicatif et peuvent changer à tout moment.</em>`,
                flight_important_label: `<strong style="${S.strong}">IMPORTANT&nbsp;:</strong>`,
                flight_important_text: `Les tarifs aériens sont dynamiques et peuvent changer jusqu'à la réservation. Des frais de service de <strong style="${S.strong}">50$ CAD par personne</strong> s'appliquent pour la réservation des vols via nos services. En me confiant vos vols, je m'occupe de tout désagrément potentiel. Si vous optez pour une réservation personnelle, ces frais ne s'appliquent pas, mais le support en cas de problème avec les vols ne sera pas inclus pour cette portion.`,
                banner_magic_continues: "La Magie Continue...",
                closing1: `Prenez le temps de rêver à ces options et de considérer ce qui ferait de ce voyage une expérience <strong style="${S.strong}">véritablement inoubliable</strong>. Je suis à votre <strong style="${S.strong}">entière disposition</strong> pour répondre à toutes vos questions, affiner chaque détail ou procéder à la réservation de cette <em style="${S.italic}">aventure mémorable</em>.`,
                closing2: `N'hésitez pas à me joindre par courriel (en répondant simplement à celui-ci) ou par téléphone au <strong style="${S.strong}">819-347-9103</strong>.`,
                closing3: `Merci encore pour votre confiance. J'ai sincèrement hâte de transformer ce <strong style="${S.strong}">rêve Disney</strong> en une <strong style="${S.strong}">magnifique réalité pour vous&nbsp;!</strong>`
            };
            
            let introSection = `<p style="${S.p}">${T.greeting}</p><p style="${S.p}">${T.intro1}</p><p style="${S.p}">${T.intro2}</p>`;
            let hotelSection = '';
            const selectedHotels = data.hotels || [];

            if (data.booking_type === 'hotel_tickets' && selectedHotels.length > 0) {
                 if (selectedHotels.length === 1) {
                    const hotel = selectedHotels[0];
                     const levelColor = C.level[hotel.level.toLowerCase().replace(/ /g, '_')] || C.textLight;
                    hotelSection += `<p style="${S.p}">Pour votre séjour, j’ai sélectionné l’option suivante&nbsp;:</p>
                                     <div style="border: 1px solid ${C.border}; border-radius: 8px;">
                                        <div style="background-color:${C.blue}; color:${C.white}; padding:15px 20px; border-radius: 8px 8px 0 0;">
                                            <strong style="font-family:${S.fontStack}; font-size:20px;">${hotel.name}</strong>
                                        </div>
                                         <div style="padding:20px; background-color:${C.white};">
                                            <span style="background-color:${levelColor}; color:${C.white}; padding: 4px 10px; border-radius: 15px; font-size: 12px; font-weight: bold;">${hotel.level}</span>
                                            <p style="font-family:${S.fontStack}; font-size:15px; line-height:1.5; color:${C.textLight}; margin:15px 0 0 0;">${hotel.description}</p>
                                         </div>
                                     </div>`;
                } else {
                    hotelSection += `<p style="${S.p}">Voici plusieurs options d’hébergement pour votre séjour. Chaque proposition ci-dessous correspond à un forfait détaillé dans un document PDF distinct.</p>`;
                    let hotelTable = `<table width="100%" border="0" cellpadding="0" cellspacing="0" style="margin-top:20px; border-collapse: collapse;">
                                        <thead>
                                            <tr>
                                                <th width="45%" style="padding:12px 20px; font-family:${S.fontStack}; font-size:14px; color:${C.blue}; background-color:${C.blueLight}; text-align:left; border-bottom: 3px solid ${C.white};">OPTION</th>
                                                <th width="35%" style="padding:12px 20px; font-family:${S.fontStack}; font-size:14px; color:${C.blue}; background-color:${C.blueLight}; text-align:left; border-bottom: 3px solid ${C.white};">POINTS FORTS</th>
                                                <th width="20%" style="padding:12px 20px; font-family:${S.fontStack}; font-size:14px; color:${C.blue}; background-color:${C.blueLight}; text-align:right; border-bottom: 3px solid ${C.white};">FORFAIT (USD)</th>
                                            </tr>
                                        </thead>
                                        <tbody>`;
                    selectedHotels.forEach(hotel => {
                        const levelColor = C.level[hotel.level.toLowerCase().replace(/ /g, '_')] || C.textLight;
                        let prosList = '';
                        if (hotel.pros) {
                           prosList = `<ul style="margin:0; padding:0; list-style-type:none;">` + hotel.pros.split('\n').map(p => p.trim() ? `<li style="margin-bottom:8px;"><span style="color:${C.blue}; font-size:18px; vertical-align:middle; margin-right:8px; font-weight:bold;">&#10004;</span><span style="vertical-align:middle;">${p}</span></li>` : '').join('') + `</ul>`;
                        }

                        hotelTable += `<tr style="border-bottom: 10px solid ${C.background};">
                            <td style="padding:0; background-color:${C.col1}; vertical-align:top;">
                                <div style="background-color:${C.blue}; color:${C.white}; padding:15px 20px;">
                                    <strong style="font-family:${S.fontStack}; font-size:18px;">${hotel.name}</strong>
                                </div>
                                <div style="padding:20px;">
                                    <span style="background-color:${levelColor}; color:${C.white}; padding: 4px 10px; border-radius: 15px; font-size: 12px; font-weight: bold;">${hotel.level}</span>
                                    <p style="font-family:${S.fontStack}; font-size:14px; line-height:1.5; color:${C.textLight}; margin:15px 0 0 0;">${hotel.description}</p>
                                </div>
                            </td>
                            <td style="padding:20px; background-color:${C.col2}; vertical-align:top;">${prosList}</td>
                            <td style="padding:20px; background-color:${C.col3}; vertical-align:top; text-align:right; font-family:${S.fontStack}; font-size:18px; font-weight:bold; color:${C.textDark};">${hotel.price || 'Voir PDF'}</td>
                        </tr>`;
                    });
                    hotelTable += `</tbody></table>`;
                    hotelSection += hotelTable;
                }
                
                hotelSection += `<p style="${S.p} margin-top:20px;">Chaque proposition de forfait inclut l'hébergement à l'hôtel ainsi que les billets d'entrée pour les parcs Disney. Tous les autres détails, inclusions et conditions se trouvent dans le ou les documents PDF correspondants.</p>`
                let advantagesList = T.disney_advantages_list_items.map(item => `<li style="margin-bottom:8px;"><span style="color:${C.blue}; font-size:18px; vertical-align:middle; margin-right:8px; font-weight:bold;">&#10004;</span><span style="vertical-align:middle;">${item}</span></li>`).join('');
                hotelSection += `<p style="${S.p} margin-top:30px;">${T.disney_advantages_intro}<ul style="margin:1em 0; padding:0; list-style-type:none;">${advantagesList}</ul>`;

            } else if (data.booking_type === 'tickets_only') {
                hotelSection = `<p style="${S.p}">J’ai préparé pour vous un document ci-joint indiquant le prix ainsi que les conditions applicables aux billets de parc.</p>`;
            }

            let promoText = "";
            if (data.promotion_type === 'aucune') {
                promoText = `Pour garantir votre place au cœur de la magie, un dépôt de seulement <strong style="${S.strong}">200 USD</strong> est requis. Soyez assuré que je veillerai personnellement à appliquer toute nouvelle promotion applicable d'ici votre départ pour optimiser la valeur de votre voyage. Ce dépôt est <strong style="${S.strong}">entièrement remboursable jusqu'à 30 jours avant votre arrivée</strong>, vous offrant une <strong style="${S.strong}">flexibilité totale</strong> pour planifier en toute sérénité.`;
            } else {
                let promoEndDateInfo = data.promotion_end_date ? ` (prend fin le <strong style="${S.strong}">${formatDateFR(data.promotion_end_date)}</strong>)` : "";
                let promoNameInfo = data.promotion_name ? `&nbsp;: <strong style="${S.strong}">${data.promotion_name}</strong>` : "";
                promoText = `Une promotion est applicable pour votre séjour${promoNameInfo}${promoEndDateInfo}. L’offre est cependant <em style="${S.italic}">limitée</em>. Pour garantir votre place au cœur de la magie, un dépôt de seulement <strong style="${S.strong}">200 USD</strong> est requis. Ce dépôt est <strong style="${S.strong}">entièrement remboursable jusqu'à 30 jours avant votre arrivée</strong>, vous offrant une <strong style="${S.strong}">flexibilité totale</strong> pour planifier en toute sérénité.`;
            }
            
            let promotionSection = `<table width="100%" border="0" cellpadding="0" cellspacing="0" style="margin-top:20px;"><tr><td style="padding: 20px 25px; background-color: ${C.orangeLight}; border-left: 5px solid ${C.orange}; border-radius: 0 8px 8px 0;"><h2 style="font-family:${S.fontStack}; font-size:18px; color:${C.orange}; margin:0 0 10px 0; font-weight:bold;">PROMOTIONS ET DÉPÔT REQUIS</h2><p style="${S.p} margin:0;">${promoText}</p></td></tr></table>`;
            let priceDisclaimer = (data.booking_type === 'hotel_tickets' && selectedHotels.length > 0) ? T.disney_price_disclaimer : T.tickets_only_price_disclaimer;

            let flightSection = '';
            if (data.include_flights) {
                 const airportTagStyle = `background-color: ${C.blue}; color: ${C.white}; padding: 3px 8px; border-radius: 4px; font-size: 14px; font-weight: bold; text-decoration: none;`;
                 let flightDetails = `<p style="${S.p}">${T.flight_intro}</p>
                    <table width="100%" border="0" cellpadding="0" cellspacing="0" style="margin:20px 0;">
                        <tr>
                            <td width="50%" style="padding-right: 10px;">
                                <table width="100%" border="0" cellpadding="0" cellspacing="0" style="border:1px solid ${C.border}; border-radius: 8px; ">
                                    <tr><td align="center" style="padding: 15px; border-bottom: 1px solid ${C.border}; background-color:${C.blueLight}; border-radius: 8px 8px 0 0;">
                                        <strong style="color:${C.blue}; font-size:18px; vertical-align: middle;">Vol Aller</strong>
                                    </td></tr>
                                    <tr><td style="padding: 20px; font-size: 15px; background-color:${C.white}; border-radius: 0 0 8px 8px;">
                                        <strong style="color:${C.textLight};">Date&nbsp;:</strong> ${formatDateFR(data.departure_date_aller)} à ${formatTime(data.departure_time_aller)}<br><br>
                                        <span style="${airportTagStyle}">${data.departure_airport_aller || 'N/A'}</span> &rarr; <span style="${airportTagStyle}">${data.arrival_airport_aller || 'N/A'}</span>
                                    </td></tr>
                                </table>
                            </td>
                            <td width="50%" style="padding-left: 10px;">
                                 <table width="100%" border="0" cellpadding="0" cellspacing="0" style="border:1px solid ${C.border}; border-radius: 8px; ">
                                    <tr><td align="center" style="padding: 15px; border-bottom: 1px solid ${C.border}; background-color:${C.blueLight}; border-radius: 8px 8px 0 0;">
                                        <strong style="color:${C.blue}; font-size:18px; vertical-align: middle;">Vol Retour</strong>
                                    </td></tr>
                                    <tr><td style="padding: 20px; font-size: 15px; background-color:${C.white}; border-radius: 0 0 8px 8px;">
                                        <strong style="color:${C.textLight};">Date&nbsp;:</strong> ${formatDateFR(data.departure_date_retour)} à ${formatTime(data.departure_time_retour)}<br><br>
                                        <span style="${airportTagStyle}">${data.departure_airport_retour || 'N/A'}</span> &rarr; <span style="${airportTagStyle}">${data.arrival_airport_retour || 'N/A'}</span>
                                    </td></tr>
                                </table>
                            </td>
                        </tr>
                    </table>`;
                if (data.flight_notes) {
                    flightDetails += `<p style="${S.p} font-style:italic; font-weight:bold; color:${C.textLight}; border-left:3px solid ${C.border}; padding-left:15px; margin-top:20px;">${data.flight_notes.replace(/\n/g, '<br>')}</p>`;
                }
                flightDetails += `<p style="${S.p}"><strong style="${S.strong}">Prix total approximatif des vols&nbsp;:</strong> ${data.flight_price || 'N/A'} CAD</p>
                                  <p style="${S.p} font-size:14px; color:${C.textLight};">${T.flight_price_info}</p>
                                  <p style="${S.p} font-size:14px; color:${C.textLight};">${T.flight_important_label} ${T.flight_important_text}</p>`;
                flightSection = createBanner(T.banner_travel_fees, 'sub') + `<tr><td style="padding: 20px 30px 30px 30px;">${flightDetails}</td></tr>`;
            }

            let closingSection = `<p style="${S.p}">${T.closing1}</p><p style="${S.p}">${T.closing2}</p><p style="${S.p}">${T.closing3}</p>`;

            return `<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><title>${T.banner1}</title></head><body style="margin:0; padding:0; background-color:${C.background};"><table width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="background-color:${C.background};"><tr><td align="center"><table width="680" border="0" cellpadding="0" cellspacing="0" role="presentation" style="width: 680px; max-width: 100%; margin: 20px auto; background-color: ${C.white};">
                ${createBanner(T.banner1, 'main')}
                <tr><td style="padding: 20px 30px 30px 30px;">${introSection}</td></tr>
                ${createBanner(T.banner_disney_stay, 'sub')}
                <tr><td style="padding: 20px 30px 10px 30px;">${hotelSection}</td></tr>
                <tr><td style="padding: 10px 30px 30px 30px;">${promotionSection}</td></tr>
                <tr><td style="padding: 0 30px 30px 30px;"><p style="${S.p} font-size:14px; color:${C.textLight}; text-align:center; ${S.italic}">${priceDisclaimer}</p></td></tr>
                ${flightSection}
                ${createBanner(T.banner_magic_continues, 'closing')}
                <tr><td style="padding: 20px 30px 30px 30px;">${closingSection}</td></tr>
            </table></td></tr></table></body></html>`;
        }

        // --- Le reste du script JS pour le formulaire reste identique ---
        document.addEventListener('DOMContentLoaded', function() {
            const hotelSelectionsDiv = document.getElementById('hotel_selections');
            const addHotelButton = document.getElementById('add_hotel_button');
            let hotelCounter = 0;

            function createHotelSelector() {
                hotelCounter++;
                const groupDiv = document.createElement('div');
                groupDiv.classList.add('hotel-option-group');
                groupDiv.id = `hotel_group_${hotelCounter}`;
                
                let content = `
                    <div class="hotel-option-header">
                        <label>Option d'hôtel</label>
                        <button type="button" class="remove-hotel-button" title="Supprimer cet hôtel">Supprimer</button>
                    </div>
                    <select name="hotel_name" required>
                        <option value="" disabled selected>Sélectionnez un hôtel</option>
                        ${DISNEY_HOTELS.sort((a,b) => a.name.localeCompare(b.name)).map(hotel => `<option value="${hotel.name}">${hotel.name}</option>`).join('')}
                    </select>
                    <label for="hotel_price_${hotelCounter}">Prix du Forfait (USD)&nbsp;:</label>
                    <input type="number" name="hotel_price" id="hotel_price_${hotelCounter}" placeholder="Ex: 4500.50" step="0.01">
                    <label for="hotel_pros_${hotelCounter}">Points Forts (un par ligne)&nbsp;:</label>
                    <textarea name="hotel_pros" id="hotel_pros_${hotelCounter}" placeholder="Ex: Accès au Skyliner\nPiscine exceptionnelle"></textarea>
                `;
                groupDiv.innerHTML = content;

                groupDiv.querySelector('.remove-hotel-button').addEventListener('click', function() {
                    groupDiv.remove();
                    updateAddHotelButtonState();
                });

                return groupDiv;
            }

            function updateAddHotelButtonState() {
                const currentHotelSelectors = hotelSelectionsDiv.querySelectorAll('.hotel-option-group').length;
                addHotelButton.disabled = currentHotelSelectors >= 5;
                addHotelButton.textContent = currentHotelSelectors >= 5 ? "Maximum 5 hôtels atteints" : "Ajouter une option d'hôtel";
            }

            addHotelButton.addEventListener('click', function() {
                if (hotelSelectionsDiv.querySelectorAll('.hotel-option-group').length < 5) {
                    hotelSelectionsDiv.appendChild(createHotelSelector());
                    updateAddHotelButtonState();
                }
            });

            // Start with one hotel selector
            hotelSelectionsDiv.appendChild(createHotelSelector());
            updateAddHotelButtonState();
            
            const form = document.getElementById('disneyForm');
            const emailOutputDiv = document.getElementById('emailOutput');
            
            form.addEventListener('submit', function(event) {
                event.preventDefault();
                const formData = new FormData(form);
                const data = {};
                for (let [key, value] of formData.entries()) {
                    if (!key.startsWith('hotel_')) {
                        data[key] = value;
                    }
                }
                data.include_flights = formData.has('include_flights');
                
                data.hotels = [];
                const hotelGroups = hotelSelectionsDiv.querySelectorAll('.hotel-option-group');
                hotelGroups.forEach(group => {
                    const name = group.querySelector('select[name="hotel_name"]').value;
                    const price = group.querySelector('input[name="hotel_price"]').value;
                    const pros = group.querySelector('textarea[name="hotel_pros"]').value;
                    if(name) {
                        const hotelData = getHotelByName(name);
                        data.hotels.push({
                            name: name,
                            description: hotelData ? hotelData.description : "Description non trouvée.",
                            level: hotelData ? hotelData.level : "N/A",
                            price: price,
                            pros: pros
                        });
                    }
                });
                
                const emailHtmlContent = generateEmailHTML(data);
                emailOutputDiv.innerHTML = emailHtmlContent;
            });

            const copyHtmlButton = document.getElementById('copyHtmlButton');
            copyHtmlButton.addEventListener('click', function() {
                const emailContent = emailOutputDiv.innerHTML;
                 navigator.clipboard.writeText(emailContent).then(function() {
                    alert('Contenu HTML de l\'e-mail copié dans le presse-papiers !');
                }, function(err) {
                    alert('Erreur lors de la copie. Veuillez essayer manuellement.');
                    console.error('Could not copy text: ', err);
                });
            });
            
            const includeFlightsCheckbox = document.getElementById('include_flights');
            const flightDetailsDiv = document.getElementById('flight_details');
            const bookingTypeSelect = document.getElementById('booking_type');
            const hotelOptionsContainer = document.getElementById('hotel_options_container');
            const promotionTypeSelect = document.getElementById('promotion_type');
            const promotionDetailsDiv = document.getElementById('promotion_details');
            
            function toggleFlightDetails() { flightDetailsDiv.classList.toggle('hidden', !includeFlightsCheckbox.checked); }
            function toggleHotelOptions() { hotelOptionsContainer.classList.toggle('hidden', bookingTypeSelect.value !== 'hotel_tickets'); }
            function togglePromotionDetails() { promotionDetailsDiv.classList.toggle('hidden', promotionTypeSelect.value !== 'specifique'); }

            includeFlightsCheckbox.addEventListener('change', toggleFlightDetails);
            bookingTypeSelect.addEventListener('change', toggleHotelOptions);
            promotionTypeSelect.addEventListener('change', togglePromotionDetails);
            
            toggleFlightDetails();
            toggleHotelOptions();
            togglePromotionDetails();
        });
    </script>
</body>
</html>
