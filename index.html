<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GÃ©nÃ©rateur d'e-mail Disney (Version Finale)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; margin: 20px; background-color: #f4f4f4; color: #333; line-height: 1.6; }
        .container { background-color: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 900px; margin: auto;}
        h1 { text-align: center; margin-bottom: 30px; color: #0078C1; font-weight: 700;}
        h2 { margin-top: 25px; color: #0078C1; border-bottom: 2px solid #eee; padding-bottom: 8px;}
        label { display: block; margin-top: 15px; font-weight: 600; color: #333; }
        input[type="text"], input[type="number"], input[type="date"], input[type="time"], select, textarea {
            width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 1em;
        }
        textarea { resize: vertical; min-height: 80px; }
        input[type="checkbox"] { margin-right: 8px; vertical-align: middle; width: auto; }
        button, .remove-hotel-button {
            background-color: #007bff; color: white; padding: 12px 20px;
            border: none; border-radius: 6px; cursor: pointer; margin-top: 20px; font-size: 1.05em; font-weight: 500;
        }
        button:hover { background-color: #0056b3; }
        .remove-hotel-button { background-color: #dc3545; padding: 5px 10px; font-size: 0.9em; margin-left: 10px; margin-top: 0;}
        .form-section { border: 1px solid #e9ecef; padding: 20px; margin-bottom: 25px; border-radius: 8px; background-color: #fdfdfd; }
        .hotel-option-group { border: 1px solid #e0e0e0; padding: 15px; margin-top: 15px; border-radius: 8px; background-color: #fafafa; }
        .hotel-option-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .hidden { display: none; }
        #emailOutputContainer { margin-top: 30px; }
        #emailOutput { padding: 20px; border: 1px solid #ccc; background-color: #f0f2f5; border-radius: 8px; min-height: 200px; overflow-x: auto;}
        .flight-inputs { border: 1px solid #ddd; border-radius: 8px; padding: 10px 15px 15px 15px; margin-top:10px; }
        .header-logos { display: flex; justify-content: space-between; align-items: center; background-color: #eceff1; padding: 10px; border-radius: 8px; margin-bottom: 20px; }
        .header-logos img { max-height: 80px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-logos">
            <img src="https://www.voyagesenroute.com/wp-content/uploads/2024/10/Logo_Fond_Blanc_2.svg" alt="Logo agence">
            <img src="https://i.ibb.co/GQVYyJn2/Disney-Organisateur-de-vacances-autorise-Disney-Ear-Marked-argent-1-1-e1722367433886.png" alt="Earmarked">
        </div>
        <h1>GÃ©nÃ©rateur d'e-mail Disney</h1>
        <form id="disneyForm">
            <div class="form-section">
                <h2>Informations GÃ©nÃ©rales</h2>
                <label for="client_name">Nom de la personne cliente&nbsp;:</label>
                <input type="text" id="client_name" name="client_name" placeholder="Entrez le nom du client" required>
                <label for="adults">Nombre d'adultes&nbsp;:</label>
                <input type="number" id="adults" name="adults" min="1" value="2" required>
                <label for="children">Nombre d'enfants (0 si aucun)&nbsp;:</label>
                <input type="number" id="children" name="children" min="0" value="0" required>
            </div>
            <div class="form-section">
                <h2>HÃ©bergement et Billets</h2>
                <label for="booking_type">Type de rÃ©servation&nbsp;:</label>
                <select id="booking_type" name="booking_type">
                    <option value="hotel_tickets">HÃ´tel + Billets</option>
                    <option value="tickets_only">Billets seulement</option>
                </select>
                <div id="hotel_options_container">
                    <div id="hotel_selections"></div>
                    <button type="button" id="add_hotel_button">Ajouter une option d'hÃ´tel</button>
                </div>
            </div>
            <div class="form-section">
                <h2>Vols</h2>
                <label><input type="checkbox" id="include_flights" name="include_flights"> Inclure les vols&nbsp;?</label>
<div id="flight_details" class="hidden">
                    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label style="margin-top: 5px; font-weight: normal; background-color: #f0f2f5; padding: 10px; border-radius: 6px; display: inline-block;">
                        <input type="checkbox" id="too_early_for_flights" name="too_early_for_flights"> Il est trop tÃ´t pour rÃ©server les vols.
                    </label>
                    
                    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="flight_inputs_wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flight-inputs">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>Vol Aller</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="departure_date_aller">Date de dÃ©part (Aller)&nbsp;:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="departure_date_aller" name="departure_date_aller">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="departure_time_aller">Heure de dÃ©part (Aller)&nbsp;:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="time" id="departure_time_aller" name="departure_time_aller">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="departure_airport_aller">AÃ©roport de dÃ©part (Aller)&nbsp;:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="departure_airport_aller" name="departure_airport_aller" placeholder="Ex: YUL - MontrÃ©al">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="arrival_airport_aller">AÃ©roport d'arrivÃ©e (Aller)&nbsp;:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="arrival_airport_aller" name="arrival_airport_aller" placeholder="Ex: MCO - Orlando" value="MCO - Orlando">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="airline_aller">Compagnie AÃ©rienne (Aller)&nbsp;:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="airline_aller" name="airline_aller" placeholder="Ex: Air Canada">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="flight_number_aller">NumÃ©ro de vol (Aller)&nbsp;:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="flight_number_aller" name="flight_number_aller" placeholder="Ex: AC1676">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flight-inputs">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>Vol Retour</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="departure_date_retour">Date de dÃ©part (Retour)&nbsp;:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="departure_date_retour" name="departure_date_retour">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="departure_time_retour">Heure de dÃ©part (Retour)&nbsp;:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="time" id="departure_time_retour" name="departure_time_retour">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="departure_airport_retour">AÃ©roport de dÃ©part (Retour)&nbsp;:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="departure_airport_retour" name="departure_airport_retour" placeholder="Ex: MCO - Orlando" value="MCO - Orlando">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="arrival_airport_retour">AÃ©roport d'arrivÃ©e (Retour)&nbsp;:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="arrival_airport_retour" name="arrival_airport_retour" placeholder="Ex: YUL - MontrÃ©al">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="airline_retour">Compagnie AÃ©rienne (Retour)&nbsp;:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="airline_retour" name="airline_retour" placeholder="Ex: Air Canada">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="flight_number_retour">NumÃ©ro de vol (Retour)&nbsp;:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="flight_number_retour" name="flight_number_retour" placeholder="Ex: AC1677">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="flight_price">Prix total approximatif des vols (CAD)&nbsp;:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="flight_price" name="flight_price" step="0.01">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="flight_notes">Notes sur les vols&nbsp;:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="flight_notes" name="flight_notes" placeholder="Ajoutez ici des dÃ©tails importants (ex: compagnie, escale, type de bagages inclus...)"></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div> Â  Â  Â  Â  Â  Â  Â  Â  
                    </div>
            </div>
            <div class="form-section">
                <h2>Promotion</h2>
                <label for="promotion_type">Type de promotion&nbsp;:</label>
                <select id="promotion_type" name="promotion_type">
                    <option value="aucune">Aucune promotion pour l'instant</option>
                    <option value="specifique">Promotion spÃ©cifique</option>
                </select>
                <div id="promotion_details" class="hidden">
                    <label for="promotion_name">Nom de la promotion&nbsp;:</label>
                    <input type="text" id="promotion_name" name="promotion_name" placeholder="Nom de la promotion (ex: Rabais estival)">
                    <label for="promotion_end_date">Date de fin de la promotion (si applicable)&nbsp;:</label>
                    <input type="date" id="promotion_end_date" name="promotion_end_date">
                </div>
            </div>
            <button type="button" id="generateEmailButton">GÃ©nÃ©rer l'e-mail</button>
        </form>

        <div id="emailOutputContainer">
            <h2>E-mail GÃ©nÃ©rÃ© (PrÃªt Ã  copier)</h2>
            <div id="emailOutput" contenteditable="true"></div>
            <button type="button" id="copyHtmlButton">Copier le contenu de l'e-mail</button>
        </div>
    </div>

    <script>
        const DISNEY_HOTELS = [
             // Deluxe Villas
            { name: "Bay Lake Tower at Contemporary", description: "Ce croissant de lune moderne adjacent au Contemporary offre des villas luxueuses et une vue imprenable sur Magic Kingdom. Son sky-bridge le connecte directement Ã  l'hÃ´tel principal et au monorail.", level: "Deluxe Villa", pointsForts: ["Distance de marche de Magic Kingdom", "AccÃ¨s Ã  la ligne du monorail", "Vues spectaculaires sur les feux d'artifice", "Piscine privÃ©e avec glissade d'eau"] },
            { name: "Villas at Grand Floridian", description: "Le summum du luxe et de l'Ã©lÃ©gance victorienne dans un format de villa spacieuse. Profitez du service impeccable et des restaurants primÃ©s du Grand Floridian, le tout sur la ligne du monorail.", level: "Deluxe Villa", pointsForts: ["HÃ©bergement le plus luxueux de Disney", "Restaurants gastronomiques sur place", "Spa Senses de classe mondiale", "AccÃ¨s direct au monorail"] },
            { name: "Polynesian Villas & Bungalows", description: "Ã‰vadez-vous dans un paradis tropical avec ces villas et bungalows sur l'eau. L'ambiance des Ã®les du Pacifique Sud, la vue sur le lagon et l'accÃ¨s au monorail en font une escapade de rÃªve.", level: "Deluxe Villa", pointsForts: ["Bungalows uniques sur pilotis", "Ambiance tropicale immersive", "SituÃ© sur la ligne du monorail", "Excellents restaurants thÃ©matiques ('Ohana)"] },
            { name: "BoardWalk Villas", description: "Revivez le charme d'une promenade cÃ´tiÃ¨re du dÃ©but du XXe siÃ¨cle. Ces villas offrent un accÃ¨s direct Ã  l'animation effervescente du BoardWalk, avec ses restaurants, boutiques et spectacles de rue.", level: "Deluxe Villa", pointsForts: ["Distance de marche de EPCOT et Hollywood Studios", "Vie nocturne et restaurants sur le BoardWalk", "Piscine Luna Park sur le thÃ¨me du cirque", "Service de bateau-taxi (Friendship)"] },
            { name: "Beach Club Villas", description: "Profitez de l'ambiance dÃ©contractÃ©e d'une villa de la Nouvelle-Angleterre. Le point d'orgue est Stormalong Bay, un incroyable complexe aquatique de 3 acres avec fond de sable et riviÃ¨re tranquille.", level: "Deluxe Villa", pointsForts: ["AccÃ¨s Ã  la meilleure piscine de Disney World", "Ã€ quelques pas de l'entrÃ©e d'EPCOT", "AtmosphÃ¨re balnÃ©aire relaxante", "Restaurant populaire Beaches & Cream"] },
            { name: "Riviera Resort", description: "InspirÃ© par l'Ã©lÃ©gance de la Riviera europÃ©enne, cet hÃ´tel sophistiquÃ© allie le glamour europÃ©en Ã  la magie de Disney. Ses studios et villas offrent des vues magnifiques et une dÃ©coration raffinÃ©e.", level: "Deluxe Villa", pointsForts: ["Station principale du Disney Skyliner", "Restaurant sur le toit avec personnages (Topolino's)", "Design europÃ©en Ã©lÃ©gant et artistique", "Piscines magnifiques et jeux d'eau"] },
            { name: "Wilderness Lodge - Copper Creek", description: "InspirÃ©es par l'hÃ©ritage ferroviaire du Nord-Ouest Pacifique, ces villas et cabines au bord de l'eau offrent une touche de luxe moderne dans un cadre rustique et sauvage.", level: "Deluxe Villa", pointsForts: ["Cabines privÃ©es luxueuses au bord du lac", "Piscine thÃ©matique avec geyser", "Ambiance Ã  la fois rustique et moderne", "AccÃ¨s par bateau-taxi Ã  Magic Kingdom"] },
            { name: "Wilderness Lodge - Boulder Ridge", description: "Adjacent au lodge principal, ce bÃ¢timent Ã©voque le charme des gÃ®tes des parcs nationaux de l'Ouest amÃ©ricain. Une ambiance chaleureuse et rustique, parfaite pour une retraite paisible.", level: "Deluxe Villa", pointsForts: ["AtmosphÃ¨re calme et plus intime", "ThÃ¨me des parcs nationaux amÃ©ricains", "AccÃ¨s facile aux commoditÃ©s du lodge", "Feu de camp et activitÃ©s extÃ©rieures"] },
            { name: "Animal Kingdom Lodge - Jambo House", description: "Vivez une expÃ©rience immersive dans le bÃ¢timent principal d'Animal Kingdom Lodge. Le lobby grandiose et les vues directes sur la savane depuis certaines chambres sont inoubliables.", level: "Deluxe Villa", pointsForts: ["Vues imprenables sur la savane animaliÃ¨re", "Lobby spectaculaire et collection d'art africain", "Restaurants primÃ©s (Jiko, Boma)", "Piscine Uzima avec vue sur les animaux"] },
            { name: "Animal Kingdom Lodge - Kidani Village", description: "Ce bÃ¢timent dÃ©diÃ© aux villas offre une ambiance plus calme et des vues Ã©tendues sur la savane. IdÃ©al pour les familles qui souhaitent plus d'espace et une cuisine complÃ¨te.", level: "Deluxe Villa", pointsForts: ["Excellent pour l'observation des animaux", "Piscine Samawati avec glissades et jeux d'eau", "Restaurant Sanaa avec vue sur la savane", "Villas spacieuses avec cuisines complÃ¨tes"] },
        
            // Deluxe Resorts
            { name: "Contemporary Resort", description: "Iconique et ultra-moderne, cet hÃ´tel en forme de A est le seul oÃ¹ le monorail passe directement Ã  l'intÃ©rieur. Il est si proche de Magic Kingdom que vous pouvez y aller Ã  pied.", level: "Deluxe", pointsForts: ["Le plus proche de Magic Kingdom (Ã  pied)", "Le monorail traverse le lobby de l'hÃ´tel", "Restaurant sur le toit (California Grill)", "Design moderne et vues exceptionnelles"] },
            
            // Moderate Resorts
            { name: "Coronado Springs Resort", description: "Ce complexe tentaculaire allie une architecture coloniale espagnole Ã  l'Ã©lÃ©gance moderne de la tour Gran Destino. Il offre des commoditÃ©s de luxe Ã  un prix de catÃ©gorie modÃ©rÃ©e.", level: "Moderate", pointsForts: ["Ambiance de luxe Ã  prix modÃ©rÃ©", "Options de restauration variÃ©es et excellentes", "Piscine 'The Lost City of Cibola' avec pyramide", "La tour Gran Destino offre des chambres modernes"] },
            { name: "Caribbean Beach Resort", description: "Ã‰vadez-vous dans l'ambiance colorÃ©e et tropicale des CaraÃ¯bes. Ce resort tentaculaire est le hub central du Disney Skyliner, offrant un transport rapide et amusant.", level: "Moderate", pointsForts: ["Hub principal du Disney Skyliner", "Piscine thÃ©matique 'Fuentes del Morro'", "Chambres sur le thÃ¨me des pirates", "Ambiance de vacances tropicales"] },
            { name: "Port Orleans - French Quarter", description: "Ce charmant hÃ´tel Ã©voque les rues pavÃ©es et les balcons en fer forgÃ© du Vieux CarrÃ© de La Nouvelle-OrlÃ©ans. Sa petite taille le rend intime et facile Ã  parcourir.", level: "Moderate", pointsForts: ["HÃ´tel le plus compact et intime", "Beignets Mickey frais et dÃ©licieux", "Ambiance jazz et romantique", "Service de bateau-taxi vers Disney Springs"] },
            { name: "Port Orleans - Riverside", description: "Explorez les bayous rustiques de la Louisiane ou les manoirs Ã©lÃ©gants du Sud. Ce vaste complexe offre une grande variÃ©tÃ© de paysages et une atmosphÃ¨re paisible.", level: "Moderate", pointsForts: ["Choix entre manoirs ou cabanes rustiques", "Chambres thÃ©matiques 'Royal Rooms'", "AtmosphÃ¨re relaxante au bord de la riviÃ¨re", "ActivitÃ©s comme la pÃªche et les calÃ¨ches"] },

            // Value Resorts
            { name: "Art of Animation Resort", description: "Plongez littÃ©ralement dans les mondes de NÃ©mo, Cars, Le Roi Lion et La Petite SirÃ¨ne. Cet hÃ´tel est cÃ©lÃ¨bre pour ses suites familiales immersives et sa piscine 'Big Blue', la plus grande de Disney World.", level: "Value", pointsForts: ["Suites familiales thÃ©matiques (jusqu'Ã  6 pers.)", "La plus grande piscine de tout Disney World", "Station dÃ©diÃ©e sur le Disney Skyliner", "DÃ©cors et personnages gÃ©ants spectaculaires"] },
            { name: "Pop Century Resort", description: "Voyagez Ã  travers les dÃ©cennies marquantes du XXe siÃ¨cle. Cet hÃ´tel est l'un des favoris pour son excellent rapport qualitÃ©-prix et son accÃ¨s direct et rapide au Disney Skyliner.", level: "Value", pointsForts: ["AccÃ¨s direct au Disney Skyliner", "Excellent rapport qualitÃ©-prix", "RÃ©cemment rÃ©novÃ© avec lits queen", "Ambiance nostalgique et amusante"] },
            { name: "All-Star Movies Resort", description: "Vibrez au rythme des classiques du cinÃ©ma Disney dans cet hÃ´tel aux dÃ©cors spectaculaires. IdÃ©al pour les familles, chaque bÃ¢timent est une cÃ©lÃ©bration de films comme Fantasia ou Toy Story.", level: "Value", pointsForts: ["ThÃ©matisation immersive et icÃ´nes gÃ©antes", "L'une des options les plus abordables sur site", "Grande aire de restauration 'World Premiere'", "Piscine sur le thÃ¨me de Fantasia"] },
            { name: "All-Star Music Resort", description: "CÃ©lÃ©brez tous les genres musicaux, du calypso au rock'n'roll. C'est le seul hÃ´tel 'All-Star' Ã  proposer des suites familiales, une option Ã©conomique pour les grands groupes.", level: "Value", pointsForts: ["Propose des suites familiales abordables", "Piscine principale en forme de guitare", "ThÃ¨me musical entraÃ®nant et amusant", "Excellent choix pour les fanfares scolaires"] },
            { name: "All-Star Sports Resort", description: "Pour les amateurs de sport, cet hÃ´tel est un terrain de jeu gÃ©ant. Les icÃ´nes surdimensionnÃ©es de ballons de football, de battes de baseball et de planches de surf crÃ©ent une atmosphÃ¨re Ã©nergique.", level: "Value", pointsForts: ["ThÃ¨me sportif et dynamique", "Parfait pour les groupes sportifs de jeunes", "Tarifs parmi les plus bas de Disney", "Aires de jeux sur le thÃ¨me du sport"] }
        ];

        function getHotelByName(name) { return DISNEY_HOTELS.find(hotel => hotel.name === name); }
        function formatDateFR(dateStr) { if (!dateStr) return ""; try { const date = new Date(dateStr + 'T00:00:00'); const options = { year: 'numeric', month: 'long', day: 'numeric' }; return date.toLocaleDateString('fr-FR', options); } catch (e) { return dateStr; } }
        function formatTime(timeStr) { if (!timeStr) return ""; try { const [hours, minutes] = timeStr.split(':'); return `${String(hours).padStart(2, '0')}h${String(minutes).padStart(2, '0')}`; } catch (e) { return timeStr; } }

        function generateEmailHTML(data) {
             const C = {
                blue: '#0078C1',
                blueDark: '#005a9c',
                orange: '#FF7F50',
                textDark: '#222222',
                textLight: '#555555',
                border: '#EAEAEA',
                background: '#f0f2f5',
                white: '#FFFFFF',
                blueLight: '#e6f2fa',
                orangeLight: '#fff4e6',
                level: { value: '#28a745', moderate: '#2196F3', deluxe: '#6f42c1', deluxe_villa: '#9C27B0' },
                tags: ['#0078C1', '#5A67D8', '#d9480f', '#0ca678']
            };

            const S = {
                fontStack: `Arial, Helvetica, sans-serif`,
                p: `font-family: Arial, Helvetica, sans-serif; font-size: 16px; line-height: 1.6; color: ${C.textDark}; margin: 1em 0; text-align: justify;`,
                strong: `font-weight: bold;`,
                italic: `font-style: italic;`,
            };
            
            function createBanner(text, type = 'main') {
                let style, titleStyle, wrapperStyle;
                switch (type) {
                    case 'closing': style = `background-color: ${C.orange}; padding: 12px 30px;`; titleStyle = `font-family: Georgia, serif; font-size: 24px; color: ${C.white}; font-weight: bold; text-transform: uppercase; margin: 0; text-align: center; letter-spacing: 1px;`; wrapperStyle = `padding: 5px 0;`; break;
                    case 'sub': style = `background-color: ${C.blue}; padding: 10px 30px;`; titleStyle = `font-family: ${S.fontStack}; font-size: 20px; color: ${C.white}; font-weight: bold; text-transform: uppercase; margin: 0; text-align: center;`; wrapperStyle = `padding: 0;`; break;
                    case 'main': default: style = `background: linear-gradient(to right, ${C.blue}, ${C.blueDark}); padding: 25px 30px;`; titleStyle = `font-family: Georgia, serif; font-size: 32px; color: ${C.white}; font-weight: bold; text-transform: uppercase; margin: 0; text-align: center; letter-spacing: 1.5px; line-height:1.2;`; wrapperStyle = `border-top: 1px solid rgba(255,255,255,0.3); border-bottom: 1px solid rgba(255,255,255,0.3); padding: 10px 0;`; break;
                }
                return `<tr><td style="${style}"><div style="${wrapperStyle}"><h1 style="${titleStyle}">${text}</h1></div></td></tr>`;
            }
            
            function createCalloutBox(title, text, color) {
                return `<table width="100%" border="0" cellpadding="0" cellspacing="0" style="margin-top:20px;"><tr><td style="padding: 20px 25px; background-color: ${C[`${color}Light`]}; border-left: 5px solid ${C[color]}; border-radius: 0 8px 8px 0;"><h2 style="font-family:${S.fontStack}; font-size:18px; color:${C[color]}; margin:0 0 10px 0; font-weight:bold;">${title}</h2><p style="font-family:${S.fontStack}; margin:0; text-align:justify;">${text}</p></td></tr></table>`;
            }

            const T = {
                banner1: "Votre Aventure Magique Commence Ici",
                logosEmail: `<table width="100%" cellpadding="0" cellspacing="0" style="background-color:#eceff1;margin:20px 0;border-radius:8px;">
                <tr>
                <td style="width:50%;text-align:center;padding:10px;">
                    <img src="https://www.voyagesenroute.com/wp-content/uploads/2024/10/Logo_Fond_Blanc_2.svg" alt="Logo agence" style="max-height:80px;">
                </td>
                <td style="width:50%;text-align:center;padding:10px;">
                    <img src="https://i.ibb.co/GQVYyJn2/Disney-Organisateur-de-vacances-autorise-Disney-Ear-Marked-argent-1-1-e1722367433886.png" alt="Earmarked" style="max-height:80px;">   
                </td>
                 </tr>
                </table>`,
                greeting: `Bonjour <strong style="${S.strong}">${data.client_name || 'estimÃ©(e) voyageur(se)'}</strong>,`,
                intro1: `Je vous Ã©cris au nom de Voyages en Route, oÃ¹ nous avons le plaisir dâ€™accompagner les familles et voyageurs dans la planification de leurs sÃ©jours. Je m'appelle Pierre-Luc Morin et je serais votre conseiller en voyages spÃ©cialisÃ© en destinations <strong style="${S.strong}">Disney et Universal</strong>.`,
                intro2: `Merci de nous avoir confiÃ© votre projet de voyage. Jâ€™ai pris soin de prÃ©parer une proposition basÃ©e sur les critÃ¨res que vous avez partagÃ©s dans votre demande. Cette soumission est <strong style="${S.strong}">ajustable</strong>, et je serai heureux dâ€™explorer avec vous diffÃ©rentes options afin de vous crÃ©er une expÃ©rience <strong style="${S.strong}">propre Ã  vous et inoubliable</strong>.`,
                disney_advantages_intro: `SÃ©journer dans un hÃ´tel Disney, câ€™est profiter dâ€™un univers immersif du matin au soir, mais aussi de <strong style="${S.strong}">nombreux avantages exclusifs</strong>&nbsp;:</p>`,
                disney_advantages_list_items: [
                    `<strong style="${S.strong}">Lâ€™Early Theme Park Entry</strong>, pour accÃ©der aux parcs avant lâ€™ouverture officielle&nbsp;;`,
                    `Le <strong style="${S.strong}">transport gratuit</strong> vers tous les parcs et sites Disney (excluant les transferts aÃ©roports)&nbsp;;`,
                    `Lâ€™<strong style="${S.strong}">accÃ¨s simplifiÃ©</strong> aux rÃ©servations avec lâ€™application Disney Experience&nbsp;;`,
                    `Et un <strong style="${S.strong}">service client exceptionnel</strong>, signÃ© Disney, Ã  chaque Ã©tape de votre sÃ©jour.`
                ],
                disney_price_disclaimer: "Veuillez noter que tous les prix pour l'hÃ©bergement et les billets Disney sont indiquÃ©s en dollars amÃ©ricains (USD) et sont sujets Ã  disponibilitÃ©.",
                tickets_only_price_disclaimer: "Veuillez noter que tous les prix des billets Disney sont indiquÃ©s en dollars amÃ©ricains (USD) et sont sujets Ã  disponibilitÃ©.",
                banner_travel_fees: "ItinÃ©raire de Vol",
                flight_intro: "Pour complÃ©ter votre voyage vers la magie, voici les dÃ©tails concernant le transport aÃ©rien que nous avons explorÃ©&nbsp;:",
                flight_price_info: `<em style="${S.italic}">Les prix sont Ã  titre indicatif et peuvent changer Ã  tout moment.</em>`,
                flight_important_label: `IMPORTANT`,
                flight_important_text: `Les tarifs aÃ©riens sont dynamiques et peuvent changer jusqu'Ã  la rÃ©servation. Des frais de service de <strong style="${S.strong}">50$ CAD par personne</strong> s'appliquent pour la rÃ©servation des vols via nos services. En me confiant vos vols, je m'occupe de tout dÃ©sagrÃ©ment potentiel. Si vous optez pour une rÃ©servation personnelle, ces frais ne s'appliquent pas, mais le support en cas de problÃ¨me avec les vols ne sera pas inclus pour cette portion.`,
                banner_magic_continues: "La Magie Continue...",
                closing1: `Prenez le temps de rÃªver Ã  ces options et de considÃ©rer ce qui ferait de ce voyage une expÃ©rience <strong style="${S.strong}">vÃ©ritablement inoubliable</strong>. Je suis Ã  votre <strong style="${S.strong}">entiÃ¨re disposition</strong> pour rÃ©pondre Ã  toutes vos questions, affiner chaque dÃ©tail ou procÃ©der Ã  la rÃ©servation de cette <em style="${S.italic}">aventure mÃ©morable</em>.`,
                closing2: `N'hÃ©sitez pas Ã  me joindre par courriel (en rÃ©pondant simplement Ã  celui-ci) ou par tÃ©lÃ©phone au <strong style="${S.strong}">819-347-9103</strong>.`,
                closing3: `Merci encore pour votre confiance. J'ai sincÃ¨rement hÃ¢te de transformer ce <strong style="${S.strong}">rÃªve Disney</strong> en une <strong style="${S.strong}">magnifique rÃ©alitÃ© pour vous&nbsp;!</strong>`
            };
            
            let introSection = `<p style="${S.p}">${T.greeting}</p><p style="${S.p}">${T.intro1}</p><p style="${S.p}">${T.intro2}</p>`;
            let hotelSection = '';
            const selectedHotels = data.hotels || [];

            if (data.booking_type === 'hotel_tickets' && selectedHotels.length > 0) {
if (selectedHotels.length === 1) {
                    const hotel = selectedHotels[0];
                    const levelColor = C.level[hotel.level.toLowerCase().replace(/ /g, '_')] || C.textLight;
                    
                    let prosList = `<span style="background-color:${levelColor}; color:${C.white}; padding: 5px 12px; margin: 0 8px 8px 0; border-radius: 15px; font-size: 14px; font-weight: bold; display:inline-block;">${hotel.level}</span>`;
                    hotel.pointsForts.forEach((p, i) => {
                        const tagColor = C.tags[i % C.tags.length];
                        prosList += `<span style="display:inline-block; background-color:${tagColor}; color:${C.white}; padding: 5px 12px; margin: 0 8px 8px 0; border-radius: 15px; font-size: 14px; font-weight: bold;">${p}</span>`;
                    });

                    let hotelCard = `
                        <div class="hotel-card" style="margin-top: 25px; border: 1px solid ${C.border}; border-radius: 8px;">
                            <div style="background-color:${C.blue}; color:${C.white}; padding:15px 20px; border-radius: 8px 8px 0 0;">
                                <strong style="font-family:${S.fontStack}; font-size:20px;">${hotel.name}</strong>
                            </div>
                            <div style="background-color:${C.white}; padding: 20px;">
                                <p style="font-family:${S.fontStack}; font-size:15px; line-height:1.5; color:${C.textLight}; margin:0 0 15px 0; text-align:justify;">${hotel.description}</p>
                                <div style="padding:10px 0;">${prosList}</div>
                            </div>
                            <div style="background-color:${C.blueLight}; padding: 15px 20px; text-align:center; border-radius: 0 0 8px 8px; border-top: 1px solid ${C.border};">
                                <span style="font-size:14px; color:${C.textLight}; font-weight:bold; text-transform:uppercase;">PRIX DU FORFAIT</span><br>
                                <strong style="font-size:28px; color:${C.textDark}; line-height:1.2;">${hotel.price ? hotel.price + '&nbsp;USD' : 'Voir PDF'}</strong>
                            </div>
                        </div>
                    `;
                    hotelSection += `<p style="${S.p}">Pour votre sÃ©jour, voici l'option que j'ai sÃ©lectionnÃ©e pour vous :</p>${logosEmail}${hotelCard}`;
                } else {
                    hotelSection += `<p style="${S.p}">Voici plusieurs options dâ€™hÃ©bergement pour votre sÃ©jour. Chaque proposition ci-dessous correspond Ã  un forfait dÃ©taillÃ© dans un document PDF distinct.</p>${logosEmail}`;
                    let hotelCards = '';
                    selectedHotels.forEach(hotel => {
                        const levelColor = C.level[hotel.level.toLowerCase().replace(/ /g, '_')] || C.textLight;
                        
                        let prosList = `<span style="background-color:${levelColor}; color:${C.white}; padding: 5px 12px; margin: 0 8px 8px 0; border-radius: 15px; font-size: 14px; font-weight: bold; display:inline-block;">${hotel.level}</span>`;
                        hotel.pointsForts.forEach((p, i) => {
                            const tagColor = C.tags[i % C.tags.length];
                            prosList += `<span style="display:inline-block; background-color:${tagColor}; color:${C.white}; padding: 5px 12px; margin: 0 8px 8px 0; border-radius: 15px; font-size: 14px; font-weight: bold;">${p}</span>`;
                        });

                        hotelCards += `
                            <div class="hotel-card" style="margin-top: 25px; border: 1px solid ${C.border}; border-radius: 8px;">
                                <div style="background-color:${C.blue}; color:${C.white}; padding:15px 20px; border-radius: 8px 8px 0 0;">
                                    <strong style="font-family:${S.fontStack}; font-size:20px;">${hotel.name}</strong>
                                </div>
                                <div style="background-color:${C.white}; padding: 20px;">
                                    <p style="font-family:${S.fontStack}; font-size:15px; line-height:1.5; color:${C.textLight}; margin:0 0 15px 0; text-align:justify;">${hotel.description}</p>
                                    <div style="padding:10px 0;">${prosList}</div>
                                </div>
                                <div style="background-color:${C.blueLight}; padding: 15px 20px; text-align:center; border-radius: 0 0 8px 8px; border-top: 1px solid ${C.border};">
                                    <span style="font-size:14px; color:${C.textLight}; font-weight:bold; text-transform:uppercase;">PRIX DU FORFAIT</span><br>
                                    <strong style="font-size:28px; color:${C.textDark}; line-height:1.2;">${hotel.price ? hotel.price + '&nbsp;USD' : 'Voir PDF'}</strong>
                                </div>
                            </div>
                        `;
                    });
                    hotelSection += hotelCards;
                }
                
                hotelSection += `<p style="${S.p} margin-top:20px;">Chaque proposition de forfait inclut l'hÃ©bergement Ã  l'hÃ´tel ainsi que les billets d'entrÃ©e pour les parcs Disney. Tous les autres dÃ©tails, inclusions et conditions se trouvent dans le ou les documents PDF correspondants.</p>`
                let advantagesList = T.disney_advantages_list_items.map(item => `<li style="margin-bottom:8px;"><span style="color:${C.blue}; font-size:18px; vertical-align:middle; margin-right:8px; font-weight:bold;">&#10004;</span><span style="vertical-align:middle;">${item}</span></li>`).join('');
                hotelSection += `<p style="${S.p} margin-top:30px; text-align:left;">${T.disney_advantages_intro}<ul style="margin:1em 0; padding:0; list-style-type:none; text-align:left;">${advantagesList}</ul>`;

            } else if (data.booking_type === 'tickets_only') {
                hotelSection = `<p style="${S.p}">Jâ€™ai prÃ©parÃ© pour vous un document ci-joint indiquant le prix ainsi que les conditions applicables aux billets de parc.</p>`;
            }

            let promoText = "";
            if (data.promotion_type === 'aucune') {
                promoText = `Pour garantir votre place, un dÃ©pÃ´t de seulement <strong style="${S.strong}">200 USD</strong> est requis. Les promotions Disney deviennent souvent disponibles et sont parfois complÃ¨tement rÃ©servÃ©es Ã  l'intÃ©rieur de quelques heures. Il est donc important de rÃ©server d'avance pour que je sois en mesure de les obtenir pour vous de maniÃ¨re rapide et systÃ©matique, afin que vous ayez toujours le meilleur rapport qualitÃ©-prix. Le reste de la balance de paiement est aussi Ã  effectuer 30 jours avant le check-in.`;
            } else {
                let promoEndDateInfo = data.promotion_end_date ? ` (prend fin le <strong style="${S.strong}">${formatDateFR(data.promotion_end_date)}</strong>)` : "";
                let promoNameInfo = data.promotion_name ? `&nbsp;: <strong style="${S.strong}">${data.promotion_name}</strong>` : "";
                promoText = `Une promotion est applicable pour votre sÃ©jour${promoNameInfo}${promoEndDateInfo}. Lâ€™offre est cependant <em style="${S.italic}">limitÃ©e</em>. Pour garantir votre place au cÅ“ur de la magie, un dÃ©pÃ´t de seulement <strong style="${S.strong}">200 USD</strong> est requis. Ce dÃ©pÃ´t est <strong style="${S.strong}">entiÃ¨rement remboursable jusqu'Ã  30 jours avant votre arrivÃ©e</strong>, vous offrant une flexibilitÃ© totale. Le reste de la balance de paiement est aussi Ã  effectuer 30 jours avant le check-in.`;
            }
            
            let promotionSection = createCalloutBox("PROMOTIONS ET DÃ‰PÃ”T REQUIS", promoText, "orange");
            let priceDisclaimer = (data.booking_type === 'hotel_tickets' && selectedHotels.length > 0) ? T.disney_price_disclaimer : T.tickets_only_price_disclaimer;

// REMPLACEZ PAR CE BLOC ENTIER
            let flightSection = '';
            if (data.include_flights) {
                if (data.too_early_for_flights) {
                    const tooEarlyMessage = `<p style="${S.p}">Concernant les vols, il est encore trop tÃ´t pour obtenir les horaires et les tarifs prÃ©cis, car les compagnies aÃ©riennes ne les ont pas encore publiÃ©s pour cette pÃ©riode. Je garde un Å“il attentif sur les annonces et je reviendrai vers vous avec les meilleures options dÃ¨s qu'elles seront disponibles.</p>`;
                    flightSection = `<tr><td style="padding: 20px 30px 30px 30px;">${tooEarlyMessage}</td></tr>`;
                } else {
                    const arrow = `<span style="color:${C.orange}; font-weight:bold; font-size:24px; line-height:1;">&nbsp;&rarr;&nbsp;</span>`;

                    // Consistent font style for the entire flight details container
                    const flightDetailsContainerStyle = `font-family: ${S.fontStack}; border: 1px solid ${C.border}; border-radius: 8px; margin-top:20px;`;
                    const flightColumnStyle = `width:45%; text-align:center; vertical-align:top; font-family: ${S.fontStack};`;
                    const flightInfoStyle = `font-size:15px; color:${C.textDark}; line-height:1.6;`;
                    const flightHeaderStyle = `font-size:16px; color:${C.textLight}; text-transform:uppercase; margin-bottom:10px;`;
                    const airportStyle = `font-size:20px; font-weight:bold; color:${C.blue}; margin-bottom:10px;`;

                    let flightDetails = `<p style="${S.p}">${T.flight_intro}</p>
                       <div style="${flightDetailsContainerStyle}">
                           <div style="padding:20px; border-bottom:1px dashed ${C.border};">
                               <h3 style="margin:0 0 20px 0; font-size:18px; color:${C.blue}; font-family: ${S.fontStack};">âœˆï¸ Vol aller</h3>
                                <table width="100%" border="0" cellpadding="0" cellspacing="0">
                                    <tr>
                                        <td style="${flightColumnStyle}">
                                            <div style="${flightHeaderStyle}">DÃ©part</div>
                                            <div style="${airportStyle}">${data.departure_airport_aller || 'N/A'}</div>
                                            <div style="${flightInfoStyle}">
                                                ğŸ“…&nbsp;${formatDateFR(data.departure_date_aller)}<br>
                                                ğŸ•’&nbsp;${formatTime(data.departure_time_aller)}
                                            </div>
                                        </td>
                                        <td style="width:10%; text-align:center; vertical-align:middle;">${arrow}</td>
                                        <td style="${flightColumnStyle}">
                                            <div style="${flightHeaderStyle}">ArrivÃ©e</div>
                                            <div style="${airportStyle}">${data.arrival_airport_aller || 'N/A'}</div>
                                            <div style="${flightInfoStyle}">
                                                ${data.airline_aller || 'Compagnie non spÃ©cifiÃ©e'}<br>
                                                ${data.flight_number_aller || 'Vol non spÃ©cifiÃ©'}
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                           </div>
                           <div style="padding:20px;">
                               <h3 style="margin:0 0 20px 0; font-size:18px; color:${C.blue}; font-family: ${S.fontStack};">âœˆï¸ Vol retour</h3>
                                <table width="100%" border="0" cellpadding="0" cellspacing="0">
                                    <tr>
                                        <td style="${flightColumnStyle}">
                                            <div style="${flightHeaderStyle}">DÃ©part</div>
                                            <div style="${airportStyle}">${data.departure_airport_retour || 'N/A'}</div>
                                            <div style="${flightInfoStyle}">
                                                ğŸ“…&nbsp;${formatDateFR(data.departure_date_retour)}<br>
                                                ğŸ•’&nbsp;${formatTime(data.departure_time_retour)}
                                            </div>
                                        </td>
                                        <td style="width:10%; text-align:center; vertical-align:middle;">${arrow}</td>
                                        <td style="${flightColumnStyle}">
                                            <div style="${flightHeaderStyle}">ArrivÃ©e</div>
                                            <div style="${airportStyle}">${data.arrival_airport_retour || 'N/A'}</div>
                                            <div style="${flightInfoStyle}">
                                                ${data.airline_retour || 'Compagnie non spÃ©cifiÃ©e'}<br>
                                                ${data.flight_number_retour || 'Vol non spÃ©cifiÃ©'}
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                           </div>
                           <div style="background-color:${C.blueLight}; padding: 20px; text-align:center; border-radius: 0 0 8px 8px; border-top: 1px solid ${C.border};">
                               <div style="font-family:${S.fontStack}; font-size:16px; color:${C.textDark}; font-weight:bold; text-transform:uppercase; margin-bottom: 5px;">PRIX APPROXIMATIF DES VOLS</div>
                               <strong style="font-family:${S.fontStack}; font-size:28px; color:${C.textDark}; line-height:1.2;">${data.flight_price ? data.flight_price + '&nbsp;CAD' : 'N/A'}</strong>
                           </div>
                       </div>`;

                    if (data.flight_notes) {
                        flightDetails += `<p style="${S.p} font-style:italic; font-weight:bold; color:${C.textLight}; border-left:3px solid ${C.border}; padding-left:15px; margin-top:20px;">${data.flight_notes.replace(/\n/g, '<br>')}</p>`;
                    }
                    
                    flightDetails += createCalloutBox(T.flight_important_label, T.flight_important_text, "orange");
                    flightDetails += `<p style="${S.p} font-size:14px; color:${C.textLight}; text-align:left; margin-top:20px;">${T.flight_price_info}</p>`;
                                        
                    flightSection = `<tr><td style="padding: 20px 30px 30px 30px;">${flightDetails}</td></tr>`;
                }
            }
            let closingSection = `<p style="${S.p}">${T.closing1}</p><p style="${S.p}">${T.closing2}</p><p style="${S.p}">${T.closing3}</p>`;
            
            const hotelBannerText = data.booking_type === 'tickets_only' ? "Billets de Parc Disney" : "Forfaits HÃ´tel & Billets Disney";

            return `<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>${T.banner1}</title></head><body style="margin:0; padding:0; background-color:${C.background};"><table width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="background-color:${C.background};"><tr><td align="center"><table width="680" border="0" cellpadding="0" cellspacing="0" role="presentation" style="width: 680px; max-width: 100%; margin: 20px auto; background-color: ${C.white};">
                ${createBanner(T.banner1, 'main')}
                <tr><td style="padding: 20px 30px 30px 30px;">${introSection}</td></tr>
                ${createBanner(hotelBannerText, 'sub')}
                <tr><td style="padding: 20px 30px 10px 30px;">${hotelSection}</td></tr>
                <tr><td style="padding: 10px 30px 30px 30px;">${promotionSection}</td></tr>
                <tr><td style="padding: 0 30px 30px 30px;"><p style="${S.p} font-size:14px; color:${C.textLight}; text-align:center; ${S.italic}">${priceDisclaimer}</p></td></tr>
               ${data.include_flights ? `
                ${createBanner(T.banner_travel_fees, 'sub')}
                ${flightSection}
              ` : ''}
                ${createBanner(T.banner_magic_continues, 'closing')}
                <tr><td style="padding: 20px 30px 30px 30px;">${closingSection}</td></tr>
            </table></td></tr></table></body></html>`;
        }

        // --- Le reste du script JS pour le formulaire reste identique ---
        document.addEventListener('DOMContentLoaded', function() {
            const hotelSelectionsDiv = document.getElementById('hotel_selections');
            const addHotelButton = document.getElementById('add_hotel_button');
            let hotelCounter = 0;

            function createHotelSelector() {
                hotelCounter++;
                const groupDiv = document.createElement('div');
                groupDiv.classList.add('hotel-option-group');
                groupDiv.id = `hotel_group_${hotelCounter}`;
                
                let content = `
                    <div class="hotel-option-header">
                        <label>Option d'hÃ´tel</label>
                        <button type="button" class="remove-hotel-button" title="Supprimer cet hÃ´tel">Supprimer</button>
                    </div>
                    <select name="hotel_name" required>
                        <option value="" disabled selected>SÃ©lectionnez un hÃ´tel</option>
                        ${DISNEY_HOTELS.sort((a,b) => a.name.localeCompare(b.name)).map(hotel => `<option value="${hotel.name}">${hotel.name}</option>`).join('')}
                    </select>
                    <label for="hotel_price_${hotelCounter}">Prix du Forfait (USD)&nbsp;:</label>
                    <input type="number" name="hotel_price" id="hotel_price_${hotelCounter}" placeholder="Ex: 4500.50" step="0.01">
                `;
                groupDiv.innerHTML = content;

                groupDiv.querySelector('.remove-hotel-button').addEventListener('click', function() {
                    groupDiv.remove();
                    updateAddHotelButtonState();
                });

                return groupDiv;
            }

            function updateAddHotelButtonState() {
                const currentHotelSelectors = hotelSelectionsDiv.querySelectorAll('.hotel-option-group').length;
                addHotelButton.disabled = currentHotelSelectors >= 5;
                addHotelButton.textContent = currentHotelSelectors >= 5 ? "Maximum 5 hÃ´tels atteints" : "Ajouter une option d'hÃ´tel";
            }

            addHotelButton.addEventListener('click', function() {
                if (hotelSelectionsDiv.querySelectorAll('.hotel-option-group').length < 5) {
                    hotelSelectionsDiv.appendChild(createHotelSelector());
                    updateAddHotelButtonState();
                }
            });

            hotelSelectionsDiv.appendChild(createHotelSelector());
            updateAddHotelButtonState();
            
            const form = document.getElementById('disneyForm');
            const generateButton = document.getElementById('generateEmailButton');
            const emailOutputDiv = document.getElementById('emailOutput');

            function handleGenerateEmail(event) {
                event.preventDefault();
                const formData = new FormData(form);
                const data = {};
                
                for (let [key, value] of formData.entries()) {
                    if (!key.startsWith('hotel_')) {
                        data[key] = value;
                    }
                }
Â  Â  Â  Â  Â  Â  Â  Â  data.include_flights = formData.has('include_flights');
                // --- LIGNE Ã€ AJOUTER ---
                data.too_early_for_flights = formData.has('too_early_for_flights');
                // --- FIN DE LA LIGNE Ã€ AJOUTER ---
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  data.hotels = [];
                const hotelGroups = hotelSelectionsDiv.querySelectorAll('.hotel-option-group');
                hotelGroups.forEach(group => {
                    const name = group.querySelector('select[name="hotel_name"]').value;
                    const price = group.querySelector('input[name="hotel_price"]').value;
                    if(name) {
                        const hotelData = getHotelByName(name);
                        data.hotels.push({
                            name: name,
                            description: hotelData.description,
                            level: hotelData.level,
                            pointsForts: hotelData.pointsForts,
                            price: price
                        });
                    }
                });
                
                const emailHtmlContent = generateEmailHTML(data);
                emailOutputDiv.innerHTML = emailHtmlContent;
            }

            form.addEventListener('submit', handleGenerateEmail);
            generateButton.addEventListener('click', handleGenerateEmail);

            const copyHtmlButton = document.getElementById('copyHtmlButton');
            copyHtmlButton.addEventListener('click', function() {
                const emailContent = emailOutputDiv.innerHTML;
                 navigator.clipboard.writeText(emailContent).then(function() {
                    alert('Contenu HTML de l\'e-mail copiÃ© dans le presse-papiers !');
                }, function(err) {
                    alert('Erreur lors de la copie. Veuillez essayer manuellement.');
                    console.error('Could not copy text: ', err);
                });
            });
            
           // RECHERCHEZ CE BLOC ET AJOUTEZ LES LIGNES MARQUÃ‰ES
            const includeFlightsCheckbox = document.getElementById('include_flights');
            const flightDetailsDiv = document.getElementById('flight_details');
            // --- LIGNES Ã€ AJOUTER ---
            const tooEarlyForFlightsCheckbox = document.getElementById('too_early_for_flights');
            const flightInputsWrapper = document.getElementById('flight_inputs_wrapper');
            // --- FIN DES LIGNES Ã€ AJOUTER ---
            const bookingTypeSelect = document.getElementById('booking_type');
            const hotelOptionsContainer = document.getElementById('hotel_options_container');
            const promotionTypeSelect = document.getElementById('promotion_type');
            const promotionDetailsDiv = document.getElementById('promotion_details');
Â  Â  Â  Â  Â  Â Â 
            function toggleFlightDetails() {
                flightDetailsDiv.classList.toggle('hidden', !includeFlightsCheckbox.checked);
                toggleFlightInputs();
            }
            // ...

            // --- FONCTION Ã€ AJOUTER ---
            function toggleFlightInputs() {
                if (includeFlightsCheckbox.checked) {
                    flightInputsWrapper.classList.toggle('hidden', tooEarlyForFlightsCheckbox.checked);
                }
            }
            // --- FIN DE LA FONCTION Ã€ AJOUTER ---

            function toggleHotelOptions() {
                const isHotelBooking = bookingTypeSelect.value === 'hotel_tickets';
                hotelOptionsContainer.classList.toggle('hidden', !isHotelBooking);

                const hotelNameSelects = hotelOptionsContainer.querySelectorAll('select[name="hotel_name"]');
                hotelNameSelects.forEach(select => {
                    if (isHotelBooking) {
                        select.setAttribute('required', '');
                    } else {
                        select.removeAttribute('required');
                        select.value = '';
                    }
                });
            }

            function togglePromotionDetails() {
                promotionDetailsDiv.classList.toggle('hidden', promotionTypeSelect.value !== 'specifique');
            }

            includeFlightsCheckbox.addEventListener('change', function() {
                toggleFlightDetails();
                toggleFlightInputs();
            });
            // --- LIGNE Ã€ AJOUTER ---
            tooEarlyForFlightsCheckbox.addEventListener('change', toggleFlightInputs);
            // --- FIN DE LA LIGNE Ã€ AJOUTER ---
            bookingTypeSelect.addEventListener('change', toggleHotelOptions);
            promotionTypeSelect.addEventListener('change', togglePromotionDetails);
            // ...
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  toggleFlightDetails();
            // --- LIGNE Ã€ AJOUTER ---
            toggleFlightInputs(); 
            // --- FIN DE LA LIGNE Ã€ AJOUTER ---
Â  Â  Â  Â  Â  Â  toggleHotelOptions();
Â  Â  Â  Â  Â  Â  togglePromotionDetails();
        });
    </script>
</body>
</html>
